<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>FinClash - Stock Trading Simulator</title>
 <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“ˆ</text></svg>">

 <!-- Development build - CDN libraries for rapid prototyping -->
 <!-- Note: For production deployment, these should be built/bundled properly -->
 <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
 <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
 <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
 <script src="https://cdn.tailwindcss.com"></script>
 <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
 <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>

 <!-- External CSS -->
 <link rel="stylesheet" href="css/styles.css">
</head>
<body>
 <div id="root"></div>

 <!-- External JavaScript modules -->
 <script src="js/config.js"></script>
 <!-- database.js removed - using backend server API only -->
 <script src="js/crypto-utils.js"></script>
 <script src="js/analytics.js"></script>
 <script src="js/news-feed.js"></script>
 <script src="js/short-selling.js"></script>
 <script src="js/security.js"></script>

 <!-- Database initialization removed - using backend server only -->


 <script type="text/babel">
 const { useState, useEffect, useRef } = React;

 // Config loaded from external JS file
 // Available: FINNHUB_API_KEY, FINNHUB_API_BASE, STOCK_DATABASE, etc.
 // All user data stored on backend server (not localStorage)

 // Backend API Configuration
 // Automatically detects environment:
 // - localhost: http://localhost:3001 (local development)
 // - production: https://trader-umh8.onrender.com (deployed backend)
 const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
 ? 'http://localhost:3001'
 : 'https://trader-umh8.onrender.com';

 const TradingSimulator = () => {
 const [view, setView] = useState('setup-family');
 const [plan, setPlan] = useState(null);
 const [showAccountTypeModal, setShowAccountTypeModal] = useState(false);
 const [userName, setUserName] = useState('');
 const [userEmail, setUserEmail] = useState('');
 const [userPasscode, setUserPasscode] = useState('');
 const [generatedPasscode, setGeneratedPasscode] = useState('');
 const [userPassword, setUserPassword] = useState('');
 const [passwordStrength, setPasswordStrength] = useState(null);
 const [currentUserId, setCurrentUserId] = useState(null);
 const [contribution, setContribution] = useState('');
 const [resetEmail, setResetEmail] = useState('');
 const [resetCode, setResetCode] = useState('');
 const [newPasscode, setNewPasscode] = useState('');
 const [resetStep, setResetStep] = useState(1); // 1: enter email, 2: enter code + new passcode
 const [showPasswordReset, setShowPasswordReset] = useState(false);
 const [accountMode, setAccountMode] = useState('create'); // 'create' or 'login'
 const [authError, setAuthError] = useState(''); // Error message for auth forms

 const [competitionCode, setCompetitionCode] = useState('');
 const [joinCode, setJoinCode] = useState('');
 const [copySuccess, setCopySuccess] = useState(false);
 const [competition, setCompetition] = useState(null);

 const [watchlist, setWatchlist] = useState([]);
 const [stocks, setStocks] = useState([]);
 const [loading, setLoading] = useState(false);
 const [error, setError] = useState(null);
 const [lastUpdate, setLastUpdate] = useState(null);

 const [searchQuery, setSearchQuery] = useState('');
 const [searchResults, setSearchResults] = useState([]);
 const [searching, setSearching] = useState(false);
 const [showSearchResults, setShowSearchResults] = useState(false);

 const [selectedStock, setSelectedStock] = useState(null);
 const [quantity, setQuantity] = useState(1);
 const [searchTerm, setSearchTerm] = useState('');
 const [activeTab, setActiveTab] = useState('market');
 const [quantityError, setQuantityError] = useState('');
 const [mainTab, setMainTab] = useState('portfolio');
 const [chartPeriod, setChartPeriod] = useState('1M');
 const [isRealChartData, setIsRealChartData] = useState(false);
 const [stockNews, setStockNews] = useState([]);
 const [loadingNews, setLoadingNews] = useState(false);
 const [tradeType, setTradeType] = useState('long'); // 'long' or 'short'
 const [marketNews, setMarketNews] = useState([]);
 const [loadingMarketNews, setLoadingMarketNews] = useState(false);
 const [lastNewsUpdate, setLastNewsUpdate] = useState(null);
 const [lastStockNewsUpdate, setLastStockNewsUpdate] = useState(null);
 const [aiAnalysis, setAiAnalysis] = useState(null);
 const [loadingAnalysis, setLoadingAnalysis] = useState(false);
 const [analysisExpanded, setAnalysisExpanded] = useState(true);

 // Trade analysis system
 const [showTradeAnalysis, setShowTradeAnalysis] = useState(false);
 const [tradeAnalysisData, setTradeAnalysisData] = useState(null);
 const [showDailySummary, setShowDailySummary] = useState(false);
 const [dailySummaryData, setDailySummaryData] = useState(null);

 // Chat room state
 const [chatMessages, setChatMessages] = useState([]);
 const [chatInput, setChatInput] = useState('');
 const [socket, setSocket] = useState(null);
 const chatContainerRef = useRef(null);

 // Market movers state
 const [topGainers, setTopGainers] = useState([]);
 const [topLosers, setTopLosers] = useState([]);
 const [loadingMovers, setLoadingMovers] = useState(false);
 const [moversProgress, setMoversProgress] = useState({ current: 0, total: 0 });

 // Toast notification system
 const [toasts, setToasts] = useState([]);

 // Save indicator state
 const [saveStatus, setSaveStatus] = useState('saved'); // 'saving', 'saved', 'error', 'offline'
 const [lastSaved, setLastSaved] = useState(null);

 // Market hours state
 const [marketOpen, setMarketOpen] = useState(false);
 const [timeUntilChange, setTimeUntilChange] = useState('');
 const [nextMarketOpenTime, setNextMarketOpenTime] = useState('');
 const [currentHoliday, setCurrentHoliday] = useState(null);

 const chartRef = useRef(null);
 const chartInstance = useRef(null);
 const performanceChartRef = useRef(null);
 const performanceChartInstance = useRef(null);

 // Constants are now loaded from config.js:
 // COMMISSION_RATE, COOLDOWN_MINUTES, COOLDOWN_MS
 // STRIPE_FAMILY_PUBLIC_LINK, STRIPE_FAMILY_PRIVATE_LINK
 // POPULAR_STOCKS, TOP_12_STOCKS
 // FINNHUB_API_KEY, FINNHUB_API_BASE, STOCK_DATABASE, FALLBACK_STOCK_DATA

 // Load watchlist from portfolio when competition/account changes
 useEffect(() => {
 if (competition?.members) {
 const currentMember = competition.members.find(m => m.id === currentUserId);
 if (currentMember?.portfolio?.watchlist) {
 setWatchlist(currentMember.portfolio.watchlist);
 } else {
 setWatchlist([]);
 }
 }
 }, [competition, currentUserId]);

 // Socket.io disabled - causing CORS errors
 // Initialize Socket.io connection for chat
 // useEffect(() => {
 // const newSocket = io(API_BASE_URL);
 // setSocket(newSocket);

 // // Listen for chat history
 // newSocket.on('chat_history', (messages) => {
 // setChatMessages(messages);
 // });

 // // Listen for new messages
 // newSocket.on('chat_message', (message) => {
 // setChatMessages(prev => [...prev, message]);
 // // Auto-scroll to bottom
 // setTimeout(() => {
 // if (chatContainerRef.current) {
 // chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
 // }
 // }, 100);
 // });

 // return () => {
 // newSocket.close();
 // };
 // }, []);

 // Auto-fetch stock data for portfolio positions
 useEffect(() => {
 const fetchPositionStocks = async () => {
 const portfolio = getCurrentPortfolio();
 if (!portfolio?.positions) return;

 const positionSymbols = Object.keys(portfolio.positions).filter(symbol => {
 const qty = portfolio.positions[symbol];
 return qty && qty > 0;
 });

 if (positionSymbols.length === 0) return;

 // Fetch data for each position symbol
 for (const symbol of positionSymbols) {
 // Check if stock data already exists
 const existingStock = stocks.find(s => s.symbol === symbol);
 if (!existingStock) {
 try {
 const response = await fetch(
 `${FINNHUB_API_BASE}/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`
 );
 const data = await response.json();

 if (data.c) {
 setStocks(prev => [...prev, {
 symbol,
 price: data.c,
 change: data.dp || 0,
 high: data.h,
 low: data.l,
 open: data.o,
 previousClose: data.pc
 }]);
 }
 } catch (error) {
 console.error(`Error fetching ${symbol}:`, error);
 }
 }
 }
 };

 fetchPositionStocks();
 }, [competition, currentUserId]);

 // Levenshtein distance for fuzzy matching
 const levenshteinDistance = (str1, str2) => {
 const matrix = [];

 for (let i = 0; i <= str2.length; i++) {
 matrix[i] = [i];
 }

 for (let j = 0; j <= str1.length; j++) {
 matrix[0][j] = j;
 }

 for (let i = 1; i <= str2.length; i++) {
 for (let j = 1; j <= str1.length; j++) {
 if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
 matrix[i][j] = matrix[i - 1][j - 1];
 } else {
 matrix[i][j] = Math.min(
 matrix[i - 1][j - 1] + 1, // substitution
 matrix[i][j - 1] + 1, // insertion
 matrix[i - 1][j] + 1 // deletion
 );
 }
 }
 }

 return matrix[str2.length][str1.length];
 };

 // Calculate similarity score (0-100, higher is better)
 const calculateSimilarity = (query, target) => {
 const distance = levenshteinDistance(query.toLowerCase(), target.toLowerCase());
 const maxLength = Math.max(query.length, target.length);
 const similarity = ((maxLength - distance) / maxLength) * 100;
 return similarity;
 };

 const searchStocks = async (query) => {
 if (!query || query.length < 1) {
 setSearchResults([]);
 setShowSearchResults(false);
 setError(null);
 return;
 }

 setSearching(true);
 setShowSearchResults(true);
 setError(null);

 try {
 const searchTerm = query.toLowerCase();

 // First, try exact/partial matches
 let results = STOCK_DATABASE
 .filter(stock =>
 stock.symbol.toLowerCase().includes(searchTerm) ||
 stock.name.toLowerCase().includes(searchTerm)
 )
 .slice(0, 10)
 .map(stock => ({
 symbol: stock.symbol,
 name: stock.name,
 type: 'EQUITY',
 region: 'US',
 currency: 'USD',
 similarity: 100 // Exact/partial matches get full score
 }));

 // If no exact matches, use fuzzy matching
 if (results.length === 0) {
 console.log('ðŸ” No exact matches, using fuzzy search...');

 const fuzzyResults = STOCK_DATABASE
 .map(stock => {
 // Calculate similarity for both symbol and name
 const symbolSimilarity = calculateSimilarity(searchTerm, stock.symbol);
 const nameSimilarity = calculateSimilarity(searchTerm, stock.name);

 // Use the higher similarity score
 const bestSimilarity = Math.max(symbolSimilarity, nameSimilarity);

 return {
 symbol: stock.symbol,
 name: stock.name,
 type: 'EQUITY',
 region: 'US',
 currency: 'USD',
 similarity: bestSimilarity
 };
 })
 .filter(item => item.similarity >= 50) // Only show if >50% similar
 .sort((a, b) => b.similarity - a.similarity) // Sort by similarity
 .slice(0, 10);

 results = fuzzyResults;

 if (results.length > 0) {
 console.log(`âœ… Found ${results.length} fuzzy matches:`, results.map(r => `${r.symbol} (${r.similarity.toFixed(0)}% match)`));
 }
 }

 console.log('Search Results:', results);

 if (results.length > 0) {
 setSearchResults(results);
 } else {
 // If no match in database, validate with API before showing
 const upperQuery = query.toUpperCase();

 // Only show if it looks like a valid ticker (2-5 letters)
 if (/^[A-Z]{1,5}$/.test(upperQuery)) {
 // Try to validate with Finnhub API
 try {
 const response = await fetch(
 `${FINNHUB_API_BASE}/quote?symbol=${upperQuery}&token=${FINNHUB_API_KEY}`
 );
 const data = await response.json();

 // Only show if we get valid price data back
 if (data.c && data.c > 0) {
 setSearchResults([{
 symbol: upperQuery,
 name: `${upperQuery}`,
 type: 'EQUITY',
 region: 'US',
 currency: 'USD',
 similarity: 100
 }]);
 } else {
 // Not a valid stock
 setSearchResults([]);
 }
 } catch (error) {
 console.error('Error validating stock:', error);
 setSearchResults([]);
 }
 } else {
 // Invalid format - don't show anything
 setSearchResults([]);
 }
 }
 } catch (error) {
 console.error('Error searching stocks:', error);
 setSearchResults([]);
 }
 setSearching(false);
 };

 useEffect(() => {
 const timer = setTimeout(() => {
 if (searchQuery) {
 searchStocks(searchQuery);
 } else {
 setSearchResults([]);
 setShowSearchResults(false);
 setError(null);
 }
 }, 500);
 return () => clearTimeout(timer);
 }, [searchQuery]);

 // Auto-redirect from code-display to trading view
 useEffect(() => {
 if (view === 'code-display') {
 const timer = setTimeout(() => {
 setView('trading');
 }, 2500); // Show welcome message for 2.5 seconds
 return () => clearTimeout(timer);
 }
 }, [view]);

 // Toast notification system
 const showToast = (message, type = 'info', duration = 5000) => {
 const id = Date.now() + Math.random();
 const newToast = { id, message, type, duration };
 setToasts(prev => [...prev, newToast]);

 // Auto-dismiss after duration
 if (duration > 0) {
 setTimeout(() => {
 dismissToast(id);
 }, duration);
 }
 };

 const dismissToast = (id) => {
 setToasts(prev => prev.map(toast =>
 toast.id === id ? { ...toast, closing: true } : toast
 ));

 // Remove from DOM after animation
 setTimeout(() => {
 setToasts(prev => prev.filter(toast => toast.id !== id));
 }, 300);
 };

 // Keyboard shortcuts
 useEffect(() => {
 const handleKeyPress = (e) => {
 // Focus search with /
 if (e.key === '/' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
 e.preventDefault();
 document.querySelector('input[type="text"]')?.focus();
 }

 // Close modals with Escape
 if (e.key === 'Escape') {
 setShowSearchResults(false);
 setQuantityError('');
 }

 // Quick buy with Ctrl/Cmd + B
 if ((e.ctrlKey || e.metaKey) && e.key === 'b' && selectedStock) {
 e.preventDefault();
 // Trigger buy if on trading screen
 if (view === 'trading') {
 setTradeType('long');
 }
 }

 // Quick sell with Ctrl/Cmd + S
 if ((e.ctrlKey || e.metaKey) && e.key === 's' && selectedStock) {
 e.preventDefault();
 // Trigger sell if on trading screen
 if (view === 'trading') {
 setTradeType('short');
 }
 }
 };

 window.addEventListener('keydown', handleKeyPress);
 return () => window.removeEventListener('keydown', handleKeyPress);
 }, [view, selectedStock]);

 const fetchStockData = async () => {
 if (watchlist.length === 0) return;

 try {
 setLoading(true);
 setError(null);

 // Fetch all stocks in parallel using Finnhub
 const promises = watchlist.map(async (symbol) => {
 try {
 // Get current quote
 const quoteResponse = await fetch(
 `${FINNHUB_API_BASE}/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`
 );
 const quoteData = await quoteResponse.json();

 console.log(`Finnhub ${symbol}:`, quoteData);

 const currentPrice = quoteData.c; // Current price
 const previousClose = quoteData.pc; // Previous close
 const priceChange = quoteData.d; // Change
 const changePercent = quoteData.dp; // Change percent
 const high = quoteData.h; // High
 const low = quoteData.l; // Low
 const open = quoteData.o; // Open

 return {
 symbol: symbol,
 name: getStockName(symbol),
 price: parseFloat((currentPrice || 0).toFixed(2)),
 change: parseFloat((changePercent || 0).toFixed(2)),
 volume: 'N/A',
 previousClose: previousClose || 0,
 high: high || currentPrice,
 low: low || currentPrice,
 open: open || currentPrice
 };
 } catch (error) {
 console.error(`Error fetching ${symbol}:`, error);
 return getFallbackStockData(symbol);
 }
 });

 const stocksData = await Promise.all(promises);

 if (stocksData.length > 0) {
 setStocks(stocksData);
 setLastUpdate(new Date());
 console.log('âœ… All stocks loaded with Finnhub real-time prices:', stocksData);
 }

 setLoading(false);
 } catch (error) {
 console.error('Error fetching stock data:', error);
 setError('Failed to load stock data. Using fallback prices.');

 const fallbackData = watchlist.map(symbol => getFallbackStockData(symbol));
 setStocks(fallbackData);
 setLastUpdate(new Date());
 setLoading(false);
 }
 };

 const getStockName = (symbol) => {
 const names = {
 'AAPL': 'Apple Inc.',
 'GOOGL': 'Alphabet Inc.',
 'MSFT': 'Microsoft Corp.',
 'AMZN': 'Amazon.com Inc.',
 'TSLA': 'Tesla Inc.',
 'NVDA': 'NVIDIA Corp.',
 'META': 'Meta Platforms',
 'NFLX': 'Netflix Inc.',
 'AMD': 'Advanced Micro Devices',
 'DIS': 'Walt Disney Co.'
 };
 return names[symbol] || symbol;
 };

 const formatVolume = (volume) => {
 if (!volume) return 'N/A';
 if (volume >= 1000000000) return `${(volume / 1000000000).toFixed(1)}B`;
 if (volume >= 1000000) return `${(volume / 1000000).toFixed(1)}M`;
 if (volume >= 1000) return `${(volume / 1000).toFixed(1)}K`;
 return volume.toString();
 };

 const getFallbackStockData = (symbol) => {
 // Use FALLBACK_STOCK_DATA from config.js
 return {
 symbol,
 name: getStockName(symbol),
 price: FALLBACK_STOCK_DATA[symbol]?.price || Math.random() * 200 + 50,
 change: FALLBACK_STOCK_DATA[symbol]?.change || (Math.random() - 0.5) * 10,
 volume: '10.5M'
 };
 };

 // Fetch live data for a single stock using Finnhub API
 const fetchSingleStock = async (symbol, stockName = null) => {
 try {
 const response = await fetch(
 `${FINNHUB_API_BASE}/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`
 );
 const data = await response.json();

 console.log(`Fetching single stock ${symbol}:`, data);

 if (data.c) {
 const currentPrice = data.c; // Current price
 const previousClose = data.pc; // Previous close
 const changePercent = data.dp; // Change percent
 const high = data.h; // High
 const low = data.l; // Low
 const open = data.o; // Open

 console.log(`âœ… Finnhub ${symbol}:`, {
 price: currentPrice,
 change: changePercent,
 previousClose: previousClose
 });

 return {
 symbol: symbol,
 name: stockName || getStockName(symbol),
 price: parseFloat((currentPrice || 0).toFixed(2)),
 change: parseFloat((changePercent || 0).toFixed(2)),
 volume: 'N/A',
 previousClose: previousClose || 0,
 high: high || currentPrice,
 low: low || currentPrice,
 open: open || currentPrice
 };
 } else {
 // Fallback if API fails
 console.warn(`No data for ${symbol}, using fallback`);
 const fallbackData = getFallbackStockData(symbol);
 if (stockName) fallbackData.name = stockName;
 return fallbackData;
 }
 } catch (error) {
 console.error(`Error fetching ${symbol}:`, error);
 const fallbackData = getFallbackStockData(symbol);
 if (stockName) fallbackData.name = stockName;
 return fallbackData;
 }
 };

 // Chat functions
 const sendChatMessage = () => {
 if (!chatInput.trim() || !socket) return;

 const message = {
 userName: userName || 'Guest',
 message: chatInput.trim(),
 timestamp: new Date().toISOString()
 };

 socket.emit('chat_message', message);
 setChatInput('');
 };

 const handleChatKeyPress = (e) => {
 if (e.key === 'Enter' && !e.shiftKey) {
 e.preventDefault();
 sendChatMessage();
 }
 };

 // Fetch market movers (top gainers and losers) from entire stock database
 const fetchMarketMovers = async () => {
 setLoadingMovers(true);
 setMoversProgress({ current: 0, total: STOCK_DATABASE.length });
 try {
 console.log('ðŸ”„ Fetching market movers from ALL stocks in database...');
 console.log(`ðŸ“Š Analyzing ${STOCK_DATABASE.length} stocks for real-time gainers and losers`);

 const stocksData = [];
 const batchSize = 50; // Process in batches to respect API rate limits (60/min)
 const delayBetweenBatches = 60000; // 1 minute delay between batches
 const totalBatches = Math.ceil(STOCK_DATABASE.length / batchSize);

 // Process stocks in batches
 for (let i = 0; i < STOCK_DATABASE.length; i += batchSize) {
 const batch = STOCK_DATABASE.slice(i, i + batchSize);
 const currentBatch = Math.floor(i/batchSize) + 1;
 console.log(`ðŸ“¦ Processing batch ${currentBatch}/${totalBatches}: ${batch.length} stocks`);

 // Fetch all stocks in this batch in parallel
 const batchPromises = batch.map(async (stockInfo) => {
 try {
 const response = await fetch(
 `${FINNHUB_API_BASE}/quote?symbol=${stockInfo.symbol}&token=${FINNHUB_API_KEY}`
 );
 const data = await response.json();

 if (data.c && data.dp !== undefined && !isNaN(data.dp)) {
 return {
 symbol: stockInfo.symbol,
 name: stockInfo.name,
 price: data.c,
 change: data.dp,
 changeValue: data.d,
 high: data.h,
 low: data.l,
 open: data.o,
 previousClose: data.pc
 };
 }
 return null;
 } catch (error) {
 console.error(`âŒ Error fetching ${stockInfo.symbol}:`, error);
 return null;
 }
 });

 const batchResults = await Promise.all(batchPromises);
 const validResults = batchResults.filter(stock => stock !== null);
 stocksData.push(...validResults);

 // Update progress
 setMoversProgress({ current: i + batch.length, total: STOCK_DATABASE.length });

 // Update intermediate results after each batch
 const sorted = stocksData.sort((a, b) => b.change - a.change);
 const gainers = sorted.slice(0, 10).filter(s => s.change > 0);
 const losers = sorted.slice(-10).reverse().filter(s => s.change < 0);
 setTopGainers(gainers);
 setTopLosers(losers);

 // If there are more batches, wait before proceeding (respect rate limits)
 if (i + batchSize < STOCK_DATABASE.length) {
 console.log('â³ Waiting 60s to respect API rate limits...');
 await new Promise(resolve => setTimeout(resolve, delayBetweenBatches));
 }
 }

 console.log(`âœ… Successfully fetched ${stocksData.length} stocks with valid data`);

 // Sort by percentage change
 const sorted = stocksData.sort((a, b) => b.change - a.change);

 // Top 10 gainers (highest positive change)
 const gainers = sorted.slice(0, 10).filter(s => s.change > 0);

 // Top 10 losers (lowest negative change)
 const losers = sorted.slice(-10).reverse().filter(s => s.change < 0);

 setTopGainers(gainers);
 setTopLosers(losers);

 console.log(`ðŸ“ˆ Top Gainers (${gainers.length}):`);
 gainers.forEach((stock, i) => {
 console.log(` ${i + 1}. ${stock.symbol}: +${stock.change.toFixed(2)}% (${stock.name})`);
 });

 console.log(`ðŸ“‰ Top Losers (${losers.length}):`);
 losers.forEach((stock, i) => {
 console.log(` ${i + 1}. ${stock.symbol}: ${stock.change.toFixed(2)}% (${stock.name})`);
 });

 } catch (error) {
 console.error('âŒ Error fetching market movers:', error);
 showToast('Failed to load market movers. Please try again.', 'error');
 } finally {
 setLoadingMovers(false);
 }
 };

 const addToWatchlist = async (symbol, stockName = null) => {
 if (watchlist.includes(symbol)) {
 // Already in watchlist, just select it
 setSelectedStock(symbol);
 setTradeAnalysisData(null); // Clear trade analysis when switching stocks
 setSearchQuery('');
 setShowSearchResults(false);
 setError(null);
 return;
 }

 // Show loading state
 setSearching(true);
 setError(null);

 // Fetch live data for this stock
 const stockData = await fetchSingleStock(symbol, stockName);

 // Add to watchlist
 const newWatchlist = [...watchlist, symbol];
 setWatchlist(newWatchlist);

 // Update portfolio with new watchlist
 const portfolio = getCurrentPortfolio();
 const updatedPortfolio = {
 ...portfolio,
 watchlist: newWatchlist
 };

 // Update local state
 setCompetition(prev => ({
 ...prev,
 members: prev.members.map(m =>
 m.id === currentUserId ? { ...m, portfolio: updatedPortfolio } : m
 )
 }));

 // Sync to backend server (non-blocking)
 if (plan === 'personal' && userEmail) {
 fetch(`${API_BASE_URL}/api/accounts/update-portfolio`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail,
 portfolio: updatedPortfolio
 })
 })
 .then(() => console.log('âœ… Watchlist synced to backend'))
 .catch(error => console.error('Error syncing watchlist to backend:', error));
 }

 // Add to stocks array or update if exists
 const existingIndex = stocks.findIndex(s => s.symbol === symbol);
 if (existingIndex >= 0) {
 const updatedStocks = [...stocks];
 updatedStocks[existingIndex] = stockData;
 setStocks(updatedStocks);
 } else {
 setStocks([...stocks, stockData]);
 }

 // Select the stock
 setSelectedStock(symbol);
 setTradeAnalysisData(null); // Clear trade analysis when switching stocks

 // Show success toast
 showToast(`â­ Added ${symbol} to watchlist`, 'success');

 // Clear search
 setSearchQuery('');
 setShowSearchResults(false);
 setSearching(false);
 };

 const removeFromWatchlist = (symbol) => {
 const newWatchlist = watchlist.filter(s => s !== symbol);
 setWatchlist(newWatchlist);
 setStocks(stocks.filter(s => s.symbol !== symbol));

 // Show info toast
 showToast(`Removed ${symbol} from watchlist`, 'info');

 // Update portfolio with new watchlist
 const portfolio = getCurrentPortfolio();
 const updatedPortfolio = {
 ...portfolio,
 watchlist: newWatchlist
 };

 // Update local state
 setCompetition(prev => ({
 ...prev,
 members: prev.members.map(m =>
 m.id === currentUserId ? { ...m, portfolio: updatedPortfolio } : m
 )
 }));

 // Sync to backend server (non-blocking)
 if (plan === 'personal' && userEmail) {
 fetch(`${API_BASE_URL}/api/accounts/update-portfolio`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail,
 portfolio: updatedPortfolio
 })
 })
 .then(() => console.log('âœ… Watchlist synced to backend'))
 .catch(error => console.error('Error syncing watchlist to backend:', error));
 }
 };

 useEffect(() => {
 if (view === 'trading' && watchlist.length > 0) {
 fetchStockData();

 // Auto-refresh stock prices every 30 seconds to update portfolio value
 const refreshInterval = setInterval(() => {
 console.log('ðŸ”„ Auto-refreshing stock prices...');
 fetchStockData();
 }, 30000); // 30 seconds

 return () => clearInterval(refreshInterval);
 }
 // eslint-disable-next-line react-hooks/exhaustive-deps
 }, [view, watchlist]);

 // Clear error when selected stock changes
 useEffect(() => {
 setQuantityError('');
 setQuantity(1);
 }, [selectedStock]);

 const getCurrentPortfolio = () => {
 const defaultPortfolio = {
 cash: 100000,
 positions: {},
 shortPositions: {},
 history: [],
 lastBuyTime: {},
 watchlist: [],
 performanceHistory: [] // Track daily portfolio values for analytics
 };

 if (plan === 'personal') {
 const portfolio = competition?.members[0]?.portfolio || defaultPortfolio;
 return portfolio;
 }
 const member = competition?.members.find(m => m.id === currentUserId);
 const portfolio = member?.portfolio || defaultPortfolio;
 return portfolio;
 };

 const calculatePortfolioValue = (portfolio) => {
 if (!portfolio || typeof portfolio.cash !== 'number') {
 return 100000; // Default starting value
 }

 let positionsValue = 0;
 if (portfolio.positions && stocks.length > 0) {
 Object.entries(portfolio.positions).forEach(([symbol, qty]) => {
 const stock = stocks.find(s => s.symbol === symbol);
 if (stock && typeof stock.price === 'number' && typeof qty === 'number') {
 positionsValue += stock.price * qty;
 }
 });
 }

 const totalValue = portfolio.cash + positionsValue;
 return isNaN(totalValue) ? 100000 : totalValue;
 };

 // Removed old fetchTopStocks function - replaced by fetchMarketMovers with proper rate limiting


 const generateCompetitionCode = () => {
 return Math.random().toString(36).substring(2, 8).toUpperCase();
 };

 const generatePasscode = () => {
 // Generate 6-digit passcode
 return Math.floor(100000 + Math.random() * 900000).toString();
 };

 // Password strength checker
 const checkPasswordStrength = (password) => {
 if (!password) return null;

 const requirements = {
 minLength: password.length >= 8,
 hasUpperCase: /[A-Z]/.test(password),
 hasLowerCase: /[a-z]/.test(password),
 hasNumber: /[0-9]/.test(password),
 hasSpecial: /[!@#$%^&*(),.?":{}|<>]/.test(password)
 };

 const metRequirements = Object.values(requirements).filter(Boolean).length;

 let strength = 'weak';
 let color = 'red';
 if (metRequirements >= 5) {
 strength = 'strong';
 color = 'green';
 } else if (metRequirements >= 3) {
 strength = 'medium';
 color = 'yellow';
 }

 return {
 strength,
 color,
 requirements,
 score: metRequirements
 };
 };

 const createCompetition = async (memberName, contributionAmount, password = null) => {
 const code = generateCompetitionCode();
 const memberId = Date.now().toString();
 const isPersonalPlan = parseFloat(contributionAmount || 0) === 0;

 try {
 // Personal plans use backend server
 if (isPersonalPlan) {
 console.log('Creating personal account with backend server');

 const initialPortfolio = {
 cash: 100000,
 positions: {},
 history: [],
 lastBuyTime: {},
 watchlist: []
 };

 const passcode = generatePasscode();

 // Create account on backend server
 const response = await fetch(`${API_BASE_URL}/api/accounts/create`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail,
 userName: memberName,
 password: password,
 accountCode: code,
 portfolio: initialPortfolio
 })
 });

 const data = await response.json();

 if (!response.ok) {
 console.error('âŒ Account creation failed:', data.error);
 if (response.status === 400 && data.error && data.error.includes('already exists')) {
 throw new Error('An account with this email already exists. Please sign in instead or use a different email.');
 } else {
 throw new Error(data.error || 'Failed to create account. Please try again.');
 }
 }

 setGeneratedPasscode(passcode);

 const newCompetition = {
 code: code,
 totalPool: 0,
 startTime: new Date().toISOString(),
 members: [{
 id: memberId,
 name: memberName,
 contribution: 0,
 portfolio: initialPortfolio,
 joinedAt: new Date().toISOString()
 }]
 };

 setCompetition(newCompetition);
 setCompetitionCode(code);
 setCurrentUserId(memberId);
 setView('code-display');
 console.log('âœ… Personal account created successfully:', code);
 return;
 }

 // Family plans - not currently supported
 throw new Error('Family plans are not currently available. Please use a Personal plan instead.');
 } catch (error) {
 console.error('Error creating competition:', error);
 throw error;
 }
 };

 const joinCompetition = async (code, memberName, contributionAmount) => {
 alert('Join competition feature is not currently available. Please create a Personal account instead.');
 return;
 };

 const signInWithEmailAndPasscode = async (email, passcode) => {
 // This function is deprecated - use backend API login instead
 console.warn('signInWithEmailAndPasscode is deprecated. Use backend API login.');
 alert('Please use the Sign In button instead.');
 };

 const signInToPersonalAccount = async (accountCode) => {
 // This function is deprecated - use backend API login instead
 console.warn('signInToPersonalAccount is deprecated. Use backend API login.');
 alert('Please use the Sign In button with your email and password.');
 };

 // Helper to calculate max shares you can buy
 const getMaxBuyQuantity = (stockSymbol) => {
 const stock = stocks.find(s => s.symbol === stockSymbol);
 if (!stock) return 0;
 const portfolio = getCurrentPortfolio();
 return Math.floor(portfolio.cash / stock.price);
 };

 // Helper to get current position
 const getCurrentPosition = (stockSymbol) => {
 const portfolio = getCurrentPortfolio();
 return portfolio.positions[stockSymbol] || 0;
 };

 // Helper to validate and set quantity
 const handleQuantityChange = (newQuantity, isBuy = true) => {
 const num = parseInt(newQuantity) || 0;

 if (num < 0) {
 setQuantityError('Quantity cannot be negative');
 return;
 }

 if (!selectedStock) {
 setQuantity(Math.max(1, num));
 setQuantityError('');
 return;
 }

 const stock = stocks.find(s => s.symbol === selectedStock);
 if (!stock) {
 setQuantity(Math.max(1, num));
 setQuantityError('');
 return;
 }

 const portfolio = getCurrentPortfolio();
 const maxBuy = getMaxBuyQuantity(selectedStock);
 const maxSell = getCurrentPosition(selectedStock);

 // If manually typing, check limits
 if (num > maxBuy) {
 const totalCost = stock.price * num;
 setQuantityError(`âš ï¸ Insufficient funds! You need $${totalCost.toFixed(2)} but only have $${portfolio.cash.toFixed(2)}. Max: ${maxBuy} shares`);
 setQuantity(num); // Still set it so they can see what they typed
 } else if (num > maxSell && !isBuy) {
 setQuantityError(`âš ï¸ You only own ${maxSell} shares of ${selectedStock}`);
 setQuantity(num);
 } else {
 setQuantityError('');
 setQuantity(Math.max(1, num));
 }
 };

 // Buy max shares
 const buyMax = () => {
 if (!selectedStock) return;
 const maxShares = getMaxBuyQuantity(selectedStock);
 if (maxShares === 0) {
 setQuantityError('âš ï¸ Insufficient funds to buy any shares');
 setQuantity(1);
 } else {
 setQuantity(maxShares);
 setQuantityError('');
 }
 };

 // Sell max shares
 const sellMax = () => {
 if (!selectedStock) return;
 const maxShares = getCurrentPosition(selectedStock);
 if (maxShares === 0) {
 setQuantityError(`âš ï¸ You don't own any shares of ${selectedStock}`);
 setQuantity(1);
 } else {
 setQuantity(maxShares);
 setQuantityError('');
 }
 };

 // Execute short sell
 const executeShortSell = async () => {
 if (!selectedStock || quantity <= 0) return;

 // Check if market is open
 if (!marketOpen) {
 showToast(`Market is closed. ${currentHoliday ? `Today is ${currentHoliday}.` : ''} Next trading session: ${nextMarketOpenTime}`, 'error', 8000);
 return;
 }

 const stock = stocks.find(s => s.symbol === selectedStock);
 if (!stock) {
 alert('Stock data not available. Please add to watchlist and refresh.');
 return;
 }

 const portfolio = getCurrentPortfolio();
 const validation = window.shortSelling.validateShort(portfolio, selectedStock, stock.price, quantity);

 if (!validation.isValid) {
 alert('âŒ Cannot short:\n' + validation.errors.join('\n'));
 return;
 }

 const updatedPortfolio = window.shortSelling.executeShort(
 {...portfolio},
 selectedStock,
 stock.price,
 quantity
 );

 // Update state
 setCompetition(prev => ({
 ...prev,
 members: prev.members.map(m =>
 m.id === currentUserId ? { ...m, portfolio: updatedPortfolio } : m
 )
 }));

 // Sync to backend server for personal accounts
 if (plan === 'personal' && userEmail) {
 try {
 await fetch(`${API_BASE_URL}/api/accounts/update-portfolio`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail,
 portfolio: updatedPortfolio
 })
 });
 console.log('âœ… Portfolio synced to backend');
 } catch (error) {
 console.error('Error syncing portfolio to backend:', error);
 }
 }

 alert(`âœ… Shorted ${quantity} shares of ${selectedStock} @ $${stock.price.toFixed(2)}`);
 setQuantity(1);
 setQuantityError('');
 };

 // Execute cover short
 const executeCoverShort = async () => {
 if (!selectedStock || quantity <= 0) return;

 // Check if market is open
 if (!marketOpen) {
 showToast(`Market is closed. ${currentHoliday ? `Today is ${currentHoliday}.` : ''} Next trading session: ${nextMarketOpenTime}`, 'error', 8000);
 return;
 }

 const stock = stocks.find(s => s.symbol === selectedStock);
 if (!stock) return;

 const portfolio = getCurrentPortfolio();
 const validation = window.shortSelling.validateCover(portfolio, selectedStock, stock.price, quantity);

 if (!validation.isValid) {
 alert('âŒ Cannot cover:\n' + validation.errors.join('\n'));
 return;
 }

 const { portfolio: updatedPortfolio, profitLoss } = window.shortSelling.executeCover(
 {...portfolio},
 selectedStock,
 stock.price,
 quantity,
 stocks
 );

 // Update state
 setCompetition(prev => ({
 ...prev,
 members: prev.members.map(m =>
 m.id === currentUserId ? { ...m, portfolio: updatedPortfolio } : m
 )
 }));

 // Sync to backend server for personal accounts
 if (plan === 'personal' && userEmail) {
 try {
 await fetch(`${API_BASE_URL}/api/accounts/update-portfolio`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail,
 portfolio: updatedPortfolio
 })
 });
 console.log('âœ… Portfolio synced to backend');
 } catch (error) {
 console.error('Error syncing portfolio to backend:', error);
 }
 }

 alert(`âœ… Covered ${quantity} shares of ${selectedStock}\nP/L: ${profitLoss >= 0 ? '+' : ''}$${profitLoss.toFixed(2)}`);
 setQuantity(1);
 setQuantityError('');
 };

 // Load news for selected stock (with live updates)
 const loadStockNews = async () => {
 if (!selectedStock) return;
 setLoadingNews(true);
 try {
 console.log(`ðŸ“° Loading news for ${selectedStock}...`);
 const news = await window.newsFeed.fetchStockNews(selectedStock, FINNHUB_API_KEY);
 setStockNews(news);
 setLastStockNewsUpdate(new Date()); // Track when news was updated
 } catch (error) {
 console.error('Error loading news:', error);
 setStockNews([]);
 }
 setLoadingNews(false);
 };

 // Load general market news
 const loadMarketNews = async () => {
 setLoadingMarketNews(true);
 try {
 const news = await window.newsFeed.fetchMarketNews(FINNHUB_API_KEY);
 setMarketNews(news);
 setLastNewsUpdate(new Date()); // Track when news was updated
 } catch (error) {
 console.error('Error loading market news:', error);
 setMarketNews([]);
 }
 setLoadingMarketNews(false);
 };

 // AI Trade Analysis with"UltraThink" deep reasoning - REAL DATA DRIVEN
 const generateAIAnalysis = async () => {
 if (!selectedStock) return;

 setLoadingAnalysis(true);
 setAnalysisExpanded(true);

 // Simulate AI analysis with deep thinking
 await new Promise(resolve => setTimeout(resolve, 2000));

 const stock = stocks.find(s => s.symbol === selectedStock);
 if (!stock) {
 setLoadingAnalysis(false);
 return;
 }

 console.log('ðŸ§  Generating AI analysis with REAL data for:', stock);

 // REAL DATA: Extract all stock metrics
 const price = stock.price || 0;
 const high = stock.high || price;
 const low = stock.low || price;
 const open = stock.open || price;
 const previousClose = stock.previousClose || price;
 const priceChange = stock.change || 0;

 // REAL CALCULATION: Enhanced RSI (Relative Strength Index) using historical data
 const calculateEnhancedRSI = async () => {
 try {
 // Fetch 14 days of historical data for proper RSI calculation
 const toDate = Math.floor(Date.now() / 1000);
 const fromDate = toDate - (14 * 24 * 60 * 60); // 14 days

 const response = await fetch(
 `${FINNHUB_API_BASE}/stock/candle?symbol=${selectedStock}&resolution=D&from=${fromDate}&to=${toDate}&token=${FINNHUB_API_KEY}`
 );
 const data = await response.json();

 if (data.s === 'ok' && data.c && data.c.length >= 14) {
 const closes = data.c;

 // Calculate 14-day RSI
 let gains = 0;
 let losses = 0;

 for (let i = 1; i < closes.length; i++) {
 const change = closes[i] - closes[i - 1];
 if (change > 0) {
 gains += change;
 } else {
 losses += Math.abs(change);
 }
 }

 const avgGain = gains / (closes.length - 1);
 const avgLoss = (losses / (closes.length - 1)) + 0.0001; // Prevent division by zero
 const rs = avgGain / avgLoss;
 const rsi = 100 - (100 / (1 + rs));

 return Math.max(0, Math.min(100, rsi));
 }
 } catch (error) {
 console.log('âš ï¸ Using simplified RSI due to API error');
 }

 // Fallback to simplified RSI if API fails
 const priceChangeAmount = price - previousClose;
 const gain = Math.max(0, priceChangeAmount);
 const loss = Math.max(0, -priceChangeAmount);

 if (gain === 0 && loss === 0) return 50;

 const avgGain = (gain / previousClose) * 100;
 const avgLoss = (loss / previousClose) * 100 + 0.01;
 const rs = avgGain / avgLoss;
 const rsi = 100 - (100 / (1 + rs));

 return Math.max(0, Math.min(100, rsi));
 };

 const rsi = await calculateEnhancedRSI();
 console.log('ðŸ“Š Real 14-day RSI calculated:', rsi.toFixed(1));

 // REAL CALCULATION: Moving Averages (50-day and 200-day)
 const calculateMovingAverages = async () => {
 try {
 const toDate = Math.floor(Date.now() / 1000);
 const fromDate = toDate - (250 * 24 * 60 * 60); // 250 days for 200-day MA

 const response = await fetch(
 `${FINNHUB_API_BASE}/stock/candle?symbol=${selectedStock}&resolution=D&from=${fromDate}&to=${toDate}&token=${FINNHUB_API_KEY}`
 );
 const data = await response.json();

 if (data.s === 'ok' && data.c && data.c.length > 0) {
 const closes = data.c;

 // 50-day MA
 let ma50 = null;
 if (closes.length >= 50) {
 const last50 = closes.slice(-50);
 ma50 = last50.reduce((sum, val) => sum + val, 0) / 50;
 }

 // 200-day MA
 let ma200 = null;
 if (closes.length >= 200) {
 const last200 = closes.slice(-200);
 ma200 = last200.reduce((sum, val) => sum + val, 0) / 200;
 }

 return { ma50, ma200 };
 }
 } catch (error) {
 console.log('âš ï¸ Could not fetch moving averages');
 }
 return { ma50: null, ma200: null };
 };

 const { ma50, ma200 } = await calculateMovingAverages();
 console.log('ðŸ“ˆ Moving Averages - MA50:', ma50?.toFixed(2), 'MA200:', ma200?.toFixed(2));

 // Trend analysis from moving averages
 const trendSignal = ma50 && ma200 ?
 (ma50 > ma200 && price > ma50 ? 'Strong Uptrend (Golden Cross)' :
 ma50 > ma200 ? 'Uptrend' :
 ma50 < ma200 && price < ma50 ? 'Strong Downtrend (Death Cross)' :
 'Downtrend') :
 (price > previousClose ? 'Upward' : 'Downward');

 // REAL CALCULATION: Intraday Volatility from high/low range
 const intradayVolatility = ((high - low) / low * 100);
 console.log('ðŸ“ˆ Real intraday volatility:', intradayVolatility.toFixed(2) + '%');

 // REAL CALCULATION: Price momentum
 const momentum = ((price - open) / open * 100);
 console.log('âš¡ Real price momentum:', momentum.toFixed(2) + '%');

 // REAL CALCULATION: Support and Resistance from actual price action
 const support = ma50 ? Math.min(ma50, low * 0.98).toFixed(2) : (low * 0.98).toFixed(2);
 const resistance = ma50 ? Math.max(ma50 * 1.02, high * 1.02).toFixed(2) : (high * 1.02).toFixed(2);

 // TECHNICAL ANALYSIS based on real RSI and momentum
 const isOverbought = rsi > 70;
 const isOversold = rsi < 30;
 const technicalSignal = isOverbought ? 'Overbought - Consider Selling' :
 isOversold ? 'Oversold - Consider Buying' :
 rsi > 60 ? 'Strong Bullish' :
 rsi > 50 ? 'Bullish' :
 rsi < 40 ? 'Bearish' :
 rsi < 30 ? 'Strong Bearish' : 'Neutral';

 // REAL NEWS SENTIMENT ANALYSIS with weighted scoring
 let sentimentScore = 0;
 let positiveCount = 0;
 let negativeCount = 0;
 let neutralCount = 0;

 if (stockNews.length > 0) {
 // Weight recent news more heavily (time decay factor)
 stockNews.forEach((article, index) => {
 const recencyWeight = 1 - (index / stockNews.length) * 0.3; // 30% decay

 if (article.sentiment === 'positive') {
 sentimentScore += 1 * recencyWeight;
 positiveCount++;
 } else if (article.sentiment === 'negative') {
 sentimentScore -= 1 * recencyWeight;
 negativeCount++;
 } else {
 neutralCount++;
 }
 });

 // Normalize to -100 to +100 scale
 sentimentScore = (sentimentScore / stockNews.length) * 100;
 }

 console.log('ðŸ“° Real sentiment score:', sentimentScore, 'from', stockNews.length, 'articles');

 const newsSignal = sentimentScore > 50 ? 'Very Positive' :
 sentimentScore > 20 ? 'Positive' :
 sentimentScore < -50 ? 'Very Negative' :
 sentimentScore < -20 ? 'Negative' : 'Neutral';

 // REAL RISK ASSESSMENT
 const volatilityRisk = intradayVolatility > 5 ? 3 : intradayVolatility > 2 ? 2 : 1;
 const sentimentRisk = Math.abs(sentimentScore) > 70 ? 2 : Math.abs(sentimentScore) > 40 ? 1 : 0;
 const liquidityRisk = stockNews.length < 3 ? 2 : stockNews.length < 5 ? 1 : 0;
 const rsiRisk = (isOverbought || isOversold) ? 2 : 1;

 const totalRiskScore = volatilityRisk + sentimentRisk + liquidityRisk + rsiRisk;
 const riskLevel = totalRiskScore >= 7 ? 'High' : totalRiskScore >= 4 ? 'Moderate' : 'Low';
 const riskRating = totalRiskScore;

 console.log('âš ï¸ Real risk assessment:', riskLevel, '| Score:', riskRating);

 // COMPREHENSIVE RECOMMENDATION based on multiple real factors
 const technicalScore = rsi > 50 ? (rsi - 50) / 10 : -(50 - rsi) / 10;
 const sentimentScoreNormalized = sentimentScore / 25; // Scale to similar range
 const momentumScore = momentum / 2;

 // Moving average trend score
 let trendScore = 0;
 if (ma50 && ma200) {
 if (ma50 > ma200 && price > ma50) trendScore = 4; // Strong uptrend
 else if (ma50 > ma200) trendScore = 2; // Uptrend
 else if (ma50 < ma200 && price < ma50) trendScore = -4; // Strong downtrend
 else trendScore = -2; // Downtrend
 } else if (ma50) {
 trendScore = price > ma50 ? 2 : -2;
 }

 // Adjust for overbought/oversold
 let adjustedTechnicalScore = technicalScore;
 if (isOverbought) adjustedTechnicalScore -= 3;
 if (isOversold) adjustedTechnicalScore += 3;

 // Enhanced weighted composite score: Technical (30%), Sentiment (25%), Momentum (20%), Trend (25%)
 const compositeScore = (adjustedTechnicalScore * 0.3) + (sentimentScoreNormalized * 0.25) + (momentumScore * 0.2) + (trendScore * 0.25);

 // Risk-adjusted confidence
 const riskAdjustment = riskLevel === 'High' ? -15 : riskLevel === 'Moderate' ? -5 : 0;

 const overallRecommendation = (() => {
 if (compositeScore > 3) return { action: 'Strong Buy', confidence: Math.min(95, 80 + compositeScore + riskAdjustment), color: 'green' };
 if (compositeScore > 1) return { action: 'Buy', confidence: Math.min(85, 70 + compositeScore + riskAdjustment), color: 'green' };
 if (compositeScore < -3) return { action: 'Strong Sell', confidence: Math.min(90, 75 - compositeScore + riskAdjustment), color: 'red' };
 if (compositeScore < -1) return { action: 'Sell', confidence: Math.min(80, 65 - compositeScore + riskAdjustment), color: 'red' };
 return { action: 'Hold', confidence: Math.min(75, 55 + Math.abs(compositeScore) + riskAdjustment), color: 'yellow' };
 })();

 console.log('ðŸ’¡ Final recommendation:', overallRecommendation.action, 'at', overallRecommendation.confidence.toFixed(1) + '% confidence');

 // Calculate realistic stop loss and take profit using ATR concept
 const atr = high - low; // Average True Range (simplified)
 const stopLossDistance = atr * 1.5;
 const takeProfitDistance = atr * 3; // 2:1 reward/risk ratio

 const analysis = {
 symbol: selectedStock,
 name: stock.name,
 timestamp: new Date().toLocaleString(),

 technical: {
 signal: technicalSignal,
 trend: trendSignal,
 priceChange: priceChange.toFixed(2),
 currentPrice: price.toFixed(2),
 support: support,
 resistance: resistance,
 rsi: rsi.toFixed(1),
 ma50: ma50?.toFixed(2) || 'N/A',
 ma200: ma200?.toFixed(2) || 'N/A',
 momentum: momentum.toFixed(2),
 volatility: intradayVolatility.toFixed(2),
 open: open.toFixed(2),
 high: high.toFixed(2),
 low: low.toFixed(2),
 previousClose: previousClose.toFixed(2)
 },

 sentiment: {
 signal: newsSignal,
 score: sentimentScore.toFixed(0),
 articlesAnalyzed: stockNews.length,
 positiveCount,
 negativeCount,
 neutralCount,
 trending: stockNews.length > 10 ? 'Very High Interest' :
 stockNews.length > 5 ? 'High Interest' :
 stockNews.length > 2 ? 'Moderate Interest' : 'Low Interest'
 },

 risk: {
 level: riskLevel,
 rating: riskRating,
 volatilityRisk,
 sentimentRisk,
 liquidityRisk,
 factors: [
 `Volatility: ${intradayVolatility.toFixed(2)}% intraday range (${volatilityRisk === 3 ? 'High' : volatilityRisk === 2 ? 'Moderate' : 'Low'} risk)`,
 `Sentiment: ${Math.abs(sentimentScore).toFixed(0)} intensity (${sentimentRisk === 2 ? 'High' : sentimentRisk === 1 ? 'Moderate' : 'Low'} risk)`,
 `Liquidity: ${stockNews.length} news articles (${liquidityRisk === 2 ? 'High' : liquidityRisk === 1 ? 'Moderate' : 'Low'} risk)`,
 `RSI: ${rsi.toFixed(1)} ${isOverbought ? '(Overbought)' : isOversold ? '(Oversold)' : '(Normal)'}`
 ]
 },

 recommendation: {
 action: overallRecommendation.action,
 confidence: overallRecommendation.confidence.toFixed(1),
 color: overallRecommendation.color,
 reasoning: [
 `ðŸ“Š Real 14-day RSI at ${rsi.toFixed(1)} shows ${technicalSignal.toLowerCase()} conditions with ${momentum >= 0 ? 'positive' : 'negative'} momentum (${momentum >= 0 ? '+' : ''}${momentum.toFixed(2)}% from open)`,
 `ðŸ“ˆ Trend Analysis: ${trendSignal}${ma50 && ma200 ? ` (MA50: $${ma50.toFixed(2)}, MA200: $${ma200.toFixed(2)}, Current: $${price.toFixed(2)})` : ''}`,
 `ðŸ“° Sentiment analysis of ${stockNews.length} articles: ${positiveCount} positive, ${negativeCount} negative, ${neutralCount} neutral (Score: ${sentimentScore.toFixed(0)}/100)`,
 `âš¡ Intraday volatility at ${intradayVolatility.toFixed(2)}% with ${riskLevel.toLowerCase()} risk profile (Risk score: ${riskRating}/10)`,
 `ðŸ’¡ ${overallRecommendation.action === 'Strong Buy' || overallRecommendation.action === 'Buy' ?
 `Multiple indicators align for bullish entry. ${trendSignal.includes('Uptrend') ? 'Trend supports upward move.' : ''} Consider ${momentum > 0 ? 'buying on strength' : 'buying on dips near support at $${support}'}` :
 overallRecommendation.action === 'Strong Sell' || overallRecommendation.action === 'Sell' ?
 `Multiple indicators suggest caution. ${trendSignal.includes('Downtrend') ? 'Trend shows weakness.' : ''} ${isOverbought ? 'RSI overbought suggests profit-taking' : 'Consider protective stops or exit strategies'}` :
 `Mixed signals warrant patience. ${trendSignal} trend requires confirmation. Wait for ${rsi < 50 ? 'upward momentum' : 'clearer direction'} before committing capital`}`
 ],
 strategy: overallRecommendation.action === 'Strong Buy' || overallRecommendation.action === 'Buy' ?
 'Long position with tight stops' :
 overallRecommendation.action === 'Strong Sell' || overallRecommendation.action === 'Sell' ?
 'Exit or short with defined risk' : 'Cash or wait for setup',
 targets: {
 entry: price.toFixed(2),
 stopLoss: Math.max(0, price - stopLossDistance).toFixed(2),
 takeProfit: (price + takeProfitDistance).toFixed(2),
 riskRewardRatio: '2:1'
 }
 }
 };

 console.log('âœ… AI Analysis complete with REAL data:', analysis);
 setAiAnalysis(analysis);
 setLoadingAnalysis(false);
 };

 // Market Hours Detection Functions
 const getEasterDate = (year) => {
 // Simplified Easter calculation (Meeus/Jones/Butcher algorithm)
 const a = year % 19;
 const b = Math.floor(year / 100);
 const c = year % 100;
 const d = Math.floor(b / 4);
 const e = b % 4;
 const f = Math.floor((b + 8) / 25);
 const g = Math.floor((b - f + 1) / 3);
 const h = (19 * a + b - d - g + 15) % 30;
 const i = Math.floor(c / 4);
 const k = c % 4;
 const l = (32 + 2 * e + 2 * i - h - k) % 7;
 const m = Math.floor((a + 11 * h + 22 * l) / 451);
 const month = Math.floor((h + l - 7 * m + 114) / 31) - 1; // 0-indexed
 const day = ((h + l - 7 * m + 114) % 31) + 1;
 return new Date(year, month, day);
 };

 const isMarketHoliday = (date) => {
 const year = date.getFullYear();
 const month = date.getMonth(); // 0-indexed
 const day = date.getDate();
 const dayOfWeek = date.getDay();

 // Fixed holidays
 const holidays = {
 'New Year\'s Day': month === 0 && day === 1,
 'Juneteenth': month === 5 && day === 19,
 'Independence Day': month === 6 && day === 4,
 'Christmas': month === 11 && day === 25
 };

 // Check fixed holidays
 for (const [name, isHoliday] of Object.entries(holidays)) {
 if (isHoliday) {
 setCurrentHoliday(name);
 return true;
 }
 }

 // MLK Day - 3rd Monday in January
 if (month === 0 && dayOfWeek === 1) {
 const weekOfMonth = Math.ceil(day / 7);
 if (weekOfMonth === 3) {
 setCurrentHoliday('Martin Luther King Jr. Day');
 return true;
 }
 }

 // Presidents Day - 3rd Monday in February
 if (month === 1 && dayOfWeek === 1) {
 const weekOfMonth = Math.ceil(day / 7);
 if (weekOfMonth === 3) {
 setCurrentHoliday('Presidents\' Day');
 return true;
 }
 }

 // Memorial Day - Last Monday in May
 if (month === 4 && dayOfWeek === 1) {
 const nextWeek = new Date(date);
 nextWeek.setDate(day + 7);
 if (nextWeek.getMonth() !== 4) {
 setCurrentHoliday('Memorial Day');
 return true;
 }
 }

 // Labor Day - 1st Monday in September
 if (month === 8 && dayOfWeek === 1 && day <= 7) {
 setCurrentHoliday('Labor Day');
 return true;
 }

 // Thanksgiving - 4th Thursday in November
 if (month === 10 && dayOfWeek === 4) {
 const weekOfMonth = Math.ceil(day / 7);
 if (weekOfMonth === 4) {
 setCurrentHoliday('Thanksgiving Day');
 return true;
 }
 }

 // Good Friday - Friday before Easter
 const easter = getEasterDate(year);
 const goodFriday = new Date(easter);
 goodFriday.setDate(easter.getDate() - 2);
 if (month === goodFriday.getMonth() && day === goodFriday.getDate()) {
 setCurrentHoliday('Good Friday');
 return true;
 }

 setCurrentHoliday(null);
 return false;
 };

 const isMarketOpenNow = () => {
 // Get current time in ET timezone
 const now = new Date();
 const etTime = new Date(now.toLocaleString("en-US", {timeZone:"America/New_York"}));

 const day = etTime.getDay(); // 0 = Sunday, 6 = Saturday
 const hours = etTime.getHours();
 const minutes = etTime.getMinutes();

 // Check if weekend
 if (day === 0 || day === 6) return false;

 // Check if holiday
 if (isMarketHoliday(etTime)) return false;

 // Check hours (9:30 AM - 4:00 PM)
 const currentTime = hours * 60 + minutes; // Convert to minutes
 const marketOpen = 9 * 60 + 30; // 9:30 AM in minutes
 const marketClose = 16 * 60; // 4:00 PM in minutes

 return currentTime >= marketOpen && currentTime < marketClose;
 };

 const getNextMarketOpen = () => {
 const now = new Date();
 let nextOpen = new Date(now.toLocaleString("en-US", {timeZone:"America/New_York"}));

 // If currently during market hours, return today's close time for countdown purposes
 if (isMarketOpenNow()) {
 nextOpen.setHours(16, 0, 0, 0); // Market closes at 4:00 PM
 return nextOpen;
 }

 // Start checking from tomorrow if after hours today
 const hours = nextOpen.getHours();
 const minutes = nextOpen.getMinutes();
 const currentTime = hours * 60 + minutes;

 if (currentTime >= 16 * 60) {
 // After market close, check next day
 nextOpen.setDate(nextOpen.getDate() + 1);
 }

 // Find next valid trading day
 let attempts = 0;
 while (attempts < 10) { // Safety limit
 nextOpen.setHours(9, 30, 0, 0);

 const day = nextOpen.getDay();
 if (day === 0 || day === 6) {
 // Skip weekends
 nextOpen.setDate(nextOpen.getDate() + 1);
 attempts++;
 continue;
 }

 if (isMarketHoliday(nextOpen)) {
 // Skip holidays
 nextOpen.setDate(nextOpen.getDate() + 1);
 attempts++;
 continue;
 }

 break;
 }

 return nextOpen;
 };

 const formatCountdown = (ms) => {
 const totalSeconds = Math.floor(ms / 1000);
 const hours = Math.floor(totalSeconds / 3600);
 const minutes = Math.floor((totalSeconds % 3600) / 60);
 const seconds = totalSeconds % 60;

 if (hours > 24) {
 const days = Math.floor(hours / 24);
 const remainingHours = hours % 24;
 return `${days}d ${remainingHours}h ${minutes}m`;
 }

 if (hours > 0) {
 return `${hours}h ${minutes}m ${seconds}s`;
 }

 return `${minutes}m ${seconds}s`;
 };

 // Update market status every second
 useEffect(() => {
 const updateMarketStatus = () => {
 const isOpen = isMarketOpenNow();
 setMarketOpen(isOpen);

 const nextChange = getNextMarketOpen();
 const now = new Date();
 const etNow = new Date(now.toLocaleString("en-US", {timeZone:"America/New_York"}));
 const timeDiff = nextChange - etNow;

 setTimeUntilChange(formatCountdown(timeDiff));

 // Format next open time
 const options = {
 weekday: 'long',
 month: 'short',
 day: 'numeric',
 hour: 'numeric',
 minute: '2-digit',
 timeZone: 'America/New_York'
 };
 setNextMarketOpenTime(nextChange.toLocaleString('en-US', options) + ' ET');
 };

 // Initial update
 updateMarketStatus();

 // Update every second
 const interval = setInterval(updateMarketStatus, 1000);

 return () => clearInterval(interval);
 }, []);

 const executeTrade = async (type) => {
 if (!selectedStock || quantity <= 0) return;

 // Check if market is open
 if (!marketOpen) {
 showToast(`Market is closed. ${currentHoliday ? `Today is ${currentHoliday}.` : ''} Next trading session: ${nextMarketOpenTime}`, 'error', 8000);
 return;
 }

 const stock = stocks.find(s => s.symbol === selectedStock);
 if (!stock) {
 showToast('Stock data not available. Please add to watchlist and refresh.', 'error');
 return;
 }

 const totalCost = stock.price * quantity;
 const portfolio = getCurrentPortfolio();
 const COOLDOWN_MINUTES = 15;
 const COOLDOWN_MS = COOLDOWN_MINUTES * 60 * 1000;

 // Calculate trading fee based on plan
 let tradingFee = 0;
 if (plan === 'family-public') {
 tradingFee = totalCost * 0.01; // 1% fee
 } else if (plan === 'family-private') {
 tradingFee = 0.05; // $0.05 flat fee
 }

 if (type === 'buy') {
 const totalWithFee = totalCost + tradingFee;
 if (totalWithFee > portfolio.cash) {
 showToast(`Insufficient funds! Total: $${totalWithFee.toFixed(2)} - You have $${portfolio.cash.toFixed(2)} available.`, 'error');
 return;
 }
 } else {
 // SELL - Check position
 console.log('ðŸ” Checking sell position for', selectedStock);
 console.log('ðŸ“Š All positions:', portfolio.positions);
 const currentPosition = portfolio.positions[selectedStock] || 0;
 console.log(`ðŸ“ˆ ${selectedStock} position:`, currentPosition);
 console.log('ðŸ”¢ Trying to sell:', quantity);
 if (quantity > currentPosition) {
 showToast(`Insufficient shares! You only own ${currentPosition} shares of ${selectedStock}`, 'error');
 return;
 }

 // Check 15-minute cooldown
 const lastBuyTime = portfolio.lastBuyTime?.[selectedStock];
 if (lastBuyTime) {
 const timeSinceBuy = Date.now() - new Date(lastBuyTime).getTime();
 const minutesSinceBuy = Math.floor(timeSinceBuy / 60000);

 if (timeSinceBuy < COOLDOWN_MS) {
 const minutesRemaining = COOLDOWN_MINUTES - minutesSinceBuy;
 const secondsRemaining = Math.ceil((COOLDOWN_MS - timeSinceBuy) / 1000) % 60;
 showToast(`â³ Trading Cooldown! Wait ${minutesRemaining}m ${secondsRemaining}s before selling ${selectedStock}`, 'warning', 8000);
 return;
 }
 }
 }

 // Show fee notification for family plans
 if (tradingFee > 0) {
 const proceed = confirm(
 `ðŸ’° Trading Fee Notice\n\n` +
 `${type === 'buy' ? 'Buying' : 'Selling'} ${quantity} shares of ${selectedStock}\n` +
 `Trade Value: $${totalCost.toFixed(2)}\n` +
 `Trading Fee: $${tradingFee.toFixed(2)} ${plan === 'family-public' ? '(1%)' : '(flat)'}\n` +
 `Total ${type === 'buy' ? 'Cost' : 'Net Proceeds'}: $${(type === 'buy' ? totalCost + tradingFee : totalCost - tradingFee).toFixed(2)}\n\n` +
 `Continue with trade?`
 );
 if (!proceed) return;
 }

 // For sell trades, find the original buy price and timestamp
 let buyPrice = stock.price;
 let buyTimestamp = Date.now();
 if (type === 'sell') {
 // Find the most recent buy trade for this stock
 const buyTrades = portfolio.history.filter(h =>
 h.type === 'buy' &&
 h.symbol === selectedStock
 ).reverse(); // Get most recent first

 if (buyTrades.length > 0) {
 // Use the average buy price if multiple buys
 const totalShares = buyTrades.reduce((sum, t) => sum + t.quantity, 0);
 const totalCost = buyTrades.reduce((sum, t) => sum + (t.price * t.quantity), 0);
 buyPrice = totalCost / totalShares;
 buyTimestamp = new Date(buyTrades[0].timestamp).getTime();
 }
 }

 const updatedPortfolio = {
 ...portfolio,
 cash: type === 'buy'
 ? portfolio.cash - totalCost - tradingFee
 : portfolio.cash + totalCost - tradingFee,
 positions: {
 ...portfolio.positions,
 [selectedStock]: type === 'buy'
 ? (portfolio.positions[selectedStock] || 0) + quantity
 : (portfolio.positions[selectedStock] || 0) - quantity
 },
 history: [...portfolio.history, {
 type,
 symbol: selectedStock,
 quantity,
 price: stock.price,
 total: totalCost,
 fee: tradingFee,
 timestamp: new Date().toISOString(),
 // Store buy price and timestamp for analysis
 buyPrice: type === 'sell' ? buyPrice : stock.price,
 buyTimestamp: type === 'sell' ? buyTimestamp : Date.now()
 }],
 lastBuyTime: type === 'buy'
 ? { ...portfolio.lastBuyTime, [selectedStock]: new Date().toISOString() }
 : portfolio.lastBuyTime
 };

 // Update local state
 setCompetition(prev => ({
 ...prev,
 members: prev.members.map(m =>
 m.id === currentUserId ? { ...m, portfolio: updatedPortfolio } : m
 )
 }));

 // Sync to backend server for personal accounts
 if (plan === 'personal' && userEmail) {
 try {
 await fetch(`${API_BASE_URL}/api/accounts/update-portfolio`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail,
 portfolio: updatedPortfolio
 })
 });
 console.log('âœ… Portfolio synced to backend');
 } catch (error) {
 console.error('Error syncing portfolio to backend:', error);
 }
 }

 // Show success toast
 const tradeIcon = type === 'buy' ? 'âœ…' : 'ðŸ’°';
 const tradeAction = type === 'buy' ? 'Bought' : 'Sold';
 showToast(`${tradeIcon} ${tradeAction} ${quantity} shares of ${selectedStock} at $${stock.price.toFixed(2)}`, 'success');

 // Generate and show trade analysis for sell trades
 if (type === 'sell') {
 const analysis = generateTradeAnalysis(stock, buyPrice, stock.price, quantity, buyTimestamp);
 setTradeAnalysisData(analysis);
 setShowTradeAnalysis(true);
 }

 // Set save status
 setSaveStatus('saved');
 setLastSaved(new Date());

 setQuantity(1);
 setQuantityError('');
 };

 // AI Trade Analysis Functions
 const calculateOptimalSellPrice = (stock, buyTimestamp, sellTimestamp) => {
 // In a real implementation, this would check historical data
 // For simulation, we'll estimate based on current stock data
 const currentPrice = stock.price;
 const priceVolatility = Math.abs(stock.change) / 100;

 // Simulate peak price during hold period (could be higher or lower)
 const peakMultiplier = 1 + (Math.random() * priceVolatility * 2);
 return currentPrice * peakMultiplier;
 };

 const calculateOverallGrade = (profitPercent, missedProfitPercent, holdDurationHours) => {
 let score = 0;

 // Profit/Loss scoring (50 points)
 if (profitPercent > 10) score += 50;
 else if (profitPercent > 5) score += 40;
 else if (profitPercent > 2) score += 30;
 else if (profitPercent > 0) score += 20;
 else if (profitPercent > -5) score += 10;
 else score += 0;

 // Timing scoring (30 points)
 if (missedProfitPercent < 2) score += 30;
 else if (missedProfitPercent < 5) score += 20;
 else if (missedProfitPercent < 10) score += 10;
 else score += 0;

 // Hold duration scoring (20 points)
 if (holdDurationHours >= 2) score += 20;
 else if (holdDurationHours >= 1) score += 15;
 else if (holdDurationHours >= 0.5) score += 10;
 else score += 5;

 // Convert to letter grade
 if (score >= 90) return { grade: 'A+', color: '#10b981' };
 if (score >= 85) return { grade: 'A', color: '#10b981' };
 if (score >= 80) return { grade: 'A-', color: '#10b981' };
 if (score >= 75) return { grade: 'B+', color: '#22c55e' };
 if (score >= 70) return { grade: 'B', color: '#84cc16' };
 if (score >= 65) return { grade: 'B-', color: '#eab308' };
 if (score >= 60) return { grade: 'C+', color: '#f59e0b' };
 if (score >= 55) return { grade: 'C', color: '#f59e0b' };
 if (score >= 50) return { grade: 'C-', color: '#ef4444' };
 if (score >= 40) return { grade: 'D', color: '#dc2626' };
 return { grade: 'F', color: '#991b1b' };
 };

 const generateTradeAnalysis = (stock, buyPrice, sellPrice, shares, buyTimestamp) => {
 const sellTimestamp = Date.now();
 const profitLoss = (sellPrice - buyPrice) * shares;
 const profitPercent = ((sellPrice - buyPrice) / buyPrice) * 100;
 const holdDuration = sellTimestamp - buyTimestamp;
 const holdDurationHours = holdDuration / (1000 * 60 * 60);
 const holdDurationMinutes = Math.floor(holdDuration / (1000 * 60));

 // Calculate optimal sell price (highest price during hold period)
 const optimalPrice = calculateOptimalSellPrice(stock, buyTimestamp, sellTimestamp);
 const missedProfit = (optimalPrice - sellPrice) * shares;
 const missedProfitPercent = ((optimalPrice - sellPrice) / sellPrice) * 100;

 // Determine timing quality
 let timingFeedback, timingGrade, timingColor;
 if (missedProfit < 0) {
 timingFeedback = `Perfect timing! Stock dropped ${Math.abs(missedProfitPercent).toFixed(1)}% after you sold.`;
 timingGrade ="A+";
 timingColor ="#10b981";
 } else if (missedProfitPercent < 2) {
 timingFeedback ="Excellent timing! You captured nearly all available gains.";
 timingGrade ="A";
 timingColor ="#10b981";
 } else if (missedProfitPercent < 5) {
 timingFeedback = `Good timing! You left only ${missedProfitPercent.toFixed(1)}% on the table.`;
 timingGrade ="B";
 timingColor ="#22c55e";
 } else if (missedProfitPercent < 10) {
 timingFeedback = `Decent timing, but you missed ${missedProfitPercent.toFixed(1)}% more gains.`;
 timingGrade ="C";
 timingColor ="#eab308";
 } else {
 timingFeedback = `You sold too early! You could have made $${Math.abs(missedProfit).toFixed(2)} more (${missedProfitPercent.toFixed(1)}%).`;
 timingGrade ="D";
 timingColor ="#ef4444";
 }

 // Generate actionable insights
 const insights = [];

 if (profitPercent > 10) {
 insights.push({
 icon:"âœ…",
 text:"Excellent profit! You're showing strong stock picking skills.",
 type:"success"
 });
 } else if (profitPercent > 5) {
 insights.push({
 icon:"ðŸ‘",
 text:"Solid profit! Keep up the good work.",
 type:"success"
 });
 } else if (profitPercent > 0) {
 insights.push({
 icon:"âœ“",
 text:"Profitable trade, but aim for higher returns.",
 type:"neutral"
 });
 }

 if (holdDurationHours < 0.5) {
 insights.push({
 icon:"âš ï¸",
 text: `Very short hold (${holdDurationMinutes}min). Consider holding longer for bigger gains.`,
 type:"warning"
 });
 } else if (holdDurationHours < 1) {
 insights.push({
 icon:"â±ï¸",
 text:"Quick trade. Make sure you're not overtrading.",
 type:"neutral"
 });
 }

 if (profitPercent < -5) {
 insights.push({
 icon:"ðŸ›¡ï¸",
 text:"Consider using stop-losses at -5% to protect your capital.",
 type:"warning"
 });
 } else if (profitPercent < -2) {
 insights.push({
 icon:"ðŸ“‰",
 text:"Small loss. Review why the trade didn't work out.",
 type:"warning"
 });
 }

 if (missedProfitPercent > 10) {
 insights.push({
 icon:"ðŸ’¡",
 text:"You're selling winning positions too early. Be more patient!",
 type:"tip"
 });
 }

 if (profitPercent > 0 && missedProfitPercent < 5) {
 insights.push({
 icon:"ðŸŽ¯",
 text:"Great exit! You timed this sale very well.",
 type:"success"
 });
 }

 // Calculate overall grade
 const gradeInfo = calculateOverallGrade(profitPercent, Math.abs(missedProfitPercent), holdDurationHours);

 return {
 stock: stock.symbol,
 stockName: stock.name || getStockName(stock.symbol),
 buyPrice: buyPrice.toFixed(2),
 sellPrice: sellPrice.toFixed(2),
 shares,
 profitLoss: profitLoss.toFixed(2),
 profitPercent: profitPercent.toFixed(2),
 holdDuration,
 holdDurationFormatted: holdDurationHours >= 1
 ? `${holdDurationHours.toFixed(1)} hours`
 : `${holdDurationMinutes} minutes`,
 optimalPrice: optimalPrice.toFixed(2),
 missedProfit: missedProfit.toFixed(2),
 missedProfitPercent: missedProfitPercent.toFixed(2),
 timingFeedback,
 timingGrade,
 timingColor,
 insights,
 overallGrade: gradeInfo.grade,
 overallGradeColor: gradeInfo.color,
 timestamp: sellTimestamp
 };
 };

 const generateDailySummary = () => {
 const portfolio = getCurrentPortfolio();
 if (!portfolio.history || portfolio.history.length === 0) {
 return null;
 }

 // Get today's trades
 const today = new Date();
 today.setHours(0, 0, 0, 0);
 const todayTrades = portfolio.history.filter(trade => {
 const tradeDate = new Date(trade.timestamp);
 tradeDate.setHours(0, 0, 0, 0);
 return tradeDate.getTime() === today.getTime();
 });

 if (todayTrades.length === 0) {
 return null;
 }

 // Calculate statistics
 const sellTrades = todayTrades.filter(t => t.type === 'sell');
 const buyTrades = todayTrades.filter(t => t.type === 'buy');

 let totalProfitLoss = 0;
 let profitableTrades = 0;
 let bestTrade = null;
 let worstTrade = null;

 sellTrades.forEach(sell => {
 // Find corresponding buy
 const buys = portfolio.history.filter(h =>
 h.type === 'buy' &&
 h.symbol === sell.symbol &&
 new Date(h.timestamp) < new Date(sell.timestamp)
 );

 if (buys.length > 0) {
 const avgBuyPrice = buys.reduce((sum, b) => sum + b.price, 0) / buys.length;
 const profitLoss = (sell.price - avgBuyPrice) * sell.quantity;
 totalProfitLoss += profitLoss;

 if (profitLoss > 0) profitableTrades++;

 if (!bestTrade || profitLoss > bestTrade.profit) {
 bestTrade = { symbol: sell.symbol, profit: profitLoss };
 }
 if (!worstTrade || profitLoss < worstTrade.profit) {
 worstTrade = { symbol: sell.symbol, profit: profitLoss };
 }
 }
 });

 const winRate = sellTrades.length > 0 ? (profitableTrades / sellTrades.length) * 100 : 0;

 // Generate Enhanced AI commentary with risk-reward analysis
 const commentary = [];

 // Performance commentary
 if (winRate >= 70 && totalProfitLoss > 0) {
 commentary.push(`ðŸŽ¯ Exceptional performance today! ${winRate.toFixed(1)}% win rate with $${totalProfitLoss.toFixed(2)} profit shows strong trading discipline.`);
 } else if (winRate >= 70) {
 commentary.push(`ðŸŽ¯ Great win rate at ${winRate.toFixed(1)}%, but watch position sizing - winners aren't big enough to losers.`);
 } else if (winRate >= 50 && totalProfitLoss > 0) {
 commentary.push(`âœ… Solid day with ${winRate.toFixed(1)}% win rate. Your risk-reward ratio is working in your favor.`);
 } else if (winRate >= 50) {
 commentary.push(`âš–ï¸ Win rate is positive at ${winRate.toFixed(1)}%, but P/L is negative. Consider letting winners run longer and cutting losers faster.`);
 } else if (sellTrades.length > 0) {
 commentary.push(`ðŸ“‰ Challenging day with ${winRate.toFixed(1)}% win rate. Take time to analyze what went wrong before your next trade.`);
 }

 // Trading frequency analysis
 if (todayTrades.length > 20) {
 commentary.push("âš ï¸ Overtrading Alert: 20+ trades today increases emotional decision-making and commission costs. Focus on quality over quantity.");
 } else if (todayTrades.length > 10) {
 commentary.push(`ðŸ“Š High trading activity: ${todayTrades.length} trades today. Ensure each trade had a clear thesis and proper risk management.`);
 } else if (todayTrades.length >= 5) {
 commentary.push(`âœ… Moderate trading volume: ${todayTrades.length} trades shows good discipline and selective entry criteria.`);
 } else if (todayTrades.length > 0) {
 commentary.push(`ðŸŽ¯ Conservative approach: ${todayTrades.length} trades today. Quality > quantity - excellent restraint.`);
 }

 // Best/worst trade commentary
 if (bestTrade && worstTrade && bestTrade.profit > 0 && worstTrade.profit < 0) {
 const riskRewardRatio = Math.abs(bestTrade.profit / worstTrade.profit);
 if (riskRewardRatio >= 2) {
 commentary.push(`ðŸ’Ž Excellent risk-reward: Best trade ${bestTrade.symbol} (+$${bestTrade.profit.toFixed(2)}) vs worst ${worstTrade.symbol} ($${worstTrade.profit.toFixed(2)}) = ${riskRewardRatio.toFixed(1)}:1 ratio!`);
 } else {
 commentary.push(`âš ï¸ Risk-reward needs improvement: Best trade ${bestTrade.symbol} (+$${bestTrade.profit.toFixed(2)}) vs worst ${worstTrade.symbol} ($${worstTrade.profit.toFixed(2)}) = only ${riskRewardRatio.toFixed(1)}:1 ratio.`);
 }
 } else if (bestTrade && bestTrade.profit > 0) {
 commentary.push(`ðŸ† Your best trade was ${bestTrade.symbol} with +$${bestTrade.profit.toFixed(2)} profit. Study what you did right!`);
 }

 // Enhanced behavioral insights with portfolio analysis
 const insights = [];

 // Calculate average trade size
 const avgTradeSize = todayTrades.reduce((sum, t) => sum + (t.price * t.quantity), 0) / todayTrades.length;

 // Calculate average holding time for completed trades
 const completedTrades = sellTrades.filter(sell => {
 const buy = portfolio.history.find(h =>
 h.type === 'buy' &&
 h.symbol === sell.symbol &&
 new Date(h.timestamp) < new Date(sell.timestamp)
 );
 return buy;
 });

 let avgHoldingTime = 0;
 if (completedTrades.length > 0) {
 const totalHoldingTime = completedTrades.reduce((sum, sell) => {
 const buy = portfolio.history.find(h =>
 h.type === 'buy' &&
 h.symbol === sell.symbol &&
 new Date(h.timestamp) < new Date(sell.timestamp)
 );
 if (buy) {
 const holdingTime = (new Date(sell.timestamp) - new Date(buy.timestamp)) / (1000 * 60 * 60); // Hours
 return sum + holdingTime;
 }
 return sum;
 }, 0);
 avgHoldingTime = totalHoldingTime / completedTrades.length;
 }

 // Win rate insights
 if (winRate < 50 && sellTrades.length >= 3) {
 insights.push({
 icon:"ðŸ“Š",
 text:"Your win rate is below 50%. Focus on quality over quantity and wait for better setups.",
 type:"warning"
 });
 } else if (winRate >= 70) {
 insights.push({
 icon:"ðŸŽ¯",
 text: `Excellent ${winRate.toFixed(1)}% win rate! Your trade selection is sharp today.`,
 type:"success"
 });
 }

 // P/L insights
 if (totalProfitLoss > 0) {
 const returnPct = (totalProfitLoss / getCurrentPortfolio().cash) * 100;
 insights.push({
 icon:"ðŸ’°",
 text: `Profit: $${totalProfitLoss.toFixed(2)} (${returnPct.toFixed(2)}% portfolio return). Great work!`,
 type:"success"
 });
 } else if (totalProfitLoss < 0) {
 const lossPct = (Math.abs(totalProfitLoss) / getCurrentPortfolio().cash) * 100;
 insights.push({
 icon:"ðŸ“‰",
 text: `Loss: $${Math.abs(totalProfitLoss).toFixed(2)} (${lossPct.toFixed(2)}% portfolio drawdown). Review your strategy.`,
 type:"warning"
 });
 }

 // Holding time insights
 if (avgHoldingTime > 0) {
 if (avgHoldingTime < 1) {
 insights.push({
 icon:"âš¡",
 text: `Average holding time: ${Math.round(avgHoldingTime * 60)} minutes. You're day trading - ensure you're not overtrading.`,
 type:"info"
 });
 } else if (avgHoldingTime < 24) {
 insights.push({
 icon:"â°",
 text: `Average holding time: ${avgHoldingTime.toFixed(1)} hours. Good intraday trading discipline.`,
 type:"success"
 });
 } else {
 insights.push({
 icon:"ðŸ“…",
 text: `Average holding time: ${(avgHoldingTime / 24).toFixed(1)} days. Swing trading approach detected.`,
 type:"info"
 });
 }
 }

 // Trading volume insights
 if (avgTradeSize > 50000) {
 insights.push({
 icon:"ðŸ’¼",
 text: `High average trade size: $${avgTradeSize.toFixed(0)}. Managing risk well on large positions.`,
 type:"info"
 });
 } else if (avgTradeSize < 5000) {
 insights.push({
 icon:"ðŸ”",
 text: `Small position sizing: $${avgTradeSize.toFixed(0)} avg. Consider larger positions if conviction is high.`,
 type:"info"
 });
 }

 // Stock diversity
 const uniqueStocks = new Set(todayTrades.map(t => t.symbol));
 if (uniqueStocks.size === 1 && todayTrades.length > 5) {
 insights.push({
 icon:"âš ï¸",
 text: `All trades in one stock (${[...uniqueStocks][0]}). Diversify to manage concentration risk.`,
 type:"warning"
 });
 } else if (uniqueStocks.size >= 5) {
 insights.push({
 icon:"ðŸŒ",
 text: `Good diversification: traded ${uniqueStocks.size} different stocks today.`,
 type:"success"
 });
 }

 return {
 date: today.toLocaleDateString(),
 totalTrades: todayTrades.length,
 buyTrades: buyTrades.length,
 sellTrades: sellTrades.length,
 winRate: winRate.toFixed(1),
 totalProfitLoss: totalProfitLoss.toFixed(2),
 profitableTrades,
 bestTrade,
 worstTrade,
 commentary,
 insights
 };
 };

 // Fetch 100% accurate real historical price data using Finnhub Stock Candles API
 const fetchHistoricalData = async (symbol, period = '1M') => {
 try {
 console.log(`ðŸ“Š Fetching real historical data for ${symbol} (${period})...`);

 // Calculate date range and resolution based on period
 const toDate = Math.floor(Date.now() / 1000); // Current timestamp in seconds
 let fromDate;
 let resolution;

 switch (period) {
 case '1D':
 // Last 24 hours with 5-minute intervals
 fromDate = toDate - (24 * 60 * 60);
 resolution = '5';
 break;
 case '1W':
 // Last 7 days with hourly intervals
 fromDate = toDate - (7 * 24 * 60 * 60);
 resolution = '60';
 break;
 case '1M':
 // Last 30 days with daily intervals
 fromDate = toDate - (30 * 24 * 60 * 60);
 resolution = 'D';
 break;
 case '3M':
 // Last 90 days with daily intervals
 fromDate = toDate - (90 * 24 * 60 * 60);
 resolution = 'D';
 break;
 case 'ALL':
 // Last 365 days with daily intervals
 fromDate = toDate - (365 * 24 * 60 * 60);
 resolution = 'D';
 break;
 default:
 // Default to 30 days
 fromDate = toDate - (30 * 24 * 60 * 60);
 resolution = 'D';
 }

 // Finnhub Stock Candles API endpoint
 const url = `${FINNHUB_API_BASE}/stock/candle?symbol=${symbol}&resolution=${resolution}&from=${fromDate}&to=${toDate}&token=${FINNHUB_API_KEY}`;

 const response = await fetch(url);

 if (!response.ok) {
 throw new Error(`Finnhub API error: ${response.status} ${response.statusText}`);
 }

 const data = await response.json();

 // Check if we got valid data
 if (data.s === 'ok' && data.t && data.c && data.t.length > 0) {
 const timestamps = data.t;
 const closePrices = data.c;

 // Format labels based on period
 const labels = timestamps.map(timestamp => {
 const date = new Date(timestamp * 1000);
 if (period === '1D') {
 return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
 } else if (period === '1W') {
 return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric' });
 } else {
 return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
 }
 });

 // Format prices
 const prices = closePrices.map(price => price.toFixed(2));

 console.log(`âœ… Real historical data loaded for ${symbol} (${period}):`, {
 dataPoints: prices.length,
 firstPrice: prices[0],
 lastPrice: prices[prices.length - 1],
 timeRange: `${labels[0]} to ${labels[labels.length - 1]}`,
 source: 'Finnhub API'
 });

 return { labels, data: prices };
 } else if (data.s === 'no_data') {
 console.warn(`âš ï¸ No historical data available for ${symbol} from Finnhub`);
 return null;
 } else {
 console.warn(`âš ï¸ Unexpected response from Finnhub for ${symbol}:`, data);
 return null;
 }
 } catch (error) {
 console.error(`âŒ Error fetching historical data for ${symbol}:`, error);
 console.error('Error details:', {
 message: error.message,
 type: error.name
 });
 return null;
 }
 };

 // Generate fallback historical data if API fails
 const generateFallbackHistoricalData = (currentPrice, days = 30) => {
 const data = [];
 const labels = [];
 let price = currentPrice;

 for (let i = days; i >= 0; i--) {
 const date = new Date();
 date.setDate(date.getDate() - i);
 labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

 const change = (Math.random() - 0.5) * (currentPrice * 0.03);
 price = Math.max(currentPrice * 0.8, Math.min(currentPrice * 1.2, price + change));
 data.push(price.toFixed(2));
 }

 data[data.length - 1] = currentPrice.toFixed(2);
 return { labels, data };
 };

 // Chart effect - create/update chart when stock is selected
 useEffect(() => {
 if (!selectedStock || !chartRef.current || !stocks.length) return;

 const stock = stocks.find(s => s.symbol === selectedStock);
 if (!stock) return;

 // Destroy existing chart
 if (chartInstance.current) {
 chartInstance.current.destroy();
 }

 // Fetch and render real historical data
 const loadChart = async () => {
 console.log(`ðŸ”„ Loading chart for ${selectedStock} (${chartPeriod})...`);

 // Fetch real data from Finnhub API
 let historicalData = await fetchHistoricalData(selectedStock, chartPeriod);

 // Fallback to generated data if API fails
 if (!historicalData) {
 console.warn(`âš ï¸ Finnhub API unavailable - using simulated data for ${selectedStock}`);
 console.warn('This could be due to API rate limiting or symbol not found');
 historicalData = generateFallbackHistoricalData(stock.price);
 setIsRealChartData(false);
 } else {
 console.log(`âœ… Real chart data loaded successfully from Finnhub for ${selectedStock}`);
 setIsRealChartData(true);
 }

 const { labels, data } = historicalData;

 // Create new chart
 const ctx = chartRef.current.getContext('2d');
 chartInstance.current = new Chart(ctx, {
 type: 'line',
 data: {
 labels: labels,
 datasets: [{
 label: `${stock.symbol} Price`,
 data: data,
 borderColor: stock.change >= 0 ? 'rgb(74, 222, 128)' : 'rgb(248, 113, 113)',
 backgroundColor: stock.change >= 0 ? 'rgba(74, 222, 128, 0.1)' : 'rgba(248, 113, 113, 0.1)',
 borderWidth: 2,
 fill: true,
 tension: 0.4,
 pointRadius: 0,
 pointHoverRadius: 6,
 pointHoverBackgroundColor: stock.change >= 0 ? 'rgb(74, 222, 128)' : 'rgb(248, 113, 113)',
 pointHoverBorderColor: '#fff',
 pointHoverBorderWidth: 2
 }]
 },
 options: {
 responsive: true,
 maintainAspectRatio: false,
 plugins: {
 legend: {
 display: false
 },
 tooltip: {
 mode: 'index',
 intersect: false,
 backgroundColor: 'rgba(0, 0, 0, 0.8)',
 padding: 12,
 titleColor: '#fff',
 bodyColor: '#fff',
 borderColor: stock.change >= 0 ? 'rgb(74, 222, 128)' : 'rgb(248, 113, 113)',
 borderWidth: 1,
 callbacks: {
 label: function(context) {
 return '$' + parseFloat(context.parsed.y).toFixed(2);
 }
 }
 }
 },
 scales: {
 x: {
 display: true,
 grid: {
 display: false,
 color: 'rgba(255, 255, 255, 0.1)'
 },
 ticks: {
 color: 'rgba(255, 255, 255, 0.6)',
 maxTicksLimit: 6
 }
 },
 y: {
 display: true,
 grid: {
 color: 'rgba(255, 255, 255, 0.1)'
 },
 ticks: {
 color: 'rgba(255, 255, 255, 0.6)',
 callback: function(value) {
 return '$' + value.toFixed(0);
 }
 }
 }
 },
 interaction: {
 mode: 'nearest',
 axis: 'x',
 intersect: false
 }
 }
 });
 };

 // Call async function
 loadChart();

 // Cleanup on unmount
 return () => {
 if (chartInstance.current) {
 chartInstance.current.destroy();
 }
 };
 }, [selectedStock, stocks, chartPeriod]);

 // Load news when stock is selected
 useEffect(() => {
 if (selectedStock) {
 loadStockNews();
 }
 }, [selectedStock]);

 // Auto-load and auto-refresh stock news when selected stock changes
 useEffect(() => {
 if (!selectedStock) return;

 // Load news immediately when stock is selected
 loadStockNews();

 // Set up auto-refresh every 3 minutes (180000 ms) for live updates
 const stockNewsInterval = setInterval(() => {
 console.log(`ðŸ“° Auto-refreshing news for ${selectedStock} (LIVE MODE)...`);
 loadStockNews();
 }, 180000); // 3 minutes

 // Cleanup interval when stock changes or component unmounts
 return () => clearInterval(stockNewsInterval);
 }, [selectedStock]);

 // Load market news on mount and auto-refresh every 2 minutes for truly LIVE updates
 useEffect(() => {
 // Load immediately on mount
 loadMarketNews();

 // Set up auto-refresh every 2 minutes (120000 ms) for live updates
 const newsRefreshInterval = setInterval(() => {
 console.log('ðŸ“° Auto-refreshing market news (LIVE MODE)...');
 loadMarketNews();
 }, 120000); // 2 minutes for truly live updates

 // Cleanup interval on unmount
 return () => clearInterval(newsRefreshInterval);
 }, []);

 // Plan Selection Screen


 // Code Display Screen (after creating competition)
 if (view === 'code-display') {
 return (
 <div className="min-h-screen bg-gray-900 p-4 md:p-8 flex items-center justify-center">
 <div className="max-w-2xl w-full">
 <div className="bg-gray-900 rounded-xl p-8 border-4 border-purple-500">
 {/* Success Icon */}
 <div className="text-center mb-6">
 <div className="inline-block bg-green-500 rounded-full p-6 mb-4">
 <span className="text-7xl">âœ…</span>
 </div>
 <h1 className="text-4xl font-black text-white mb-2">Welcome to FinClash!</h1>
 <p className="text-purple-200 text-lg">Your account is ready. Let's start trading!</p>
 </div>

 {/* Getting Started Guide */}
 <div className="bg-blue-900/50 rounded-xl p-6 mb-6 border border-blue-500">
 <h3 className="text-white font-bold mb-3 text-lg">ðŸ“ˆ Quick Start Guide:</h3>
 <ul className="text-purple-200 space-y-2 list-disc list-inside">
 <li><strong>Search Stocks:</strong> Use the search bar to find companies</li>
 <li><strong>View Details:</strong> Click any stock to see price charts and company info</li>
 <li><strong>Make Trades:</strong> Buy or sell stocks with your virtual cash</li>
 <li><strong>Track Portfolio:</strong> Monitor your investments in the Portfolio tab</li>
 <li><strong>Stay Updated:</strong> Check Market Movers and News for insights</li>
 </ul>
 </div>

 <div className="bg-green-900/30 rounded-xl p-4 border border-green-500/50 mb-6">
 <p className="text-green-300 font-semibold text-center">
 ðŸŽ¯ You start with $100,000 virtual cash - Happy trading!
 </p>
 </div>

 <div className="text-center">
 <p className="text-purple-300 text-sm">Redirecting to trading platform...</p>
 </div>
 </div>
 </div>

 {/* Account Type Selection Modal */}
 {(() => {
 console.log('ðŸŽ¯ Checking modal render. showAccountTypeModal =', showAccountTypeModal);
 if (showAccountTypeModal) {
 console.log('âœ… MODAL SHOULD BE VISIBLE NOW!');
 }
 return null;
 })()}
 {showAccountTypeModal && (
 <div className="fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center p-4 z-[9999]">
 <div className="relative bg-black/90 rounded-xl p-8 max-w-6xl w-full border-2 border-cyan-500/40" >
 {/* Close Button */}
 <button
 onClick={() => setShowAccountTypeModal(false)}
 className="absolute top-4 right-4 text-cyan-300 hover:text-cyan-400 text-3xl font-bold transition-colors z-50"
 >
 Ã—
 </button>

 {/* Header */}
 <div className="text-center mb-8">
 <h2 className="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gray-800 mb-4" >
 {accountMode === 'login' ? 'Sign In to Your Account' : 'Choose Your Account Type'}
 </h2>
 <p className="text-gray-300 text-lg">
 {accountMode === 'login' ? 'Select your account type to sign in' : 'Select the perfect plan for your trading journey'}
 </p>
 </div>

 {/* Account Type Cards */}
 <div className="grid md:grid-cols-3 gap-6 pt-6">
 {/* Individual Account */}
 <button
 onClick={() => {
 setPlan('personal');
 setShowAccountTypeModal(false);
 setView('setup-family');
 }}
 className="group bg-black/80 rounded-xl p-8 border-2 border-cyan-500/30 hover:border-cyan-400 text-left"
 
 >


 <div className="relative z-10">
 {/* Icon with Glow */}
 <div className="flex items-center justify-center mb-6">
 <div className="relative">
 <div className="absolute inset-0 bg-cyan-500/30 rounded-full group-hover:bg-cyan-500/50"></div>
 <div className="relative bg-gray-900 p-5 rounded-xl">
 <span className="text-5xl">ðŸ‘¤</span>
 </div>
 </div>
 </div>

 {/* Title */}
 <h3 className="text-4xl font-black text-center mb-3">
 <span className="text-transparent bg-clip-text bg-gray-800 group-hover:from-cyan-200 group-hover:via-blue-300 group-hover:to-cyan-200">
 Individual
 </span>
 </h3>
 <p className="text-center text-gray-400 group-hover:text-cyan-400 text-base mb-6 font-semibold">Perfect for solo traders</p>

 {/* Price */}
 <div className="relative text-center mb-8 py-6 bg-gray-900 from-black/60 to-black/40 rounded-xl border-2 border-green-500/30 group-hover:border-green-400/60 overflow-hidden">
 <div className="absolute inset-0 bg-gray-800 group-hover:group-hover:"></div>
 <div className="relative">
 <span className="text-7xl font-black text-transparent bg-clip-text bg-gray-800 to-green-300" >
 FREE
 </span>
 </div>
 <div className="text-sm text-green-400 font-bold mt-3 tracking-wider">ZERO TRADING FEES FOREVER</div>
 </div>
 {/* Corner accents */}
 <div className="absolute top-0 left-0 w-3 h-3 border-t-2 border-l-2 border-green-400/50 rounded-tl-lg"></div>
 <div className="absolute top-0 right-0 w-3 h-3 border-t-2 border-r-2 border-green-400/50 rounded-tr-lg"></div>
 <div className="absolute bottom-0 left-0 w-3 h-3 border-b-2 border-l-2 border-green-400/50 rounded-bl-lg"></div>
 <div className="absolute bottom-0 right-0 w-3 h-3 border-b-2 border-r-2 border-green-400/50 rounded-br-lg"></div>
 <div className="absolute bottom-0 right-0 w-3 h-3 border-b-2 border-r-2 border-green-400/50 rounded-br-lg"></div>

 {/* Features */}
 <ul className="space-y-4">
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-cyan-400">$100K</span> virtual capital
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 Trade <span className="font-black text-cyan-400">any stock</span> globally
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-cyan-400">UltraThink AI</span> analysis
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-cyan-400">Live</span> market news
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-cyan-400">Risk-free</span> practice
 </span>
 </li>
 </ul>
 </div>
 </button>

 {/* Public Account */}
 <button
 onClick={() => {
 if (accountMode === 'create') {
 // Redirect to Stripe for public plan
 if (STRIPE_FAMILY_PUBLIC_LINK.includes('REPLACE_WITH_YOUR_LINK')) {
 alert('âš ï¸ Stripe payment link not configured yet!');
 return;
 }
 window.location.href = STRIPE_FAMILY_PUBLIC_LINK;
 } else {
 setPlan('family-public');
 setShowAccountTypeModal(false);
 setView('setup-family');
 }
 }}
 className="group bg-black/80 rounded-xl p-8 border-2 border-green-500/40 hover:border-green-400 text-left"
 
 >


 {/* POPULAR Badge */}
 <div className="absolute -top-3 left-1/2 -translate-x-1/2 z-20">
 <div className="relative">
 <div className="absolute inset-0 bg-green-500/40 rounded-full"></div>
 <span className="relative bg-gray-800 text-white text-xs font-black px-5 py-2 rounded-full" >
 â­ POPULAR
 </span>
 </div>
 </div>

 <div className="relative z-10">
 {/* Icon with Glow */}
 <div className="flex items-center justify-center mb-6 mt-2">
 <div className="relative">
 <div className="absolute inset-0 bg-green-500/30 rounded-full group-hover:bg-green-500/50"></div>
 <div className="relative bg-gray-900 p-5 rounded-xl">
 <span className="text-5xl">ðŸ‘¥</span>
 </div>
 </div>
 </div>

 {/* Title */}
 <h3 className="text-3xl font-black text-center mb-3">
 <span className="text-transparent bg-clip-text bg-gray-800 group-hover:from-green-200 group-hover:via-emerald-300 group-hover:to-green-200">
 Public
 </span>
 </h3>
 <p className="text-center text-gray-400 group-hover:text-green-400 text-base mb-6 font-semibold">Compete for prizes</p>

 {/* Price */}
 <div className="relative text-center mb-8 py-4 bg-gray-900 from-black/60 to-black/40 rounded-xl border-2 border-yellow-500/30 group-hover:border-yellow-400/60 overflow-hidden">
 <div className="absolute inset-0 bg-gray-800 group-hover:group-hover:"></div>
 <div className="relative">
 <span className="text-5xl font-black text-transparent bg-clip-text bg-gray-800 to-yellow-300" >
 1%
 </span>
 <div className="text-xs text-yellow-400 font-bold mt-2">FEE PER TRADE</div>
 </div>
 </div>

 {/* Features */}
 <ul className="space-y-4">
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-green-400">Private</span> competitions
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-green-400">Real money</span> prizes
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-green-400">Live</span> leaderboards
 </span>
 </li>
 </ul>
 </div>
 </button>

 {/* Private Account */}
 <button
 onClick={() => {
 if (accountMode === 'create') {
 // Redirect to Stripe for private plan
 if (STRIPE_FAMILY_PRIVATE_LINK.includes('REPLACE_WITH_YOUR_LINK')) {
 alert('âš ï¸ Stripe payment link not configured yet!');
 return;
 }
 window.location.href = STRIPE_FAMILY_PRIVATE_LINK;
 } else {
 setPlan('family-private');
 setShowAccountTypeModal(false);
 setView('setup-family');
 }
 }}
 className="group bg-black/80 rounded-xl p-8 border-2 border-purple-500/40 hover:border-purple-400 text-left"
 
 >


 {/* PREMIUM Badge */}
 <div className="absolute -top-3 left-1/2 -translate-x-1/2 z-20">
 <div className="relative">
 <div className="absolute inset-0 bg-purple-500/40 rounded-full"></div>
 <span className="relative bg-gray-800 text-white text-xs font-black px-5 py-2 rounded-full" >
 âœ¨ PREMIUM
 </span>
 </div>
 </div>

 <div className="relative z-10">
 {/* Icon with Glow */}
 <div className="flex items-center justify-center mb-6 mt-2">
 <div className="relative">
 <div className="absolute inset-0 bg-purple-500/30 rounded-full group-hover:bg-purple-500/50"></div>
 <div className="relative bg-gray-900 p-5 rounded-xl">
 <span className="text-5xl">ðŸ‘‘</span>
 </div>
 </div>
 </div>

 {/* Title */}
 <h3 className="text-3xl font-black text-center mb-3">
 <span className="text-transparent bg-clip-text bg-gray-800 group-hover:from-purple-200 group-hover:via-pink-300 group-hover:to-purple-200">
 Private
 </span>
 </h3>
 <p className="text-center text-gray-400 group-hover:text-purple-400 text-base mb-6 font-semibold">Premium competition</p>

 {/* Price */}
 <div className="relative text-center mb-8 py-4 bg-gray-900 from-black/60 to-black/40 rounded-xl border-2 border-purple-500/30 group-hover:border-purple-400/60 overflow-hidden">
 <div className="absolute inset-0 bg-gray-800 group-hover:group-hover:"></div>
 <div className="relative">
 <span className="text-5xl font-black text-transparent bg-clip-text bg-gray-800 to-purple-300" >
 $0.05
 </span>
 <div className="text-xs text-purple-400 font-bold mt-2">FLAT FEE PER TRADE</div>
 </div>
 </div>

 {/* Features */}
 <ul className="space-y-4">
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-purple-400">Family-only</span> competition
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-green-400">Real money</span> prizes
 </span>
 </li>
 <li className="flex items-start gap-4 group/item">
 <div className="relative flex-shrink-0"><div className="absolute inset-0 bg-green-400/20 rounded-full group-hover/item:opacity-100"></div><span className="relative text-2xl text-green-400 font-bold">âœ“</span></div>
 <span className="text-base text-gray-300 group-hover/item:text-white">
 <span className="font-black text-purple-400">Secure & private</span>
 </span>
 </li>
 </ul>
 </div>
 </button>
 </div>
 </div>
 </div>
 )}
 </div>
 );
 }


 // Setup/Join screens
 if (view === 'setup-family' || view === 'join-family') {
 // Personal Account - Show Create/Login Tabs
 if (plan === 'personal' && view === 'setup-family') {
 return (
 <div className="min-h-screen bg-black p-4 md:p-8">
 <div className="max-w-2xl mx-auto z-10">
 <div className="absolute bottom-20 right-10 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl" style={{animationDelay: '1s'}}></div>
 <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-green-500/5 rounded-full blur-3xl" style={{animationDelay: '2s'}}></div>
 </div>
 <button
 onClick={() => {
 setView('plan-select');
 setAccountMode('create');
 setShowPasswordReset(false);
 setAuthError('');
 }}
 className="mb-6 text-cyan-400 hover:text-cyan-300 font-bold flex items-center gap-2 group"
 >
 <span className="group-hover:-translate-x-1">â†</span><span>Back to Plans</span>
 </button>

 <div className="bg-black/80 rounded-xl p-8 md:p-12 border-2 border-cyan-500/30 overflow-hidden" >
 {/* Create Account Form */}
 {accountMode === 'create' && (
 <div className="space-y-6">
 <div className="text-center mb-6">
 <h2 className="text-3xl font-bold text-transparent bg-clip-text bg-gray-800 mb-2">Create Personal Account</h2>
 <p className="text-blue-200">Start trading with $100,000 virtual cash</p>
 </div>

 {/* Error Message Display */}
 {authError && (
 <div className="bg-gray-800 border-2 border-red-400/50 rounded-xl p-4 mb-4">
 <p className="text-red-300 text-center font-semibold">{authError}</p>
 </div>
 )}

 <div>
 <label className="block text-cyan-400 font-bold mb-3 text-sm uppercase tracking-wide">Your Name</label>
 <input
 type="text"
 value={userName}
 onChange={(e) => setUserName(e.target.value)}
 placeholder="Enter your name"
 className="w-full bg-black/60 border-2 border-cyan-500/40 hover:border-cyan-400 focus:border-cyan-400 rounded-xl px-4 py-4 text-white text-lg placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all"
 />
 </div>

 <div>
 <label className="block text-cyan-400 font-bold mb-3 text-sm uppercase tracking-wide">Email Address</label>
 <input
 type="email"
 value={userEmail}
 onChange={(e) => setUserEmail(e.target.value)}
 placeholder="your@email.com"
 className="w-full bg-black/60 border-2 border-cyan-500/40 hover:border-cyan-400 focus:border-cyan-400 rounded-xl px-4 py-4 text-white text-lg placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all"
 />
 </div>

 <div>
 <label className="block text-cyan-400 font-bold mb-3 text-sm uppercase tracking-wide">Password</label>
 <input
 type="password"
 value={userPassword}
 onChange={(e) => {
 setUserPassword(e.target.value);
 setPasswordStrength(checkPasswordStrength(e.target.value));
 }}
 placeholder="Create a password"
 className="w-full bg-black/60 border-2 border-cyan-500/40 hover:border-cyan-400 focus:border-cyan-400 rounded-xl px-4 py-4 text-white text-lg placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all"
 />

 {/* Password Strength Indicator */}
 {userPassword && passwordStrength && (
 <div className="mt-3">
 {/* Strength Bar */}
 <div className="flex items-center gap-2 mb-2">
 <div className="flex-1 bg-blue-900/40 rounded-full h-2 overflow-hidden">
 <div
 className={`h-full ${
 passwordStrength.color === 'green' ? 'bg-green-500' :
 passwordStrength.color === 'yellow' ? 'bg-yellow-500' : 'bg-red-500'
 }`}
 style={{width: `${(passwordStrength.score / 5) * 100}%`}}
 ></div>
 </div>
 <span className={`text-sm font-bold ${
 passwordStrength.color === 'green' ? 'text-green-400' :
 passwordStrength.color === 'yellow' ? 'text-yellow-400' : 'text-red-400'
 }`}>
 {passwordStrength.strength.toUpperCase()}
 </span>
 </div>

 {/* Requirements Checklist */}
 <div className="bg-blue-900/20 rounded-lg p-3 space-y-1">
 <p className="text-xs text-blue-300 font-bold mb-2">Password Requirements:</p>
 <div className="space-y-1">
 <div className={`text-xs flex items-center gap-2 ${passwordStrength.requirements.minLength ? 'text-green-400' : 'text-gray-400'}`}>
 <span>{passwordStrength.requirements.minLength ? 'âœ“' : 'â—‹'}</span>
 <span>At least 8 characters</span>
 </div>
 <div className={`text-xs flex items-center gap-2 ${passwordStrength.requirements.hasUpperCase ? 'text-green-400' : 'text-gray-400'}`}>
 <span>{passwordStrength.requirements.hasUpperCase ? 'âœ“' : 'â—‹'}</span>
 <span>One uppercase letter (A-Z)</span>
 </div>
 <div className={`text-xs flex items-center gap-2 ${passwordStrength.requirements.hasLowerCase ? 'text-green-400' : 'text-gray-400'}`}>
 <span>{passwordStrength.requirements.hasLowerCase ? 'âœ“' : 'â—‹'}</span>
 <span>One lowercase letter (a-z)</span>
 </div>
 <div className={`text-xs flex items-center gap-2 ${passwordStrength.requirements.hasNumber ? 'text-green-400' : 'text-gray-400'}`}>
 <span>{passwordStrength.requirements.hasNumber ? 'âœ“' : 'â—‹'}</span>
 <span>One number (0-9)</span>
 </div>
 <div className={`text-xs flex items-center gap-2 ${passwordStrength.requirements.hasSpecial ? 'text-green-400' : 'text-gray-400'}`}>
 <span>{passwordStrength.requirements.hasSpecial ? 'âœ“' : 'â—‹'}</span>
 <span>One special character (!@#$%^&*)</span>
 </div>
 </div>
 </div>
 </div>
 )}
 </div>

 <button
 onClick={async () => {
 setAuthError('');
 if (!userName || userName.trim().length === 0) {
 setAuthError('Please enter your name');
 return;
 }
 if (!userEmail || !userEmail.includes('@')) {
 setAuthError('Please enter a valid email address');
 return;
 }
 if (!userPassword || userPassword.length < 8) {
 setAuthError('Password must be at least 8 characters long');
 return;
 }

 setLoading(true);
 try {
 await createCompetition(userName.trim(), 0, userPassword);
 } catch (error) {
 console.error('Account creation error:', error);
 setAuthError(error.message || 'Failed to create account. Please try again.');
 } finally {
 setLoading(false);
 }
 }}
 disabled={loading}
 className={`w-full bg-gray-800 hover:from-cyan-400 hover:to-blue-500 text-white py-4 rounded-xl font-bold text-lg hover:shadow-2xl ${loading ? 'opacity-50 cursor-not-allowed' : ''}`}
 >
 {loading ? 'â³ Creating Account...' : 'âœ¨ Create Account & Start Trading'}
 </button>
 </div>
 )}

 {/* Login Form */}
 {accountMode === 'login' && (
 <div className="space-y-6">
 <div className="text-center mb-6">
 <h2 className="text-3xl font-bold text-transparent bg-clip-text bg-gray-800 mb-2">Welcome Back!</h2>
 <p className="text-blue-200">Sign in to continue trading</p>
 </div>

 {/* Error Message Display */}
 {authError && (
 <div className="bg-gray-800 border-2 border-red-400/50 rounded-xl p-4 mb-4">
 <p className="text-red-300 text-center font-semibold">{authError}</p>
 </div>
 )}

 <div>
 <label className="block text-cyan-300 font-bold mb-3 text-sm uppercase tracking-wide">Email Address</label>
 <input
 type="email"
 value={userEmail}
 onChange={(e) => setUserEmail(e.target.value)}
 placeholder="your@email.com"
 className="w-full bg-blue-700/50 border-2 border-cyan-500/50 rounded-xl px-4 py-4 text-white text-lg placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all"
 />
 </div>

 <div>
 <label className="block text-cyan-300 font-bold mb-3 text-sm uppercase tracking-wide">Password</label>
 <input
 type="password"
 value={userPassword}
 onChange={(e) => setUserPassword(e.target.value)}
 placeholder="Enter your password"
 className="w-full bg-blue-700/50 border-2 border-cyan-500/50 rounded-xl px-4 py-4 text-white text-lg placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all"
 />
 </div>

 <button
 onClick={async () => {
 setAuthError('');
 if (!userEmail || !userEmail.includes('@')) {
 setAuthError('Please enter a valid email address');
 return;
 }
 if (!userPassword) {
 setAuthError('Please enter your password');
 return;
 }

 setLoading(true);
 try {
 // Login via backend server
 const response = await fetch(`${API_BASE_URL}/api/accounts/login`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail.trim().toLowerCase(),
 password: userPassword
 })
 });

 const data = await response.json();

 if (!response.ok) {
 setAuthError(data.error || 'Invalid email or password');
 setLoading(false);
 return;
 }

 // Sign in with account data from backend
 const account = data.account;
 const code = account.accountCode;

 console.log('ðŸ“¦ Portfolio loaded from backend:', account.portfolio);
 console.log('ðŸ“Š Positions:', account.portfolio?.positions);
 console.log('ðŸ’µ Cash:', account.portfolio?.cash);

 const newCompetition = {
 code: code,
 totalPool: 0,
 startTime: account.createdAt,
 members: [{
 id: Date.now().toString(),
 name: account.userName,
 contribution: 0,
 portfolio: account.portfolio,
 joinedAt: account.createdAt
 }]
 };

 setCompetition(newCompetition);
 setCompetitionCode(code);
 setCurrentUserId(newCompetition.members[0].id);
 setUserName(account.userName);
 setUserEmail(account.email);
 setView('app');
 setActiveTab('portfolio');
 setUserPassword('');
 console.log('âœ… Signed in successfully');
 console.log('ðŸŽ¯ Competition state:', newCompetition);
 } catch (error) {
 console.error('Sign in error:', error);
 setAuthError('Failed to sign in. Please check your connection and try again.');
 } finally {
 setLoading(false);
 }
 }}
 disabled={loading}
 className={`w-full bg-gray-800 hover:from-cyan-400 hover:to-blue-500 text-white py-4 rounded-xl font-black text-lg hover:shadow-2xl ${loading ? 'opacity-50 cursor-not-allowed' : ''}`}
 >
 {loading ? 'â³ Signing In...' : 'ðŸš€ Sign In'}
 </button>
 </div>
 )}

 </div>
 </div>
 </div>
 );
 }

 // Family/Competition screens
 return (
 <div className="min-h-screen bg-gray-900 p-4 md:p-8">
 <div className="max-w-2xl mx-auto z-10">
 <button
 onClick={() => setView('plan-select')}
 className="mb-6 text-cyan-400 hover:text-cyan-300 font-bold flex items-center gap-2 group"
 >
 <span className="group-hover:-translate-x-1">â†</span><span>Back to Plans</span>
 </button>

 <div className="bg-black/80 rounded-xl p-8 md:p-12 border-2 border-cyan-500/30 overflow-hidden" >
 <h2 className="text-4xl font-bold text-transparent bg-clip-text bg-gray-800 mb-8 text-center">
 {view === 'setup-family' ? 'Create Competition' : 'Join Competition'}
 </h2>

 <div className="space-y-6">
 {view === 'join-family' && (
 <div>
 <label className="block text-cyan-400 font-bold mb-3 text-sm uppercase tracking-wide">Competition Code</label>
 <input
 type="text"
 value={joinCode}
 onChange={(e) => setJoinCode(e.target.value.toUpperCase())}
 placeholder="Enter 6-character code"
 maxLength="6"
 className="w-full bg-black/60 border-2 border-cyan-500/40 hover:border-cyan-400 focus:border-cyan-400 rounded-xl px-4 py-4 text-white text-2xl font-bold placeholder-gray-500 text-center tracking-widest uppercase focus:border-cyan-400 focus:outline-none transition-all"
 />
 </div>
 )}

 <div>
 <label className="block text-cyan-400 font-bold mb-3 text-sm uppercase tracking-wide">Your Name</label>
 <input
 type="text"
 value={userName}
 onChange={(e) => setUserName(e.target.value)}
 placeholder="Enter your name"
 className="w-full bg-black/60 border-2 border-cyan-500/40 hover:border-cyan-400 focus:border-cyan-400 rounded-xl px-4 py-4 text-white text-lg placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all"
 />
 </div>

 <div>
 <label className="block text-cyan-400 font-bold mb-3 text-sm uppercase tracking-wide">Entry Amount ($)</label>
 <input
 type="number"
 value={contribution}
 onChange={(e) => setContribution(e.target.value)}
 placeholder="0.00"
 className="w-full bg-black/60 border-2 border-cyan-500/40 hover:border-cyan-400 focus:border-cyan-400 rounded-xl px-4 py-4 text-white text-2xl font-bold placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all"
 />
 </div>

 <button
 onClick={() => {
 if (!userName) {
 alert('Please enter your name');
 return;
 }

 if (view === 'join-family') {
 if (!joinCode || joinCode.length !== 6) {
 alert('Please enter a valid 6-character competition code');
 return;
 }
 if (!contribution || parseFloat(contribution) <= 0) {
 alert('Please enter a valid contribution amount');
 return;
 }
 joinCompetition(joinCode, userName, contribution);
 } else if (!contribution || parseFloat(contribution) <= 0) {
 alert('Please enter a valid contribution amount');
 return;
 } else {
 createCompetition(userName, contribution);
 }
 }}
 className="w-full bg-gray-800 hover:from-cyan-400 hover:to-blue-500 text-white py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition-all"
 >
 {view === 'setup-family' ? 'Create Competition' : 'Join Competition'}
 </button>
 </div>
 </div>
 </div>
 </div>
 );
 }

 // Trading Interface
 const portfolio = getCurrentPortfolio();
 const portfolioValue = calculatePortfolioValue(portfolio);
 const portfolioReturn = ((portfolioValue - 100000) / 100000) * 100;

 const filteredStocks = stocks.filter(stock =>
 stock.symbol.toLowerCase().includes(searchTerm.toLowerCase()) ||
 stock.name.toLowerCase().includes(searchTerm.toLowerCase())
 );

 return (
 <>
 {/* Toast Notification Container */}
 <div className="toast-container">
 {toasts.map(toast => {
 const icons = {
 success: 'âœ…',
 error: 'âŒ',
 warning: 'âš ï¸',
 info: 'â„¹ï¸'
 };
 return (
 <div
 key={toast.id}
 className={`toast toast-${toast.type} ${toast.closing ? 'closing' : ''}`}
 role="alert"
 aria-live="polite"
 >
 <div className="toast-content">
 <span className="toast-icon">{icons[toast.type]}</span>
 <span className="toast-message">{toast.message}</span>
 </div>
 <button
 className="toast-close"
 onClick={() => dismissToast(toast.id)}
 aria-label="Close notification"
 >
 Ã—
 </button>
 {toast.duration > 0 && (
 <div
 className="toast-progress"
 style={{ animationDuration: `${toast.duration}ms` }}
 />
 )}
 </div>
 );
 })}
 </div>

 {/* Trade Analysis Modal */}
 {showTradeAnalysis && tradeAnalysisData && (
 <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fadeIn">
 <div className="bg-gray-900 rounded-xl max-w-2xl w-full border-2 border-purple-500 animate-scaleIn max-h-[90vh] overflow-y-auto">
 <div className="bg-gray-800 p-6 relative">
 <button onClick={() => setShowTradeAnalysis(false)} className="absolute top-4 right-4 text-white hover:text-gray-200 text-3xl font-bold">Ã—</button>
 <h2 className="text-3xl font-black text-white mb-2">Trade Analysis</h2>
 <p className="text-purple-200">{tradeAnalysisData.stockName} ({tradeAnalysisData.stock})</p>
 </div>
 <div className="p-6 text-center border-b border-purple-700">
 <div className="inline-block text-7xl font-black px-12 py-6 rounded-2xl" style={{ backgroundColor: tradeAnalysisData.overallGradeColor + '20', color: tradeAnalysisData.overallGradeColor, border: `3px solid ${tradeAnalysisData.overallGradeColor}` }}>{tradeAnalysisData.overallGrade}</div>
 <p className="text-white mt-4 text-lg font-semibold">Overall Trade Grade</p>
 </div>
 <div className="p-6 border-b border-purple-700">
 <h3 className="text-xl font-bold text-white mb-4">Trade Summary</h3>
 <div className="grid grid-cols-2 gap-4">
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30"><div className="text-purple-300 text-sm">Shares Sold</div><div className="text-white text-2xl font-bold">{tradeAnalysisData.shares}</div></div>
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30"><div className="text-purple-300 text-sm">Hold Duration</div><div className="text-white text-2xl font-bold">{tradeAnalysisData.holdDurationFormatted}</div></div>
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30"><div className="text-purple-300 text-sm">Buy â†’ Sell Price</div><div className="text-white text-xl font-bold">${tradeAnalysisData.buyPrice} â†’ ${tradeAnalysisData.sellPrice}</div></div>
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30"><div className="text-purple-300 text-sm">Profit/Loss</div><div className={`text-2xl font-bold ${parseFloat(tradeAnalysisData.profitLoss) >= 0 ? 'text-green-400' : 'text-red-400'}`}>${tradeAnalysisData.profitLoss} ({tradeAnalysisData.profitPercent}%)</div></div>
 </div>
 </div>
 <div className="p-6 border-b border-purple-700">
 <div className="flex items-center justify-between mb-3">
 <h3 className="text-xl font-bold text-white">Timing Analysis</h3>
 <div className="px-4 py-2 rounded-lg font-bold" style={{ backgroundColor: tradeAnalysisData.timingColor + '20', color: tradeAnalysisData.timingColor }}>{tradeAnalysisData.timingGrade}</div>
 </div>
 <p className="text-purple-200 mb-3">{tradeAnalysisData.timingFeedback}</p>
 {parseFloat(tradeAnalysisData.missedProfit) > 0 && (<div className="bg-yellow-900/30 border border-yellow-600/50 rounded-lg p-3"><p className="text-yellow-200 text-sm">ðŸ’¡ Optimal sell price was <span className="font-bold">${tradeAnalysisData.optimalPrice}</span> - you missed ${tradeAnalysisData.missedProfit} in potential gains</p></div>)}
 </div>
 <div className="p-6 border-b border-purple-700">
 <h3 className="text-xl font-bold text-white mb-4">AI Insights</h3>
 <div className="space-y-3">
 {tradeAnalysisData.insights.map((insight, idx) => (
 <div key={idx} className={`flex items-start gap-3 p-3 rounded-lg border ${insight.type === 'success' ? 'bg-green-900/20 border-green-500/30' : insight.type === 'warning' ? 'bg-yellow-900/20 border-yellow-500/30' : insight.type === 'tip' ? 'bg-blue-900/20 border-blue-500/30' : 'bg-purple-900/20 border-purple-500/30'}`}>
 <span className="text-2xl">{insight.icon}</span>
 <p className={`text-sm flex-1 ${insight.type === 'success' ? 'text-green-200' : insight.type === 'warning' ? 'text-yellow-200' : insight.type === 'tip' ? 'text-blue-200' : 'text-purple-200'}`}>{insight.text}</p>
 </div>
 ))}
 </div>
 </div>
 <div className="p-6 bg-indigo-950 flex gap-3">
 <button onClick={() => setShowTradeAnalysis(false)} className="flex-1 bg-gray-800 hover:from-purple-500 hover:to-indigo-500 text-white px-6 py-3 rounded-xl font-bold transition-all">Got It!</button>
 <button onClick={() => { setShowTradeAnalysis(false); setMainTab('portfolio'); setActiveTab('history'); }} className="flex-1 bg-blue-700 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-bold transition-all">View All Trades</button>
 </div>
 </div>
 </div>
 )}

 {/* Daily Summary Modal */}
 {showDailySummary && dailySummaryData && (
 <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fadeIn">
 <div className="bg-gray-900 rounded-xl max-w-3xl w-full border-2 border-purple-500 animate-scaleIn max-h-[90vh] overflow-y-auto">
 <div className="bg-gray-800 p-6 sticky top-0">
 <button onClick={() => setShowDailySummary(false)} className="absolute top-4 right-4 text-white hover:text-gray-200 text-3xl font-bold">Ã—</button>
 <h2 className="text-3xl font-black text-white mb-2">Daily Summary</h2>
 <p className="text-purple-200">{dailySummaryData.date}</p>
 </div>
 <div className="p-6 border-b border-purple-700">
 <h3 className="text-xl font-bold text-white mb-4">Today's Performance</h3>
 <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30 text-center"><div className="text-purple-300 text-sm">Total Trades</div><div className="text-white text-3xl font-bold">{dailySummaryData.totalTrades}</div></div>
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30 text-center"><div className="text-purple-300 text-sm">Win Rate</div><div className={`text-3xl font-bold ${parseFloat(dailySummaryData.winRate) >= 50 ? 'text-green-400' : 'text-red-400'}`}>{dailySummaryData.winRate}%</div></div>
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30 text-center"><div className="text-purple-300 text-sm">Total P/L</div><div className={`text-3xl font-bold ${parseFloat(dailySummaryData.totalProfitLoss) >= 0 ? 'text-green-400' : 'text-red-400'}`}>${dailySummaryData.totalProfitLoss}</div></div>
 <div className="bg-blue-900/40 rounded-lg p-4 border border-purple-500/30 text-center"><div className="text-purple-300 text-sm">Profitable</div><div className="text-white text-3xl font-bold">{dailySummaryData.profitableTrades}/{dailySummaryData.sellTrades}</div></div>
 </div>
 </div>
 {(dailySummaryData.bestTrade || dailySummaryData.worstTrade) && (<div className="p-6 border-b border-purple-700"><h3 className="text-xl font-bold text-white mb-4">Trade Highlights</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-4">{dailySummaryData.bestTrade && (<div className="bg-green-900/20 border border-green-500/30 rounded-lg p-4"><div className="flex items-center gap-2 mb-2"><span className="text-2xl">ðŸ†</span><span className="text-green-300 font-bold">Best Trade</span></div><div className="text-white text-xl font-bold">{dailySummaryData.bestTrade.symbol}</div><div className="text-green-400 text-lg">+${dailySummaryData.bestTrade.profit.toFixed(2)}</div></div>)}{dailySummaryData.worstTrade && (<div className="bg-red-900/20 border border-red-500/30 rounded-lg p-4"><div className="flex items-center gap-2 mb-2"><span className="text-2xl">ðŸ“‰</span><span className="text-red-300 font-bold">Worst Trade</span></div><div className="text-white text-xl font-bold">{dailySummaryData.worstTrade.symbol}</div><div className="text-red-400 text-lg">${dailySummaryData.worstTrade.profit.toFixed(2)}</div></div>)}</div></div>)}
 <div className="p-6 border-b border-purple-700">
 <h3 className="text-xl font-bold text-white mb-4">AI Coach Commentary</h3>
 <div className="space-y-3">
 {dailySummaryData.commentary.map((comment, idx) => (<div key={idx} className="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4"><p className="text-blue-200">{comment}</p></div>))}
 </div>
 </div>
 <div className="p-6 border-b border-purple-700">
 <h3 className="text-xl font-bold text-white mb-4">Behavioral Insights</h3>
 <div className="space-y-3">
 {dailySummaryData.insights.map((insight, idx) => (
 <div key={idx} className={`flex items-start gap-3 p-3 rounded-lg border ${insight.type === 'success' ? 'bg-green-900/20 border-green-500/30' : insight.type === 'warning' ? 'bg-yellow-900/20 border-yellow-500/30' : 'bg-purple-900/20 border-purple-500/30'}`}>
 <span className="text-2xl">{insight.icon}</span>
 <p className={`text-sm flex-1 ${insight.type === 'success' ? 'text-green-200' : insight.type === 'warning' ? 'text-yellow-200' : 'text-purple-200'}`}>{insight.text}</p>
 </div>
 ))}
 </div>
 </div>
 <div className="p-6 bg-indigo-950 sticky bottom-0">
 <button onClick={() => setShowDailySummary(false)} className="w-full bg-gray-800 hover:from-purple-500 hover:to-indigo-500 text-white px-6 py-3 rounded-xl font-bold transition-all">Close</button>
 </div>
 </div>
 </div>
 )}

 {/* Skip to main content for accessibility */}
 <a href="#main-content" className="skip-to-content">
 Skip to main content
 </a>

 <div className="min-h-screen bg-gray-900 p-4">
 <div id="main-content" className="max-w-7xl mx-auto">
 {/* Navigation Bar */}
 <div className="mb-4 flex gap-3">
 <button
 onClick={() => setView('plan-select')}
 className="bg-gray-800 hover:from-cyan-300 hover:to-blue-400 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2"
 >
 ðŸ  Home
 </button>
 <button
 onClick={() => window.history.back()}
 className="group bg-black/80 hover:bg-cyan-500/20 border-2 border-cyan-500/30 hover:border-cyan-400 text-gray-300 hover:text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 overflow-hidden"
 >
 <div className="absolute inset-0 -translate-x-full group-hover:translate-x-full bg-gray-800 from-transparent to-transparent"></div>
 <span className="relative">â† Back</span>
 </button>
 <button
 onClick={() => {
 const summary = generateDailySummary();
 if (summary) {
 setDailySummaryData(summary);
 setShowDailySummary(true);
 } else {
 showToast('No trades today to analyze. Start trading!', 'info');
 }
 }}
 className="group ml-auto bg-gray-800 hover:from-purple-500 hover:to-indigo-500 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:shadow-purple-500/30 overflow-hidden"
 >
 <div className="absolute inset-0 -translate-x-full group-hover:translate-x-full bg-gray-800 from-transparent via-white/10 to-transparent"></div>
 <span className="relative">ðŸ“Š Daily Summary</span>
 </button>
 </div>

 {/* Market Movers section removed - use dedicated Market Movers tab to avoid API rate limiting */}

 {/* Main Tab Navigation */}
 <div className="group/nav mb-6 bg-gray-900 from-black/95 via-black/90 to-black/95 rounded-xl p-3 border-2 border-cyan-500/40 hover:border-cyan-400/60" >
 {/* Animated background gradient */}
 <div className="absolute inset-0 bg-gray-900 opacity-50"></div>

 {/* Nav shine effect */}
 <div className="absolute inset-0 -translate-x-full group-hover/nav:translate-x-full [1500ms] bg-gray-800 from-transparent to-transparent pointer-events-none"></div>

 <div className="relative flex gap-3">
 <button
 onClick={() => setMainTab('portfolio')}
 className={`group/tab flex-1 py-5 rounded-xl font-black text-lg ${
 mainTab === 'portfolio'
 ? 'bg-gray-900 text-white scale-105'
 : 'text-gray-400 hover:text-white hover:bg-gray-900 hover:hover:to-blue-600/30'
 }`}
 style={mainTab === 'portfolio' ? {boxShadow: '0 0 35px rgba(6, 182, 212, 0.7), 0 0 60px rgba(6, 182, 212, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1)'} : {}}
 >
 {mainTab === 'portfolio' && (
 <>
 <div className="absolute inset-0 -translate-x-full group-hover/tab:translate-x-full bg-gray-800 from-transparent via-white/30 to-transparent"></div>
 <div className="absolute inset-0 bg-gray-900 to-blue-600/20"></div>
 </>
 )}
 <span className="relative drop-shadow-lg">ðŸ’¼ Portfolio</span>
 </button>
 <button
 onClick={() => setMainTab('trading')}
 className={`group/tab flex-1 py-5 rounded-xl font-black text-lg ${
 mainTab === 'trading'
 ? 'bg-gray-900 text-white scale-105'
 : 'text-gray-400 hover:text-white hover:bg-gray-900 hover:hover:to-blue-600/30'
 }`}
 style={mainTab === 'trading' ? {boxShadow: '0 0 35px rgba(6, 182, 212, 0.7), 0 0 60px rgba(6, 182, 212, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1)'} : {}}
 >
 {mainTab === 'trading' && (
 <>
 <div className="absolute inset-0 -translate-x-full group-hover/tab:translate-x-full bg-gray-800 from-transparent via-white/30 to-transparent"></div>
 <div className="absolute inset-0 bg-gray-900 to-blue-600/20"></div>
 </>
 )}
 <span className="relative drop-shadow-lg">ðŸ“ˆ Trading</span>
 </button>
 <button
 onClick={() => setMainTab('watchlist')}
 className={`group/tab flex-1 py-5 rounded-xl font-black text-lg ${
 mainTab === 'watchlist'
 ? 'bg-gray-900 text-white scale-105'
 : 'text-gray-400 hover:text-white hover:bg-gray-900 hover:hover:to-blue-600/30'
 }`}
 style={mainTab === 'watchlist' ? {boxShadow: '0 0 35px rgba(6, 182, 212, 0.7), 0 0 60px rgba(6, 182, 212, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1)'} : {}}
 >
 {mainTab === 'watchlist' && (
 <>
 <div className="absolute inset-0 -translate-x-full group-hover/tab:translate-x-full bg-gray-800 from-transparent via-white/30 to-transparent"></div>
 <div className="absolute inset-0 bg-gray-900 to-blue-600/20"></div>
 </>
 )}
 <span className="relative drop-shadow-lg">â­ Watchlist</span>
 </button>
 <button
 onClick={() => setMainTab('news')}
 className={`group/tab flex-1 py-5 rounded-xl font-black text-lg ${
 mainTab === 'news'
 ? 'bg-gray-900 text-white scale-105'
 : 'text-gray-400 hover:text-white hover:bg-gray-900 hover:hover:to-blue-600/30'
 }`}
 style={mainTab === 'news' ? {boxShadow: '0 0 35px rgba(6, 182, 212, 0.7), 0 0 60px rgba(6, 182, 212, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1)'} : {}}
 >
 {mainTab === 'news' && (
 <>
 <div className="absolute inset-0 -translate-x-full group-hover/tab:translate-x-full bg-gray-800 from-transparent via-white/30 to-transparent"></div>
 <div className="absolute inset-0 bg-gray-900 to-blue-600/20"></div>
 </>
 )}
 <span className="relative drop-shadow-lg">ðŸ“° News</span>
 </button>
 <button
 onClick={() => setMainTab('ai-analysis')}
 className={`group/tab flex-1 py-5 rounded-xl font-black text-lg ${
 mainTab === 'ai-analysis'
 ? 'bg-gray-900 text-white scale-105'
 : 'text-gray-400 hover:text-white hover:bg-gray-900 hover:hover:to-pink-600/30'
 }`}
 style={mainTab === 'ai-analysis' ? {boxShadow: '0 0 35px rgba(168, 85, 247, 0.7), 0 0 60px rgba(168, 85, 247, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1)'} : {}}
 >
 {mainTab === 'ai-analysis' && (
 <>
 <div className="absolute inset-0 -translate-x-full group-hover/tab:translate-x-full bg-gray-800 from-transparent via-white/30 to-transparent"></div>
 <div className="absolute inset-0 bg-gray-900 to-pink-600/20"></div>
 </>
 )}
 <span className="relative drop-shadow-lg">ðŸ§  AI Analysis</span>
 </button>
 <button
 onClick={() => {
 setMainTab('movers');
 if (topGainers.length === 0 && topLosers.length === 0) {
 fetchMarketMovers();
 }
 }}
 className={`group/tab flex-1 py-5 rounded-xl font-black text-lg ${
 mainTab === 'movers'
 ? 'bg-gray-900 text-white scale-105'
 : 'text-gray-400 hover:text-white hover:bg-gray-900 hover:hover:to-red-600/30'
 }`}
 style={mainTab === 'movers' ? {boxShadow: '0 0 35px rgba(249, 115, 22, 0.7), 0 0 60px rgba(249, 115, 22, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1)'} : {}}
 >
 {mainTab === 'movers' && (
 <>
 <div className="absolute inset-0 -translate-x-full group-hover/tab:translate-x-full bg-gray-800 from-transparent via-white/30 to-transparent"></div>
 <div className="absolute inset-0 bg-gray-900 to-red-600/20"></div>
 </>
 )}
 <span className="relative drop-shadow-lg">ðŸš€ Market Movers</span>
 </button>
 </div>
 </div>

 {/* Header */}
 <div className="group bg-black/80 rounded-xl p-6 border-2 border-cyan-500/30 hover:border-cyan-400/60 mb-6" >

 <div className="relative flex justify-between items-center">
 <div>
 <h1 className="text-3xl font-black flex items-center gap-2">
 <span className="text-transparent bg-clip-text bg-gray-800 to-cyan-300" >
 ðŸ“Š {plan === 'personal' ? 'Personal Trading' : 'Family Competition'}
 </span>
 </h1>
 <p className="text-gray-300 font-semibold mt-1">{userName}</p>
 </div>
 {competition?.code && (
 <div className="relative bg-gray-900 from-black/60 to-black/40 rounded-xl px-6 py-3 border-2 border-cyan-500/30 group/code">
 <div className="absolute inset-0 bg-gray-800 to-blue-500/5"></div>
 <div className="relative text-xs text-cyan-300 font-bold uppercase tracking-wider">Competition Code</div>
 <div className="relative text-2xl font-black text-transparent bg-clip-text bg-gray-800 tracking-wider">{competition.code}</div>
 </div>
 )}
 </div>
 </div>

 {/* Stats */}
 <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-blue-500">
 <div className="text-blue-200 text-sm font-bold mb-3 uppercase tracking-wide flex items-center gap-2">
 ðŸ’µ <span>Available Cash</span>
 </div>
 <div className="text-4xl font-black text-white">${portfolio.cash.toLocaleString(undefined, {maximumFractionDigits: 0})}</div>
 <div className="text-xs text-blue-400 mt-2 font-semibold">Ready to trade</div>
 </div>

 <div className="bg-gray-900 rounded-xl p-6 border-2 border-green-400 shadow-green-500/20">
 <div className="absolute inset-0 bg-gray-800 to-emerald-500/10"></div>
 <div className="relative">
 <div className="text-green-200 text-sm font-bold mb-3 uppercase tracking-wide flex items-center gap-2">
 ðŸ“ˆ <span>Total Value</span>
 {lastUpdate && <span className="text-xs text-green-400 normal-case tracking-normal">(Live)</span>}
 </div>
 <div className="text-4xl font-black text-white">${portfolioValue.toLocaleString(undefined, {maximumFractionDigits: 0})}</div>
 {lastUpdate && (
 <div className="text-xs text-green-300 mt-2 font-semibold">
 ðŸ”„ Updated: {lastUpdate.toLocaleTimeString()}
 </div>
 )}
 </div>
 </div>

 <div className={`group bg-black/80 rounded-xl p-6 border-2 ${
 portfolioReturn >= 0
 ? 'border-green-500/40 hover:border-green-400'
 : 'border-red-500/40 hover:border-red-400'
 }`} >
 <div className={`absolute inset-0 bg-gray-900 transition duration-700 ${
 portfolioReturn >= 0
 ? 'to-transparent'
 : 'to-transparent'
 }`}></div>
 <div className={`absolute inset-0 -translate-x-full group-hover:translate-x-full bg-gray-800 from-transparent ${
 portfolioReturn >= 0 ? 'via-green-400/15' : 'via-red-400/15'
 } to-transparent`}></div>
 <div className={`relative text-sm font-bold mb-3 uppercase tracking-wide flex items-center gap-2 ${
 portfolioReturn >= 0 ? 'text-green-300' : 'text-red-300'
 }`}>
 {portfolioReturn >= 0 ? 'ðŸš€' : 'ðŸ“‰'} <span>Return</span>
 </div>
 <div className={`relative text-4xl font-black mb-2 text-transparent bg-clip-text bg-gray-800 ${
 portfolioReturn >= 0
 ? 'from-green-300 to-green-300'
 : 'from-red-300 to-red-300'
 }`} >
 {portfolioReturn >= 0 ? '+' : ''}{portfolioReturn.toFixed(2)}%
 </div>
 <div className={`relative text-lg font-black ${portfolioReturn >= 0 ? 'text-green-400' : 'text-red-400'}`}>
 {portfolioReturn >= 0 ? '+' : ''}${(portfolioValue - 100000).toLocaleString(undefined, {maximumFractionDigits: 0})}
 </div>
 </div>

 <div className="group bg-black/80 rounded-xl p-6 border-2 border-purple-500/40 hover:border-purple-400 overflow-hidden" >
 <div className="absolute inset-0 bg-gray-900 to-transparent transition duration-700"></div>
 <div className="absolute inset-0 -translate-x-full group-hover:translate-x-full bg-gray-800 from-transparent to-transparent"></div>
 <div className="relative">
 <div className="absolute top-2 right-2 flex items-center gap-1 bg-purple-500/30 px-2 py-1 rounded-full border border-purple-400/50">
 <span className="text-xs">ðŸ§ </span>
 <span className="text-[10px] text-purple-200 font-bold">AI</span>
 </div>
 <div className="text-purple-300 text-sm font-bold mb-3 uppercase tracking-wide flex items-center gap-2">
 â­ <span>Watchlist</span>
 </div>
 <div className="text-4xl font-black text-transparent bg-clip-text bg-gray-800 to-purple-300">{watchlist.length}</div>
 <div className="text-xs text-gray-400 mt-2 font-semibold">
 {watchlist.length === 0 ? 'Search for stocks' : `${watchlist.length} stock${watchlist.length !== 1 ? 's' : ''} tracked`}
 </div>
 </div>

 {/* AI Watchlist Alerts */}
 {watchlist.length > 0 && (() => {
 const alerts = [];
 watchlist.forEach(symbol => {
 const stock = stocks.find(s => s.symbol === symbol);
 if (!stock) return;

 const change = stock.change || 0;
 const positionShares = portfolio.positions[symbol] || 0;

 // Generate alerts based on price movement
 if (change > 5) {
 alerts.push({ symbol, type: 'breakout', text: `${symbol} +${change.toFixed(1)}% ðŸš€`, color: 'green' });
 } else if (change < -5) {
 alerts.push({ symbol, type: 'dip', text: `${symbol} ${change.toFixed(1)}% ðŸ“‰`, color: 'red' });
 } else if (change > 3 && !position) {
 alerts.push({ symbol, type: 'opportunity', text: `${symbol} gaining momentum`, color: 'yellow' });
 } else if (change < -3 && !position) {
 alerts.push({ symbol, type: 'buy_dip', text: `${symbol} dip opportunity`, color: 'cyan' });
 }
 });

 if (alerts.length > 0) {
 return (
 <div className="mt-3 pt-3 border-t border-purple-500/30">
 <div className="text-[10px] text-purple-300 font-bold mb-2 flex items-center gap-1">
 <span>ðŸ””</span>
 <span>AI ALERTS ({alerts.length})</span>
 </div>
 <div className="space-y-1.5 max-h-20 overflow-y-auto custom-scrollbar">
 {alerts.slice(0, 3).map((alert, idx) => (
 <div key={idx} className={`text-[10px] px-2 py-1 rounded-md border ${
 alert.color === 'green' ? 'bg-green-900/30 border-green-500/50 text-green-300' :
 alert.color === 'red' ? 'bg-red-900/30 border-red-500/50 text-red-300' :
 alert.color === 'yellow' ? 'bg-yellow-900/30 border-yellow-500/50 text-yellow-300' :
 'bg-cyan-900/30 border-cyan-500/50 text-cyan-300'
 } font-semibold`}>
 {alert.text}
 </div>
 ))}
 </div>
 </div>
 );
 }

 return (
 <div className="mt-3 pt-3 border-t border-purple-500/30 text-[10px] text-purple-400">
 ðŸ”” No alerts â€¢ Watching {watchlist.length} stocks
 </div>
 );
 })()}
 </div>
 </div>

 {/* AI Portfolio Health Analysis */}
 {mainTab === 'portfolio' && (() => {
 // Calculate portfolio metrics for AI analysis
 // Convert positions object to array: {"AAPL": 10,"GOOGL": 5 } => [{ symbol:"AAPL", shares: 10 }, ...]
 const positionsArray = Object.entries(portfolio.positions || {}).map(([symbol, shares]) => ({
 symbol,
 shares
 }));

 const totalPositions = positionsArray.length;
 const profitablePositions = positionsArray.filter(pos => {
 const stock = stocks.find(s => s.symbol === pos.symbol);
 if (!stock) return false;
 // For simplicity, assume current price > average (we don't track avgPrice in this structure)
 // In reality, you'd need to track purchase price separately
 return stock.c > 0; // Just count positions with valid price for now
 }).length;

 const lossingPositions = totalPositions - profitablePositions;
 const winRate = totalPositions > 0 ? (profitablePositions / totalPositions) * 100 : 0;

 // Calculate diversification (unique sectors - simplified)
 const diversificationScore = Math.min(100, (totalPositions / 10) * 100);

 // Calculate overall risk level
 let riskLevel = 'Low';
 let riskColor = 'green';
 if (portfolioReturn < -10) {
 riskLevel = 'High';
 riskColor = 'red';
 } else if (portfolioReturn < -5 || lossingPositions > profitablePositions) {
 riskLevel = 'Medium';
 riskColor = 'yellow';
 }

 // Generate AI recommendations
 const recommendations = [];
 if (diversificationScore < 30 && totalPositions > 0) {
 recommendations.push({ icon: 'ðŸ“Š', text: 'Consider diversifying across more sectors', priority: 'high' });
 }
 if (portfolioReturn < -10) {
 recommendations.push({ icon: 'ðŸ›¡ï¸', text: 'High portfolio risk - review stop-loss positions', priority: 'high' });
 }
 if (portfolio.cash > portfolioValue * 0.5) {
 recommendations.push({ icon: 'ðŸ’°', text: 'High cash balance - consider deploying capital', priority: 'medium' });
 }
 if (winRate > 70 && portfolioReturn > 10) {
 recommendations.push({ icon: 'ðŸš€', text: 'Strong performance - consider taking profits on top performers', priority: 'medium' });
 }
 if (totalPositions === 0) {
 recommendations.push({ icon: 'ðŸŽ¯', text: 'Portfolio empty - start with diversified positions', priority: 'high' });
 }
 if (lossingPositions > profitablePositions && totalPositions > 0) {
 recommendations.push({ icon: 'âš ï¸', text: 'More losing than winning positions - review strategy', priority: 'high' });
 }

 return (
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-purple-500/50 mb-6 overflow-hidden">
 {/* Animated background */}
 <div className="absolute inset-0 bg-gray-800 to-pink-500/5"></div>

 <div className="relative">
 <div className="flex items-center justify-between mb-6">
 <div className="flex items-center gap-3">
 <span className="text-4xl">ðŸ§ </span>
 <h2 className="text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gray-800 to-pink-300" >
 AI Portfolio Health
 </h2>
 <span className="text-xs bg-gray-800 text-white px-3 py-1 rounded-full font-bold">LIVE</span>
 </div>
 </div>

 {/* Portfolio Health Metrics */}
 <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
 {/* Risk Level */}
 <div className={`bg-gray-900 ${
 riskColor === 'green' ? 'border-green-500/50' :
 riskColor === 'yellow' ? 'border-yellow-500/50' :
 'border-red-500/50'
 } rounded-xl p-4 border-2`}>
 <div className="text-xs text-gray-300 font-bold mb-2">RISK LEVEL</div>
 <div className={`text-2xl font-black ${
 riskColor === 'green' ? 'text-green-300' :
 riskColor === 'yellow' ? 'text-yellow-300' :
 'text-red-300'
 }`}>{riskLevel}</div>
 </div>

 {/* Win Rate */}
 <div className="bg-gray-900 rounded-xl p-4 border-2 border-blue-500/50">
 <div className="text-xs text-gray-300 font-bold mb-2">WIN RATE</div>
 <div className="text-2xl font-black text-cyan-300">{winRate.toFixed(0)}%</div>
 <div className="text-[10px] text-gray-400 mt-1">{profitablePositions}/{totalPositions} profitable</div>
 </div>

 {/* Diversification */}
 <div className="bg-gray-900 rounded-xl p-4 border-2 border-indigo-500/50">
 <div className="text-xs text-gray-300 font-bold mb-2">DIVERSIFICATION</div>
 <div className="text-2xl font-black text-purple-300">{diversificationScore.toFixed(0)}%</div>
 <div className="text-[10px] text-gray-400 mt-1">{totalPositions} positions</div>
 </div>

 {/* Portfolio Momentum */}
 <div className={`bg-gray-900 ${
 portfolioReturn > 5 ? 'border-green-500/50' :
 portfolioReturn < -5 ? 'border-red-500/50' :
 'border-gray-500/50'
 } rounded-xl p-4 border-2`}>
 <div className="text-xs text-gray-300 font-bold mb-2">MOMENTUM</div>
 <div className={`text-2xl font-black ${
 portfolioReturn > 5 ? 'text-green-300' :
 portfolioReturn < -5 ? 'text-red-300' :
 'text-gray-300'
 }`}>
 {portfolioReturn > 5 ? 'ðŸ“ˆ Strong' : portfolioReturn < -5 ? 'ðŸ“‰ Weak' : 'âž¡ï¸ Neutral'}
 </div>
 </div>
 </div>

 {/* AI Recommendations */}
 {recommendations.length > 0 && (
 <div className="bg-black/20 rounded-xl p-4 border border-purple-500/30">
 <div className="text-sm font-bold text-purple-200 mb-3 flex items-center gap-2">
 <span>âš¡</span>
 <span>AI Recommendations</span>
 </div>
 <div className="space-y-2">
 {recommendations.map((rec, idx) => (
 <div key={idx} className={`flex items-start gap-2 text-sm ${
 rec.priority === 'high' ? 'text-yellow-300' : 'text-blue-300'
 }`}>
 <span className="text-lg">{rec.icon}</span>
 <span className="flex-1">{rec.text}</span>
 {rec.priority === 'high' && (
 <span className="text-[10px] bg-red-500/30 px-2 py-0.5 rounded-full font-bold text-red-300">HIGH</span>
 )}
 </div>
 ))}
 </div>
 </div>
 )}
 </div>
 </div>
 );
 })()}

 {/* Portfolio View */}
 {mainTab === 'portfolio' && (
 <>
 {/* Daily Summary - UltraThink */}
 <div className="bg-gray-900 rounded-xl p-8 border-2 border-purple-500/50 mb-6">
 <div className="flex items-center justify-between mb-6">
 <h2 className="text-3xl font-black text-transparent bg-clip-text bg-gray-800 flex items-center gap-3" >
 âš¡ Daily Summary
 <span className="text-xs bg-gray-800 text-white px-3 py-1 rounded-full font-bold">TODAY</span>
 </h2>
 <div className="text-sm text-purple-200">
 {new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
 </div>
 </div>

 <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
 {/* Today's Performance */}
 <div className="bg-blue-950/50 rounded-xl p-6 border-2 border-cyan-500/30">
 <div className="flex items-center gap-2 mb-3">
 <span className="text-2xl">ðŸ“Š</span>
 <h3 className="text-sm font-bold text-cyan-300 uppercase tracking-wide">Today's Trades</h3>
 </div>
 {(() => {
 // Get today's date at midnight for comparison
 const today = new Date();
 today.setHours(0, 0, 0, 0);

 // Filter trades from today only
 const todaysTrades = portfolio.history?.filter(trade => {
 const tradeDate = new Date(trade.timestamp);
 tradeDate.setHours(0, 0, 0, 0);
 return tradeDate.getTime() === today.getTime();
 }) || [];

 if (todaysTrades.length === 0) {
 return (
 <div className="text-center py-6">
 <div className="text-5xl mb-3">ðŸ“…</div>
 <div className="text-gray-400">No trades today</div>
 <div className="text-xs text-gray-500 mt-2">Make your first trade!</div>
 </div>
 );
 }

 // Calculate today's trading performance
 let todayProfit = 0;
 todaysTrades.forEach(trade => {
 if (trade.type === 'sell') {
 const buyPrice = trade.buyPrice || trade.price;
 const profit = (trade.price - buyPrice) * trade.quantity;
 todayProfit += profit;
 }
 });

 const tradesCount = todaysTrades.length;
 const buys = todaysTrades.filter(t => t.type === 'buy').length;
 const sells = todaysTrades.filter(t => t.type === 'sell').length;
 const isPositive = todayProfit >= 0;

 return (
 <>
 <div className={`text-4xl font-black mb-2 ${isPositive ? 'text-green-400' : 'text-red-400'}`}>
 {isPositive ? '+' : ''}{isPositive ? '$' : '-$'}{Math.abs(todayProfit).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
 </div>
 <div className="text-sm text-cyan-200 mt-2">
 <div className="flex items-center gap-2 mb-1">
 <span>ðŸ“Š {tradesCount} trade{tradesCount !== 1 ? 's' : ''} today</span>
 </div>
 <div className="flex items-center gap-3 text-xs">
 <span className="text-green-300">ðŸ”¼ {buys} buy{buys !== 1 ? 's' : ''}</span>
 <span className="text-blue-300">ðŸ”½ {sells} sell{sells !== 1 ? 's' : ''}</span>
 </div>
 </div>
 <div className="mt-3 flex items-center gap-2">
 <span className={`text-3xl ${isPositive && todayProfit > 0 ? 'animate-bounce' : ''}`}>
 {isPositive && todayProfit > 0 ? 'ðŸŽ‰' : todayProfit === 0 ? 'ðŸ’¼' : 'ðŸ“‰'}
 </span>
 <span className="text-xs text-blue-300 font-semibold">
 {isPositive && todayProfit > 0 ? 'Profitable Day!' : todayProfit === 0 ? 'Break Even' : 'Learning Day'}
 </span>
 </div>
 </>
 );
 })()}
 </div>

 {/* Best Performer - Today's Trades Only */}
 <div className="bg-blue-950/50 rounded-xl p-6 border-2 border-green-500/30">
 <div className="flex items-center gap-2 mb-3">
 <span className="text-2xl">ðŸ†</span>
 <h3 className="text-sm font-bold text-green-300 uppercase tracking-wide">Best Trade</h3>
 </div>
 {(() => {
 // Get today's date at midnight for comparison
 const today = new Date();
 today.setHours(0, 0, 0, 0);

 // Filter today's sold trades (where we can calculate profit)
 const todaysSells = portfolio.history?.filter(trade => {
 const tradeDate = new Date(trade.timestamp);
 tradeDate.setHours(0, 0, 0, 0);
 return tradeDate.getTime() === today.getTime() && trade.type === 'sell';
 }) || [];

 if (todaysSells.length === 0) {
 return (
 <div className="text-center py-6">
 <div className="text-gray-400">No sells today</div>
 <div className="text-xs text-gray-500 mt-1">Close a position to see results</div>
 </div>
 );
 }

 // Find best performing trade
 const bestTrade = todaysSells.reduce((best, trade) => {
 const buyPrice = trade.buyPrice || trade.price;
 const profit = ((trade.price - buyPrice) / buyPrice) * 100;
 const bestProfit = ((best.price - (best.buyPrice || best.price)) / (best.buyPrice || best.price)) * 100;
 return profit > bestProfit ? trade : best;
 });

 const buyPrice = bestTrade.buyPrice || bestTrade.price;
 const profitPercent = ((bestTrade.price - buyPrice) / buyPrice) * 100;
 const profitAmount = (bestTrade.price - buyPrice) * bestTrade.quantity;

 return (
 <>
 <div className="text-3xl font-black text-white mb-1">{bestTrade.symbol}</div>
 <div className={`text-2xl font-bold ${profitPercent >= 0 ? 'text-green-400' : 'text-red-400'}`}>
 {profitPercent >= 0 ? '+' : ''}{profitPercent.toFixed(2)}%
 </div>
 <div className={`text-sm mt-2 ${profitPercent >= 0 ? 'text-green-300' : 'text-red-300'}`}>
 {profitPercent >= 0 ? '+' : ''}${profitAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
 </div>
 <div className="mt-3 text-xs text-blue-300">
 Sold {bestTrade.quantity} @ ${bestTrade.price.toFixed(2)}
 </div>
 </>
 );
 })()}
 </div>

 {/* Worst Performer - Today's Trades Only */}
 <div className="bg-blue-950/50 rounded-xl p-6 border-2 border-red-500/30">
 <div className="flex items-center gap-2 mb-3">
 <span className="text-2xl">âš ï¸</span>
 <h3 className="text-sm font-bold text-red-300 uppercase tracking-wide">Worst Trade</h3>
 </div>
 {(() => {
 // Get today's date at midnight for comparison
 const today = new Date();
 today.setHours(0, 0, 0, 0);

 // Filter today's sold trades (where we can calculate profit)
 const todaysSells = portfolio.history?.filter(trade => {
 const tradeDate = new Date(trade.timestamp);
 tradeDate.setHours(0, 0, 0, 0);
 return tradeDate.getTime() === today.getTime() && trade.type === 'sell';
 }) || [];

 if (todaysSells.length === 0) {
 return (
 <div className="text-center py-6">
 <div className="text-gray-400">No sells today</div>
 <div className="text-xs text-gray-500 mt-1">Close a position to see results</div>
 </div>
 );
 }

 // Find worst performing trade
 const worstTrade = todaysSells.reduce((worst, trade) => {
 const buyPrice = trade.buyPrice || trade.price;
 const profit = ((trade.price - buyPrice) / buyPrice) * 100;
 const worstProfit = ((worst.price - (worst.buyPrice || worst.price)) / (worst.buyPrice || worst.price)) * 100;
 return profit < worstProfit ? trade : worst;
 });

 const buyPrice = worstTrade.buyPrice || worstTrade.price;
 const profitPercent = ((worstTrade.price - buyPrice) / buyPrice) * 100;
 const profitAmount = (worstTrade.price - buyPrice) * worstTrade.quantity;

 return (
 <>
 <div className="text-3xl font-black text-white mb-1">{worstTrade.symbol}</div>
 <div className={`text-2xl font-bold ${profitPercent >= 0 ? 'text-green-400' : 'text-red-400'}`}>
 {profitPercent >= 0 ? '+' : ''}{profitPercent.toFixed(2)}%
 </div>
 <div className={`text-sm mt-2 ${profitPercent >= 0 ? 'text-green-300' : 'text-red-300'}`}>
 {profitPercent >= 0 ? '+' : ''}${Math.abs(profitAmount).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
 </div>
 <div className="mt-3 text-xs text-blue-300">
 Sold {worstTrade.quantity} @ ${worstTrade.price.toFixed(2)}
 </div>
 </>
 );
 })()}
 </div>
 </div>

 {/* Additional Stats Row */}
 <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
 {(() => {
 const positionsWithStocks = Object.entries(portfolio.positions)
 .filter(([_, qty]) => qty > 0)
 .map(([symbol, qty]) => {
 const stock = stocks.find(s => s.symbol === symbol);
 return stock ? { symbol, stock, qty } : null;
 })
 .filter(Boolean);

 const gainers = positionsWithStocks.filter(item => item.stock.change > 0).length;
 const losers = positionsWithStocks.filter(item => item.stock.change < 0).length;
 const unchanged = positionsWithStocks.filter(item => item.stock.change === 0).length;

 return (
 <>
 <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
 <div className="text-green-300 text-sm font-bold mb-1">Gainers</div>
 <div className="text-2xl font-black text-green-400">{gainers}</div>
 </div>
 <div className="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
 <div className="text-red-300 text-sm font-bold mb-1">Losers</div>
 <div className="text-2xl font-black text-red-400">{losers}</div>
 </div>
 <div className="bg-gray-900/20 border border-gray-500/30 rounded-lg p-4">
 <div className="text-gray-300 text-sm font-bold mb-1">Unchanged</div>
 <div className="text-2xl font-black text-gray-400">{unchanged}</div>
 </div>
 <div className="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
 <div className="text-purple-300 text-sm font-bold mb-1">Total Stocks</div>
 <div className="text-2xl font-black text-purple-400">{positionsWithStocks.length}</div>
 </div>
 </>
 );
 })()}
 </div>

 {/* AI Trade Summaries - UltraThink - Today's Trades Only */}
 {(() => {
 // Get today's date at midnight for comparison
 const today = new Date();
 today.setHours(0, 0, 0, 0);

 // Filter today's trades only
 const todaysTrades = portfolio.history?.filter(trade => {
 const tradeDate = new Date(trade.timestamp);
 tradeDate.setHours(0, 0, 0, 0);
 return tradeDate.getTime() === today.getTime();
 }) || [];

 if (todaysTrades.length === 0) return null;

 return (
 <div className="mt-6 bg-gray-900 rounded-xl p-6 border-2 border-purple-500/30">
 <div className="flex items-center gap-3 mb-6">
 <div className="bg-gray-900 p-2 rounded-lg">
 <span className="text-2xl">ðŸ§ </span>
 </div>
 <div>
 <h3 className="text-2xl font-black text-transparent bg-clip-text bg-gray-800 to-pink-300" >
 Today's AI Trade Analysis
 </h3>
 <p className="text-sm text-purple-300">UltraThink deep reasoning â€¢ {todaysTrades.length} trade{todaysTrades.length !== 1 ? 's' : ''} analyzed</p>
 </div>
 </div>

 <div className="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
 {todaysTrades.reverse().map((trade, index) => {
 const stock = stocks.find(s => s.symbol === trade.symbol);
 const currentPrice = stock ? stock.price : trade.price;
 const priceChange = currentPrice - trade.price;
 const priceChangePercent = (priceChange / trade.price) * 100;

 // Calculate time held
 const tradeTime = new Date(trade.timestamp);
 const holdMinutes = Math.floor((Date.now() - tradeTime.getTime()) / (1000 * 60));
 const holdText = holdMinutes < 60 ? `${holdMinutes}min ago` : holdMinutes < 1440 ? `${Math.floor(holdMinutes/60)}h ago` : `${Math.floor(holdMinutes/1440)}d ago`;

 // Generate AI summary based on trade type and outcome
 let aiSummary = '';
 let aiGrade = '';
 let aiColor = '';

 if (trade.type === 'buy') {
 if (priceChangePercent > 10) {
 aiSummary = `ðŸŽ¯ EXCEPTIONAL ENTRY! ${trade.symbol} surged ${priceChangePercent.toFixed(2)}% since your buy at $${trade.price.toFixed(2)} (${holdText}). Strong bullish momentum. Target: $${(currentPrice * 1.15).toFixed(2)}. Stop-loss: $${(currentPrice * 0.93).toFixed(2)}. Consider scaling out 25-30% to lock gains while riding trend.`;
 aiGrade = 'A++';
 aiColor = 'text-green-400';
 } else if (priceChangePercent > 5) {
 aiSummary = `âœ… Excellent timing! ${trade.symbol} up ${priceChangePercent.toFixed(2)}% from $${trade.price.toFixed(2)}. Stock showing strength. Watch for breakout above $${(currentPrice * 1.05).toFixed(2)}. Trail stop at $${(currentPrice * 0.95).toFixed(2)} to protect profits. Bullish pattern forming.`;
 aiGrade = 'A+';
 aiColor = 'text-green-400';
 } else if (priceChangePercent > 2) {
 aiSummary = `ðŸ“Š Solid entry on ${trade.symbol}! Up ${priceChangePercent.toFixed(2)}% from $${trade.price.toFixed(2)}. Stock consolidating - healthy action. Resistance: $${(currentPrice * 1.08).toFixed(2)}. Support: $${(currentPrice * 0.96).toFixed(2)}. Good risk/reward setup.`;
 aiGrade = 'A';
 aiColor = 'text-green-300';
 } else if (priceChangePercent > 0) {
 aiSummary = `ðŸŸ¢ Decent buy on ${trade.symbol}, +${priceChangePercent.toFixed(2)}% from $${trade.price.toFixed(2)}. Price holding above entry shows buyers. Watch $${(currentPrice * 1.03).toFixed(2)} breakout. If drops below $${(trade.price * 0.98).toFixed(2)}, reassess.`;
 aiGrade = 'B+';
 aiColor = 'text-green-300';
 } else if (priceChangePercent > -2) {
 aiSummary = `âš ï¸ ${trade.symbol} down ${Math.abs(priceChangePercent).toFixed(2)}% from $${trade.price.toFixed(2)}. Normal volatility. Support at $${(trade.price * 0.97).toFixed(2)}. If holds, could bounce to $${(trade.price * 1.05).toFixed(2)}. Watch closely.`;
 aiGrade = 'C+';
 aiColor = 'text-yellow-400';
 } else if (priceChangePercent > -5) {
 aiSummary = `ðŸ”´ ${trade.symbol} down ${Math.abs(priceChangePercent).toFixed(2)}% from $${trade.price.toFixed(2)}. Set stop-loss at $${(trade.price * 0.92).toFixed(2)} (max -8%). If breaks $${(currentPrice * 0.97).toFixed(2)}, expect drop to $${(currentPrice * 0.92).toFixed(2)}. Consider exit on bounce.`;
 aiGrade = 'C-';
 aiColor = 'text-orange-400';
 } else {
 aiSummary = `ðŸš¨ URGENT: ${trade.symbol} down ${Math.abs(priceChangePercent).toFixed(2)}% from $${trade.price.toFixed(2)}! CUT LOSSES at market or wait for bounce to $${(currentPrice * 1.02).toFixed(2)}. Risk management critical. Review what went wrong!`;
 aiGrade = 'D';
 aiColor = 'text-red-400';
 }
 } else if (trade.type === 'sell') {
 const buyPrice = trade.buyPrice || trade.price;
 const gainLoss = ((trade.price - buyPrice) / buyPrice) * 100;
 const dollarPL = (trade.price - buyPrice) * trade.quantity;
 const afterMove = ((currentPrice - trade.price) / trade.price) * 100;

 if (gainLoss > 15) {
 aiSummary = `ðŸ† MASTERFUL! ${trade.symbol} +${gainLoss.toFixed(2)}% (${dollarPL >= 0 ? '+' : ''}$${dollarPL.toFixed(2)}) selling at $${trade.price.toFixed(2)}. Now $${currentPrice.toFixed(2)} (${afterMove >= 0 ? '+' : ''}${afterMove.toFixed(1)}%). ${afterMove < -2 ? 'PERFECT timing! Avoided pullback.' : 'Excellent exit!'} Study this trade!`;
 aiGrade = 'A++';
 aiColor = 'text-green-400';
 } else if (gainLoss > 8) {
 aiSummary = `ðŸŽ‰ Excellent! ${trade.symbol} +${gainLoss.toFixed(2)}% (${dollarPL >= 0 ? '+' : ''}$${dollarPL.toFixed(2)}) at $${trade.price.toFixed(2)}. Now $${currentPrice.toFixed(2)}. ${afterMove > 3 ? `Left ${afterMove.toFixed(1)}% more but profit is profit!` : 'Great timing!'} Disciplined execution.`;
 aiGrade = 'A+';
 aiColor = 'text-green-400';
 } else if (gainLoss > 3) {
 aiSummary = `âœ… Good profit on ${trade.symbol}: +${gainLoss.toFixed(2)}% (${dollarPL >= 0 ? '+' : ''}$${dollarPL.toFixed(2)}). Sold $${trade.price.toFixed(2)}, now $${currentPrice.toFixed(2)}. ${afterMove < -3 ? 'Dodged pullback!' : 'Solid trade.'} Small wins compound!`;
 aiGrade = 'B+';
 aiColor = 'text-green-300';
 } else if (gainLoss > 0) {
 aiSummary = `ðŸŸ¢ Small win: ${trade.symbol} +${gainLoss.toFixed(2)}% (${dollarPL >= 0 ? '+' : ''}$${dollarPL.toFixed(2)}) at $${trade.price.toFixed(2)}. Better entry timing could improve results. Review why gain was limited.`;
 aiGrade = 'B';
 aiColor = 'text-green-300';
 } else if (gainLoss > -3) {
 aiSummary = `âšª Break-even: ${trade.symbol} ${gainLoss.toFixed(2)}% (${dollarPL >= 0 ? '+' : ''}$${dollarPL.toFixed(2)}) at $${trade.price.toFixed(2)}. Capital preserved. Analyze why it didn't work. No edge detected.`;
 aiGrade = 'C';
 aiColor = 'text-yellow-400';
 } else if (gainLoss > -8) {
 aiSummary = `ðŸ”» Loss: ${trade.symbol} ${gainLoss.toFixed(2)}% (${dollarPL >= 0 ? '+' : ''}$${dollarPL.toFixed(2)}) at $${trade.price.toFixed(2)}. Cutting losses = discipline! ${afterMove < -5 ? 'Saved from bigger loss!' : 'Review entry setup.'} Keep losses small!`;
 aiGrade = 'C-';
 aiColor = 'text-orange-400';
 } else {
 aiSummary = `ðŸš¨ Big loss: ${trade.symbol} ${gainLoss.toFixed(2)}% (${dollarPL >= 0 ? '+' : ''}$${dollarPL.toFixed(2)}). REVIEW: Flawed thesis? Ignored stop? Size too big? ${afterMove < -5 ? 'At least you exited.' : ''} Learn, adapt, manage risk!`;
 aiGrade = 'D';
 aiColor = 'text-red-400';
 }
 }

 return (
 <div key={index} className="bg-blue-950/30 rounded-lg p-4 border border-purple-500/20 hover:border-purple-400/40 transition-all">
 <div className="flex items-start justify-between mb-3">
 <div className="flex items-center gap-3">
 <span className={`text-2xl ${trade.type === 'buy' ? 'text-green-400' : 'text-blue-400'}`}>
 {trade.type === 'buy' ? 'ðŸ“¥' : 'ðŸ“¤'}
 </span>
 <div>
 <div className="flex items-center gap-2">
 <span className="font-black text-white text-lg">{trade.symbol}</span>
 <span className={`px-2 py-1 rounded text-xs font-bold ${trade.type === 'buy' ? 'bg-green-500/20 text-green-300' : 'bg-blue-500/20 text-blue-300'}`}>
 {trade.type.toUpperCase()}
 </span>
 </div>
 <div className="text-xs text-gray-400 mt-1">
 {trade.quantity} shares @ ${trade.price.toFixed(2)} â€¢ {new Date(trade.timestamp).toLocaleDateString()}
 </div>
 </div>
 </div>
 <div className={`text-3xl font-black ${aiColor} grade-badge`}>
 {aiGrade}
 </div>
 </div>
 <div className="bg-purple-900/20 rounded-lg p-3 border border-purple-500/20">
 <p className="text-sm text-purple-100 leading-relaxed">
 {aiSummary}
 </p>
 </div>
 {stock && (
 <div className="mt-3 flex items-center justify-between text-xs">
 <span className="text-gray-400">Current Price: ${currentPrice.toFixed(2)}</span>
 <span className={`font-bold ${priceChangePercent >= 0 ? 'text-green-400' : 'text-red-400'}`}>
 {priceChangePercent >= 0 ? '+' : ''}{priceChangePercent.toFixed(2)}% since trade
 </span>
 </div>
 )}
 </div>
 );
 })}
 </div>
 </div>
 );
 })()}
 </div>

 {/* Portfolio Breakdown */}
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-blue-500/50 mb-6">
 <h2 className="text-2xl font-black text-transparent bg-clip-text bg-gray-800 mb-6 flex items-center gap-2" >
 ðŸŽ¯ Portfolio Breakdown
 </h2>
 <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
 {/* Visual Allocation Bar */}
 <div>
 <div className="mb-4">
 <div className="flex justify-between text-sm text-blue-200 mb-2 font-semibold">
 <span>Asset Allocation</span>
 <span>Total: ${portfolioValue.toLocaleString()}</span>
 </div>
 <div className="h-8 bg-blue-900/50 rounded-xl flex border-2 border-blue-600">
 <div
 className="bg-gray-800 flex items-center justify-center text-white text-xs font-bold"
 style={{ width: `${(portfolio.cash / portfolioValue * 100)}%` }}
 >
 {(portfolio.cash / portfolioValue * 100) > 10 && 'Cash'}
 </div>
 {Object.entries(portfolio.positions)
 .filter(([_, qty]) => qty > 0)
 .map(([symbol, qty]) => {
 const stock = stocks.find(s => s.symbol === symbol);
 if (!stock) return null;
 const value = stock.price * qty;
 const percentage = (value / portfolioValue * 100);

 // Generate a color based on symbol
 const colors = [
 'from-green-500 to-emerald-600',
 'from-purple-500 to-indigo-600',
 'from-orange-500 to-red-600',
 'from-pink-500 to-rose-600',
 'from-yellow-500 to-amber-600'
 ];
 const colorIndex = symbol.charCodeAt(0) % colors.length;

 return (
 <div
 key={symbol}
 className={`bg-gray-800 ${colors[colorIndex]} flex items-center justify-center text-white text-xs font-bold hover:opacity-80`}
 style={{ width: `${percentage}%` }}
 title={`${symbol}: ${percentage.toFixed(1)}%`}
 >
 {percentage > 10 && symbol}
 </div>
 );
 })}
 </div>
 </div>

 {/* Allocation List */}
 <div className="space-y-2">
 <div className="flex items-center justify-between bg-blue-700/30 rounded-lg p-3 border border-cyan-500/50">
 <div className="flex items-center gap-3">
 <div className="w-4 h-4 bg-gray-800 rounded"></div>
 <span className="font-bold text-white">Cash</span>
 </div>
 <div className="text-right">
 <div className="font-black text-white">${portfolio.cash.toLocaleString()}</div>
 <div className="text-xs text-cyan-300 font-semibold">
 {(portfolio.cash / portfolioValue * 100).toFixed(1)}%
 </div>
 </div>
 </div>
 {Object.entries(portfolio.positions)
 .filter(([_, qty]) => qty > 0)
 .map(([symbol, qty]) => {
 const stock = stocks.find(s => s.symbol === symbol);
 if (!stock) return null;
 const value = stock.price * qty;
 const percentage = (value / portfolioValue * 100);

 const colors = [
 { bg: 'from-green-500 to-emerald-600', border: 'border-green-500/50' },
 { bg: 'from-purple-500 to-indigo-600', border: 'border-purple-500/50' },
 { bg: 'from-orange-500 to-red-600', border: 'border-orange-500/50' },
 { bg: 'from-pink-500 to-rose-600', border: 'border-pink-500/50' },
 { bg: 'from-yellow-500 to-amber-600', border: 'border-yellow-500/50' }
 ];
 const colorSet = colors[symbol.charCodeAt(0) % colors.length];

 return (
 <div key={symbol} className={`flex items-center justify-between bg-blue-700/30 rounded-lg p-3 border ${colorSet.border}`}>
 <div className="flex items-center gap-3">
 <div className={`w-4 h-4 bg-gray-800 ${colorSet.bg} rounded`}></div>
 <span className="font-bold text-white">{symbol}</span>
 </div>
 <div className="text-right">
 <div className="font-black text-white">${value.toLocaleString()}</div>
 <div className="text-xs text-blue-300 font-semibold">
 {percentage.toFixed(1)}%
 </div>
 </div>
 </div>
 );
 })}
 </div>
 </div>

 {/* Stats Summary */}
 <div className="bg-blue-900/40 rounded-xl p-6 border-2 border-blue-500/50">
 <h3 className="text-lg font-black text-blue-100 mb-4 flex items-center gap-2">
 ðŸ“Š Quick Stats
 </h3>
 <div className="space-y-4">
 <div className="border-b border-blue-700 pb-3">
 <div className="text-sm text-blue-300 font-semibold mb-1">Total Assets</div>
 <div className="text-2xl font-black text-white">{Object.entries(portfolio.positions).filter(([_, qty]) => qty > 0).length + 1}</div>
 <div className="text-xs text-blue-400 mt-1">
 {Object.entries(portfolio.positions).filter(([_, qty]) => qty > 0).length} stocks + cash
 </div>
 </div>
 <div className="border-b border-blue-700 pb-3">
 <div className="text-sm text-blue-300 font-semibold mb-1">Stocks Value</div>
 <div className="text-2xl font-black text-white">
 ${(portfolioValue - portfolio.cash).toLocaleString()}
 </div>
 <div className="text-xs text-blue-400 mt-1">
 {((portfolioValue - portfolio.cash) / portfolioValue * 100).toFixed(1)}% invested
 </div>
 </div>
 <div>
 <div className="text-sm text-blue-300 font-semibold mb-1">Cash Reserve</div>
 <div className="text-2xl font-black text-white">${portfolio.cash.toLocaleString()}</div>
 <div className="text-xs text-blue-400 mt-1">
 {(portfolio.cash / portfolioValue * 100).toFixed(1)}% available
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>

 {/* AI Sector Analysis */}
 {(() => {
 // Categorize stocks by sector (simplified)
 const sectorMapping = {
 'AAPL': 'Tech', 'GOOGL': 'Tech', 'MSFT': 'Tech', 'AMZN': 'Tech', 'NVDA': 'Tech', 'META': 'Tech', 'TSLA': 'Auto',
 'AMD': 'Tech', 'NFLX': 'Media', 'DIS': 'Media', 'COIN': 'Crypto', 'JPM': 'Finance', 'V': 'Finance',
 'MA': 'Finance', 'PYPL': 'Finance', 'BAC': 'Finance', 'WFC': 'Finance', 'GS': 'Finance',
 'JNJ': 'Healthcare', 'UNH': 'Healthcare', 'PFE': 'Healthcare', 'ABBV': 'Healthcare', 'MRK': 'Healthcare',
 'XOM': 'Energy', 'CVX': 'Energy', 'COP': 'Energy',
 'WMT': 'Retail', 'TGT': 'Retail', 'COST': 'Retail', 'HD': 'Retail',
 'PG': 'Consumer', 'KO': 'Consumer', 'PEP': 'Consumer', 'NKE': 'Consumer'
 };

 const sectors = {};

 // Analyze stocks by sector
 stocks.forEach(stock => {
 const sector = sectorMapping[stock.symbol] || 'Other';
 if (!sectors[sector]) {
 sectors[sector] = {
 name: sector,
 stocks: [],
 avgChange: 0,
 totalMarketCap: 0,
 momentum: 'Neutral'
 };
 }

 sectors[sector].stocks.push(stock);
 });

 // Calculate sector metrics
 Object.keys(sectors).forEach(sectorName => {
 const sector = sectors[sectorName];
 const totalChange = sector.stocks.reduce((sum, s) => sum + (s.change || 0), 0);
 sector.avgChange = totalChange / sector.stocks.length;

 if (sector.avgChange > 3) sector.momentum = 'Strong Bullish';
 else if (sector.avgChange > 1) sector.momentum = 'Bullish';
 else if (sector.avgChange < -3) sector.momentum = 'Strong Bearish';
 else if (sector.avgChange < -1) sector.momentum = 'Bearish';
 else sector.momentum = 'Neutral';

 sector.score = 50 + (sector.avgChange * 5); // Convert change to 0-100 score
 });

 // Convert to array and sort by performance
 const sectorArray = Object.values(sectors).sort((a, b) => b.avgChange - a.avgChange);
 const topSectors = sectorArray.slice(0, 6);

 if (topSectors.length === 0) return null;

 return (
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-indigo-500/50 mb-6 overflow-hidden">
 {/* Animated background */}
 <div className="absolute inset-0 bg-gray-800 to-purple-500/10"></div>

 <div className="relative">
 <div className="flex items-center justify-between mb-6">
 <div className="flex items-center gap-3">
 <span className="text-4xl">ðŸ“Š</span>
 <div>
 <h2 className="text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gray-800 to-purple-300">
 AI Sector Analysis
 </h2>
 <p className="text-sm text-indigo-300">Real-time sector momentum â€¢ Market intelligence</p>
 </div>
 </div>
 <div className="text-xs bg-gray-800 text-white px-3 py-1 rounded-full font-bold">
 LIVE
 </div>
 </div>

 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
 {topSectors.map((sector, idx) => {
 const isPositive = sector.avgChange >= 0;
 const momentumColor =
 sector.momentum === 'Strong Bullish' ? 'green' :
 sector.momentum === 'Bullish' ? 'emerald' :
 sector.momentum === 'Strong Bearish' ? 'red' :
 sector.momentum === 'Bearish' ? 'orange' :
 'gray';

 return (
 <div key={idx} className={`bg-gray-900 ${
 isPositive ?
 'border-green-500/50' :
 'border-red-500/50'
 } rounded-xl p-4 border-2 hover:shadow-xl `}>
 {/* Rank & Sector Name */}
 <div className="flex items-start justify-between mb-3">
 <div>
 <div className="flex items-center gap-2 mb-1">
 <div className="bg-indigo-500/30 text-indigo-200 text-xs font-black px-2 py-1 rounded-full">
 #{idx + 1}
 </div>
 <h3 className="text-xl font-black text-white">
 {sector.name}
 </h3>
 </div>
 <div className="text-[10px] text-gray-400">
 {sector.stocks.length} stock{sector.stocks.length !== 1 ? 's' : ''} tracked
 </div>
 </div>
 <div className="text-right">
 <div className={`text-2xl font-black ${isPositive ? 'text-green-300' : 'text-red-300'}`}>
 {isPositive ? '+' : ''}{sector.avgChange.toFixed(2)}%
 </div>
 <div className="text-[8px] text-gray-400">AVG CHANGE</div>
 </div>
 </div>

 {/* Momentum Indicator */}
 <div className={`mb-3 px-3 py-2 rounded-lg text-center border ${
 momentumColor === 'green' ? 'bg-green-900/40 border-green-500/50' :
 momentumColor === 'emerald' ? 'bg-emerald-900/40 border-emerald-500/50' :
 momentumColor === 'red' ? 'bg-red-900/40 border-red-500/50' :
 momentumColor === 'orange' ? 'bg-orange-900/40 border-orange-500/50' :
 'bg-gray-900/40 border-gray-500/50'
 }`}>
 <div className="text-xs font-bold text-white">
 {sector.momentum === 'Strong Bullish' ? 'ðŸš€' :
 sector.momentum === 'Bullish' ? 'ðŸ“ˆ' :
 sector.momentum === 'Strong Bearish' ? 'ðŸ“‰' :
 sector.momentum === 'Bearish' ? 'âš ï¸' : 'âž¡ï¸'}
 {' '}{sector.momentum}
 </div>
 </div>

 {/* Top Stocks in Sector */}
 <div>
 <div className="text-[10px] text-indigo-300 font-bold mb-1">TOP MOVERS:</div>
 <div className="space-y-1">
 {sector.stocks
 .sort((a, b) => Math.abs(b.change || 0) - Math.abs(a.change || 0))
 .slice(0, 3)
 .map((stock, i) => (
 <div key={i} className="flex items-center justify-between text-xs bg-black/20 rounded px-2 py-1">
 <span className="text-white font-bold">{stock.symbol}</span>
 <span className={`font-bold ${
 (stock.change || 0) >= 0 ? 'text-green-300' : 'text-red-300'
 }`}>
 {(stock.change || 0) >= 0 ? '+' : ''}{(stock.change || 0).toFixed(1)}%
 </span>
 </div>
 ))}
 </div>
 </div>

 {/* AI Recommendation */}
 <div className="mt-3 pt-3 border-t border-white/10">
 <div className="text-[10px] text-gray-400">
 <span className="text-purple-300 font-bold">AI:</span>
 {' '}
 {sector.avgChange > 2 ? 'Strong sector - consider exposure' :
 sector.avgChange > 0 ? 'Positive trend - monitor closely' :
 sector.avgChange > -2 ? 'Mixed signals - be cautious' :
 'Weak sector - reduce exposure'}
 </div>
 </div>
 </div>
 );
 })}
 </div>

 {/* Summary Stats */}
 <div className="mt-6 pt-4 border-t border-indigo-500/30">
 <div className="grid grid-cols-3 gap-4 text-center">
 <div>
 <div className="text-2xl font-black text-green-300">
 {sectorArray.filter(s => s.avgChange > 0).length}
 </div>
 <div className="text-[10px] text-gray-400">SECTORS UP</div>
 </div>
 <div>
 <div className="text-2xl font-black text-red-300">
 {sectorArray.filter(s => s.avgChange < 0).length}
 </div>
 <div className="text-[10px] text-gray-400">SECTORS DOWN</div>
 </div>
 <div>
 <div className="text-2xl font-black text-purple-300">
 {(sectorArray.reduce((sum, s) => sum + s.avgChange, 0) / sectorArray.length).toFixed(2)}%
 </div>
 <div className="text-[10px] text-gray-400">MARKET AVG</div>
 </div>
 </div>
 </div>
 </div>
 </div>
 );
 })()}

 {/* Portfolio Positions */}
 <div className="group bg-black/80 rounded-xl p-6 border-2 border-cyan-500/30 hover:border-cyan-400/60 overflow-hidden" >

 <div className="relative flex items-center justify-between mb-6">
 <h3 className="text-2xl font-black text-transparent bg-clip-text bg-gray-800 flex items-center gap-2">
 ðŸ’¼ Your Holdings
 </h3>
 <div className="text-sm text-cyan-300 font-semibold bg-cyan-500/20 px-3 py-1 rounded-full border border-cyan-500/30">
 {Object.entries(portfolio.positions).filter(([_, qty]) => qty > 0).length} stocks
 </div>
 </div>
 <div className="relative space-y-3">
 {Object.entries(portfolio.positions).filter(([_, qty]) => qty > 0).length === 0 ? (
 <div className="text-center py-12 bg-cyan-500/10 rounded-xl border-2 border-dashed border-cyan-500/30 animate-fade-in">
 <div className="text-6xl mb-3 opacity-50">ðŸ“Š</div>
 <div className="text-gray-300 font-semibold">No positions yet</div>
 <div className="text-sm text-gray-400 mt-2">Buy your first stock to get started!</div>
 </div>
 ) : (
 Object.entries(portfolio.positions)
 .filter(([_, qty]) => qty > 0)
 .map(([symbol, qty]) => {
 const stock = stocks.find(s => s.symbol === symbol);
 if (!stock) return null;

 // Calculate average buy price from history
 const buyTransactions = portfolio.history.filter(t =>
 t.symbol === symbol && t.type === 'buy'
 );
 const totalCost = buyTransactions.reduce((sum, t) => sum + (t.price * t.quantity), 0);
 const totalShares = buyTransactions.reduce((sum, t) => sum + t.quantity, 0);
 const avgBuyPrice = totalShares > 0 ? totalCost / totalShares : 0;

 const currentValue = stock.price * qty;
 const costBasis = avgBuyPrice * qty;
 const gainLoss = currentValue - costBasis;
 const gainLossPercent = costBasis > 0 ? (gainLoss / costBasis) * 100 : 0;

 const isPositive = gainLoss >= 0;

 return (
 <div
 key={symbol}
 className={`group/card bg-gray-900 border-2 rounded-xl p-6[1.02] will-change-transform ${
 isPositive
 ? 'to-black/60 border-green-500/50 hover:border-green-400'
 : 'to-black/60 border-red-500/50 hover:border-red-400'
 }`}
 
 >
 {/* Animated background glow */}
 <div className={`absolute inset-0 group-hover/card:opacity-100 bg-gray-900 ${
 isPositive ? 'to-emerald-500/5' : 'to-rose-500/5'
 }`}></div>


 {/* Header with stock symbol and percentage */}
 <div className="relative flex justify-between items-start mb-6">
 <div className="flex-1">
 <div className="flex items-center gap-3 mb-2">
 <div className="text-3xl font-black text-transparent bg-clip-text bg-gray-800 drop-shadow-lg">{symbol}</div>
 <div className={`text-2xl ${isPositive ? 'text-green-400' : 'text-red-400'}`}>
 {isPositive ? 'ðŸ“ˆ' : 'ðŸ“‰'}
 </div>
 </div>
 <div className="text-sm text-gray-300 font-bold flex items-center gap-2 flex-wrap">
 <span className="bg-cyan-500/20 px-3 py-1 rounded-full border border-cyan-500/40 text-cyan-300">{qty} shares</span>
 <span className="text-gray-500">â€¢</span>
 <span className="text-gray-400">{stock.name || symbol}</span>
 </div>
 </div>

 {/* Large percentage display */}
 <div className={`px-5 py-3 rounded-xl font-black text-2xl transition-all border-2 ${
 isPositive
 ? 'bg-gray-900 text-green-300 border-green-500/60'
 : 'bg-gray-900 text-red-300 border-red-500/60'
 }`} >
 <div className="flex items-center gap-2">
 <span className="text-3xl">{isPositive ? 'â†—' : 'â†˜'}</span>
 <span>{isPositive ? '+' : ''}{gainLossPercent.toFixed(2)}%</span>
 </div>
 </div>
 </div>

 {/* Price info grid */}
 <div className="relative grid grid-cols-3 gap-3 mb-5">
 <div className="bg-gray-900 border-2 border-cyan-500/40 rounded-xl p-4" >
 <div className="text-cyan-300 text-xs font-bold mb-2 uppercase tracking-wider">Avg Cost</div>
 <div className="text-white font-black text-xl">${avgBuyPrice.toFixed(2)}</div>
 </div>
 <div className="bg-gray-900 border-2 border-blue-500/40 rounded-xl p-4" >
 <div className="text-blue-300 text-xs font-bold mb-2 uppercase tracking-wider">Current</div>
 <div className="text-white font-black text-xl">${stock.price.toFixed(2)}</div>
 </div>
 <div className={`bg-gray-900 border-2 rounded-xl p-4 ${
 isPositive
 ? 'border-green-500/40'
 : 'border-red-500/40'
 }`} >
 <div className={`text-xs font-bold mb-2 uppercase tracking-wider ${isPositive ? 'text-green-300' : 'text-red-300'}`}>Daily</div>
 <div className={`font-black text-xl ${isPositive ? 'text-green-300' : 'text-red-300'}`}>
 {stock.change > 0 ? '+' : ''}{stock.change?.toFixed(2)}%
 </div>
 </div>
 </div>

 {/* Total value and gain/loss */}
 <div className={`relative flex justify-between items-center pt-5 border-t-2 ${
 isPositive ? 'border-green-500/40' : 'border-red-500/40'
 }`}>
 <div>
 <div className="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">Total Value</div>
 <div className="text-white font-black text-2xl">${currentValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
 </div>
 <div className="text-right">
 <div className="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">P&L</div>
 <div className={`font-black text-2xl flex items-center gap-2 ${isPositive ? 'text-green-300' : 'text-red-300'}`}>
 <span className="text-3xl">{isPositive ? 'ðŸš€' : 'ðŸ’”'}</span>
 <span>{isPositive ? '+' : ''}${gainLoss.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
 </div>
 </div>
 </div>

 {/* AI Recommendation for Position */}
 {(() => {
 const currentChange = stock.change || 0;
 const positionReturn = gainLossPercent;

 let aiAction = 'Hold';
 let aiReason = '';
 let aiColor = 'yellow';

 if (positionReturn > 15 && currentChange < -2) {
 aiAction = 'Consider Taking Profits';
 aiReason = 'Strong gains with recent weakness';
 aiColor = 'yellow';
 } else if (positionReturn < -10 && currentChange < -2) {
 aiAction = 'Consider Stop Loss';
 aiReason = 'Significant loss with downtrend';
 aiColor = 'red';
 } else if (positionReturn > 0 && currentChange > 2) {
 aiAction = 'Strong Hold';
 aiReason = 'Profitable with momentum';
 aiColor = 'green';
 } else if (positionReturn < -5 && currentChange > 2) {
 aiAction = 'Consider Adding';
 aiReason = 'Recovery momentum detected';
 aiColor = 'green';
 } else if (Math.abs(positionReturn) < 5) {
 aiAction = 'Hold';
 aiReason = 'Position stable';
 aiColor = 'blue';
 }

 return (
 <div className={`mt-3 pt-3 border-t ${
 aiColor === 'green' ? 'border-green-500/30' :
 aiColor === 'red' ? 'border-red-500/30' :
 aiColor === 'yellow' ? 'border-yellow-500/30' :
 'border-blue-500/30'
 } flex items-center gap-2`}>
 <span className="text-lg">ðŸ§ </span>
 <div className="flex-1">
 <div className={`text-xs font-bold ${
 aiColor === 'green' ? 'text-green-300' :
 aiColor === 'red' ? 'text-red-300' :
 aiColor === 'yellow' ? 'text-yellow-300' :
 'text-blue-300'
 }`}>AI: {aiAction}</div>
 <div className="text-[10px] text-gray-400">{aiReason}</div>
 </div>
 </div>
 );
 })()}
 </div>
 );
 })
 )}
 </div>
 </div>
 </>
 )}

 {/* Trading View */}
 {mainTab === 'trading' && (
 <>
 {/* Leaderboard for Family Competitions */}
 {(plan === 'family-public' || plan === 'family-private') && competition?.members && competition.members.length > 1 && (
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-purple-500 mb-6">
 <h2 className="text-2xl font-black text-white mb-6 flex items-center gap-2">
 ðŸ† Leaderboard
 <span className="text-sm font-normal text-purple-300 ml-2">
 ({competition.members.length} players)
 </span>
 </h2>
 <div className="space-y-3">
 {competition.members
 .map(member => ({
 ...member,
 portfolioValue: calculatePortfolioValue(member.portfolio)
 }))
 .sort((a, b) => b.portfolioValue - a.portfolioValue)
 .map((member, index) => {
 const isCurrentUser = member.id === currentUserId;
 const returnPercent = ((member.portfolioValue - 100000) / 100000) * 100;
 const isPositive = returnPercent >= 0;

 return (
 <div
 key={member.id}
 className={`flex items-center justify-between p-4 rounded-xl border-2 transition-all ${
 isCurrentUser
 ? 'bg-gray-800 border-cyan-400 shadow-cyan-500/20'
 : index === 0
 ? 'bg-gray-800 border-yellow-500'
 : 'bg-blue-900/30 border-purple-600/50'
 }`}
 >
 <div className="flex items-center gap-4">
 <div className={`text-3xl font-black ${
 index === 0 ? 'text-yellow-300' :
 index === 1 ? 'text-gray-300' :
 index === 2 ? 'text-orange-400' :
 'text-purple-400'
 }`}>
 {index === 0 ? 'ðŸ¥‡' : index === 1 ? 'ðŸ¥ˆ' : index === 2 ? 'ðŸ¥‰' : `#${index + 1}`}
 </div>
 <div>
 <div className="font-black text-white text-lg flex items-center gap-2">
 {member.name}
 {isCurrentUser && (
 <span className="text-xs bg-cyan-500 text-white px-2 py-1 rounded-full">YOU</span>
 )}
 </div>
 <div className="text-sm text-gray-300">
 Portfolio: ${member.portfolioValue.toLocaleString(undefined, {maximumFractionDigits: 0})}
 </div>
 </div>
 </div>
 <div className="text-right">
 <div className={`text-2xl font-black ${isPositive ? 'text-green-300' : 'text-red-300'}`}>
 {isPositive ? '+' : ''}{returnPercent.toFixed(2)}%
 </div>
 <div className={`text-sm font-semibold ${isPositive ? 'text-green-400' : 'text-red-400'}`}>
 {isPositive ? '+' : ''}${(member.portfolioValue - 100000).toLocaleString(undefined, {maximumFractionDigits: 0})}
 </div>
 </div>
 </div>
 );
 })}
 </div>
 <div className="mt-6 p-4 bg-purple-900/30 border border-purple-600/50 rounded-xl">
 <div className="flex items-center justify-between text-sm">
 <span className="text-purple-200 font-semibold">ðŸ’° Total Prize Pool:</span>
 <span className="text-white font-black text-lg">${competition.totalPool?.toFixed(2) || '0.00'}</span>
 </div>
 {plan === 'family-public' && (
 <div className="text-xs text-purple-300 mt-2">1% fee per trade â€¢ Winner takes all</div>
 )}
 {plan === 'family-private' && (
 <div className="text-xs text-purple-300 mt-2">$0.05 flat fee per trade â€¢ Winner takes all</div>
 )}
 </div>
 </div>
 )}

 {/* Main Content */}
 <div className="w-full">
 {/* Market Status Banner */}
 <div className={`mb-6 rounded-xl p-6 border-2 ${
 marketOpen
 ? 'bg-gray-800 border-green-500-slow'
 : 'bg-gray-800 border-red-500'
 }`}>
 <div className="flex items-center justify-between flex-wrap gap-4">
 <div className="flex items-center gap-4">
 <div className={`w-16 h-16 rounded-full flex items-center justify-center text-3xl ${
 marketOpen
 ? 'bg-green-500/30 border-2 border-green-400'
 : 'bg-red-500/30 border-2 border-red-400'
 }`}>
 {marketOpen ? 'ðŸŸ¢' : 'ðŸ”´'}
 </div>
 <div>
 <h3 className={`text-2xl font-black ${marketOpen ? 'text-green-300' : 'text-red-300'}`}>
 {marketOpen ? 'MARKET OPEN' : 'MARKET CLOSED'}
 </h3>
 <p className={`text-sm font-semibold ${marketOpen ? 'text-green-200' : 'text-red-200'}`}>
 {marketOpen
 ? `Closes in ${timeUntilChange}`
 : currentHoliday
 ? `Today is ${currentHoliday}`
 : `Opens in ${timeUntilChange}`
 }
 </p>
 </div>
 </div>
 <div className="text-right">
 <div className="text-sm text-white/80 font-semibold">
 {marketOpen ? 'Trading Enabled' : 'Trading Disabled'}
 </div>
 <div className={`text-xs mt-1 font-bold ${marketOpen ? 'text-green-300' : 'text-red-300'}`}>
 {marketOpen
 ? 'Mon-Fri, 9:30 AM - 4:00 PM ET'
 : `Next Open: ${nextMarketOpenTime}`
 }
 </div>
 </div>
 </div>

 {/* Market Closed Notice */}
 {!marketOpen && (
 <div className="mt-4 pt-4 border-t border-red-500/30">
 <div className="bg-red-950/40 rounded-xl p-4">
 <h4 className="text-red-200 font-bold mb-2 flex items-center gap-2">
 <span>ðŸ”’</span>
 <span>Trading Unavailable</span>
 </h4>
 <p className="text-red-200/80 text-sm mb-2">
 The US stock market is currently closed. You can still browse stocks, view news, and analyze opportunities.
 </p>
 <div className="grid grid-cols-1 md:grid-cols-3 gap-2 mt-3 text-xs">
 <div className="bg-red-900/30 rounded-lg p-2 border border-red-500/30">
 <div className="text-red-300 font-bold">ðŸ“… Trading Days</div>
 <div className="text-red-200/70">Monday - Friday</div>
 </div>
 <div className="bg-red-900/30 rounded-lg p-2 border border-red-500/30">
 <div className="text-red-300 font-bold">â° Trading Hours</div>
 <div className="text-red-200/70">9:30 AM - 4:00 PM ET</div>
 </div>
 <div className="bg-red-900/30 rounded-lg p-2 border border-red-500/30">
 <div className="text-red-300 font-bold">ðŸŽ¯ Next Session</div>
 <div className="text-red-200/70">{timeUntilChange}</div>
 </div>
 </div>
 </div>
 </div>
 )}
 </div>

 {/* AI Stock Recommendations Engine */}
 {(() => {
 // Advanced AI Stock Analysis Engine - UltraThink Algorithm
 const recommendations = [];

 // Calculate market-wide metrics for context
 const marketAvgChange = stocks.reduce((sum, s) => sum + (s.change || 0), 0) / stocks.length;
 const marketVolatility = Math.sqrt(stocks.reduce((sum, s) => sum + Math.pow((s.change || 0) - marketAvgChange, 2), 0) / stocks.length);
 const bullishStocks = stocks.filter(s => (s.change || 0) > 0).length;
 const bearishStocks = stocks.filter(s => (s.change || 0) < 0).length;
 const marketSentiment = bullishStocks > bearishStocks ? 'BULLISH' : 'BEARISH';

 stocks.forEach(stock => {
 const change = stock.change || 0;
 const price = stock.price || 0;
 const positionShares = portfolio.positions[stock.symbol] || 0;
 const hasPosition = positionShares > 0;

 let score = 0; // Start at 0 for more selective scoring
 let reasons = [];
 let type = 'HOLD';
 let confidence = 0;

 // ===== 1. MOMENTUM STRENGTH ANALYSIS =====
 const relativeStrength = change - marketAvgChange; // How much better than market

 if (change > 10) {
 score += 45;
 confidence += 25;
 reasons.push('ðŸš€ Parabolic move - extreme momentum');
 type = 'STRONG BUY';
 } else if (change > 7) {
 score += 40;
 confidence += 22;
 reasons.push('ðŸ”¥ Breakout confirmed - riding trend');
 type = 'STRONG BUY';
 } else if (change > 5) {
 score += 35;
 confidence += 20;
 reasons.push('ðŸ“ˆ Strong uptrend - continuation likely');
 type = 'BUY';
 } else if (change > 3) {
 score += 28;
 confidence += 16;
 reasons.push('âœ… Solid momentum building');
 type = 'BUY';
 } else if (change > 1.5) {
 score += 20;
 confidence += 12;
 reasons.push('ðŸ“Š Positive trend forming');
 type = 'BUY';
 }

 // Value opportunity scoring (dip buying)
 if (change < -10) {
 score += 42;
 confidence += 20;
 reasons.push('ðŸ’Ž Extreme oversold - high rebound potential');
 type = 'BUY DIP';
 } else if (change < -7) {
 score += 35;
 confidence += 18;
 reasons.push('ðŸŽ¯ Deep discount - capitulation signal');
 type = 'BUY DIP';
 } else if (change < -5) {
 score += 28;
 confidence += 15;
 reasons.push('âš¡ Oversold bounce setup');
 type = 'BUY DIP';
 } else if (change < -3) {
 score += 22;
 confidence += 12;
 reasons.push('ðŸ“‰ Healthy correction - entry zone');
 type = 'BUY DIP';
 }

 // ===== 2. RELATIVE STRENGTH vs MARKET =====
 if (relativeStrength > 5) {
 score += 25;
 confidence += 15;
 reasons.push('ðŸ’ª Outperforming market significantly');
 } else if (relativeStrength > 3) {
 score += 18;
 confidence += 10;
 reasons.push('ðŸ† Leading the market');
 } else if (relativeStrength > 1) {
 score += 12;
 confidence += 8;
 reasons.push('ðŸ“Š Above market performance');
 }

 // Underperformance can be opportunity
 if (relativeStrength < -5 && change < 0) {
 score += 15;
 confidence += 10;
 reasons.push('ðŸ”„ Mean reversion candidate');
 }

 // ===== 3. PRICE ACTION & VOLUME ANALYSIS =====
 const priceZone = price < 10 ? 'micro' : price < 50 ? 'small' : price < 150 ? 'mid' : price < 500 ? 'large' : 'mega';

 if (priceZone === 'micro' && change > 8) {
 score += 25;
 confidence += 12;
 reasons.push('ðŸŽ² Penny stock rocket - high risk/reward');
 } else if (priceZone === 'small' && change > 5) {
 score += 22;
 confidence += 15;
 reasons.push('ðŸ’° Small-cap growth momentum');
 } else if (priceZone === 'mid' && change > 3) {
 score += 20;
 confidence += 18;
 reasons.push('ðŸ¢ Mid-cap strength - sweet spot');
 } else if (priceZone === 'large' && change > 2) {
 score += 18;
 confidence += 20;
 reasons.push('ðŸ›ï¸ Blue-chip momentum - safer play');
 } else if (priceZone === 'mega' && change > 1.5) {
 score += 15;
 confidence += 22;
 reasons.push('ðŸ‘‘ Mega-cap leader moving');
 }

 // ===== 4. VOLATILITY & RISK SCORING =====
 const stockVolatility = Math.abs(change);
 let risk = 'MEDIUM';

 if (stockVolatility > 15) {
 risk = 'EXTREME';
 score += 12; // High risk can mean high reward
 confidence -= 5;
 reasons.push('âš ï¸ Extreme volatility - trader\'s paradise');
 } else if (stockVolatility > 10) {
 risk = 'HIGH';
 score += 10;
 confidence -= 3;
 reasons.push('âš¡ High volatility - active trade');
 } else if (stockVolatility > 5) {
 risk = 'MEDIUM';
 score += 8;
 reasons.push('ðŸ“Š Moderate volatility - good movement');
 } else if (stockVolatility > 2) {
 risk = 'LOW';
 score += 15;
 confidence += 5;
 reasons.push('ðŸ›¡ï¸ Stable growth - lower risk');
 } else {
 risk = 'VERY LOW';
 score -= 10; // Too quiet
 confidence -= 8;
 reasons.push('ðŸ˜´ Low activity - skip');
 }

 // ===== 5. PATTERN RECOGNITION =====
 // Golden zone (4-7% gains)
 if (change >= 4 && change <= 7) {
 score += 25;
 confidence += 15;
 reasons.push('ðŸŽ¯ In the golden zone - optimal entry');
 }

 // V-shaped recovery
 if (change < -5 && Math.abs(change) > 5) {
 score += 18;
 confidence += 10;
 reasons.push('ðŸ”„ V-recovery pattern forming');
 }

 // Breakout zone
 if (change > 8 && change < 12) {
 score += 20;
 confidence += 12;
 reasons.push('ðŸ’¥ Breakout zone - momentum play');
 }

 // ===== 6. MARKET CONTEXT BONUS =====
 if (marketSentiment === 'BULLISH' && change > 3) {
 score += 15;
 confidence += 8;
 reasons.push('ðŸŒŠ Riding bullish market tide');
 } else if (marketSentiment === 'BEARISH' && change > 5) {
 score += 22;
 confidence += 12;
 reasons.push('ðŸ¦… Strong in weak market - leader');
 } else if (marketSentiment === 'BEARISH' && change < -8) {
 score += 18;
 confidence += 10;
 reasons.push('ðŸ’° Contrarian value play');
 }

 // ===== 7. PRICE LEVEL OPPORTUNITIES =====
 if (price < 5 && change > 10) {
 score += 20;
 reasons.push('ðŸš¨ Micro-cap moonshot potential');
 }
 if (price > 1000 && change > 2) {
 score += 12;
 confidence += 10;
 reasons.push('ðŸ° Mega-cap institutional strength');
 }

 // ===== 8. FINAL CONFIDENCE ADJUSTMENT =====
 confidence = Math.min(100, Math.max(0, confidence));
 score = score * (1 + confidence / 200); // Boost score by confidence

 // Only recommend stocks with strong signals (score > 70)
 if (score > 70 && reasons.length >= 2) {
 recommendations.push({
 symbol: stock.symbol,
 name: stock.name,
 score: Math.round(score),
 type,
 reasons: reasons.slice(0, 4), // Top 4 reasons
 risk,
 change,
 price,
 hasPosition,
 confidence: Math.round(confidence),
 relativeStrength: relativeStrength.toFixed(2)
 });
 }
 });

 // Sort by score (descending), then by confidence
 recommendations.sort((a, b) => {
 if (Math.abs(a.score - b.score) < 5) {
 return b.confidence - a.confidence;
 }
 return b.score - a.score;
 });
 const topPicks = recommendations.slice(0, 8); // Show top 8 instead of 6

 if (topPicks.length === 0) return null;

 return (
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-purple-500/50 mb-6 overflow-hidden">
 {/* Animated background */}
 <div className="absolute inset-0 bg-gray-800 to-pink-500/10"></div>

 <div className="relative">
 <div className="flex items-center justify-between mb-6">
 <div className="flex items-center gap-3">
 <span className="text-4xl">ðŸŽ¯</span>
 <div>
 <h2 className="text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gray-800 to-pink-300">
 Top Stocks to Buy
 </h2>
 <p className="text-sm text-purple-300">UltraThink AI recommendations â€¢ Live market analysis</p>
 </div>
 </div>
 <div className="text-right">
 <div className="text-xs bg-gray-800 text-white px-3 py-1 rounded-full font-bold">
 TOP {topPicks.length}
 </div>
 <div className="text-[10px] text-purple-300 mt-1">Updated live</div>
 </div>
 </div>

 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
 {topPicks.map((pick, idx) => {
 const typeColor =
 pick.type === 'STRONG BUY' ? 'emerald' :
 pick.type === 'BUY' ? 'green' :
 pick.type === 'BUY DIP' ? 'cyan' :
 pick.type === 'TAKE PROFIT' ? 'yellow' :
 pick.type === 'CUT LOSS' ? 'red' :
 'gray';

 const riskColor =
 pick.risk === 'VERY LOW' ? 'text-green-400' :
 pick.risk === 'LOW' ? 'text-green-300' :
 pick.risk === 'MEDIUM' ? 'text-yellow-300' :
 pick.risk === 'HIGH' ? 'text-orange-300' :
 pick.risk === 'EXTREME' ? 'text-red-400' :
 'text-red-300';

 return (
 <div key={idx} className="bg-gray-900 rounded-xl p-4 border-2 border-blue-500/50 hover:border-cyan-400 hover:shadow-xl hover:shadow-cyan-500/20 cursor-pointer group"
 onClick={() => {
 const stockExists = stocks.find(s => s.symbol === pick.symbol);
 if (stockExists) {
 setSelectedStock(pick.symbol);
 setMainTab('market');
 }
 }}>
 {/* Rank badge */}
 <div className="flex items-start justify-between mb-3">
 <div className="flex items-center gap-2">
 <div className="bg-purple-500/30 text-purple-200 text-xs font-black px-2 py-1 rounded-full">
 #{idx + 1}
 </div>
 <div className={`text-xs font-bold px-2 py-1 rounded-full ${
 typeColor === 'emerald' ? 'bg-emerald-900/40 border border-emerald-400/70 text-emerald-300' :
 typeColor === 'green' ? 'bg-green-900/40 border border-green-500/50 text-green-300' :
 typeColor === 'cyan' ? 'bg-cyan-900/40 border border-cyan-500/50 text-cyan-300' :
 typeColor === 'yellow' ? 'bg-yellow-900/40 border border-yellow-500/50 text-yellow-300' :
 typeColor === 'red' ? 'bg-red-900/40 border border-red-500/50 text-red-300' :
 'bg-gray-900/40 border border-gray-500/50 text-gray-300'
 }`}>
 {pick.type}
 </div>
 </div>
 <div className="text-right">
 <div className="text-lg font-black text-cyan-300">{pick.score}</div>
 <div className="text-[8px] text-gray-400">SCORE</div>
 </div>
 </div>

 {/* Stock info */}
 <div className="mb-3">
 <div className="flex items-baseline gap-2 mb-1">
 <h3 className="text-xl font-black text-white group-hover:text-cyan-300 transition-colors">
 {pick.symbol}
 </h3>
 {pick.hasPosition && (
 <span className="text-[10px] bg-blue-500/30 text-blue-300 px-2 py-0.5 rounded-full font-bold">
 OWNED
 </span>
 )}
 </div>
 <div className="text-xs text-gray-400 truncate">{pick.name}</div>
 </div>

 {/* Price & Change */}
 <div className="flex items-center justify-between mb-3 pb-3 border-b border-blue-600/30">
 <div>
 <div className="text-xs text-gray-400">Price</div>
 <div className="text-lg font-bold text-white">${pick.price.toFixed(2)}</div>
 </div>
 <div className="text-right">
 <div className="text-xs text-gray-400">Change</div>
 <div className={`text-lg font-bold ${pick.change >= 0 ? 'text-green-300' : 'text-red-300'}`}>
 {pick.change >= 0 ? '+' : ''}{pick.change.toFixed(2)}%
 </div>
 </div>
 </div>

 {/* AI Reasoning */}
 <div className="mb-3">
 <div className="text-[10px] text-purple-300 font-bold mb-1">AI REASONING:</div>
 <div className="space-y-1">
 {pick.reasons.map((reason, i) => (
 <div key={i} className="text-xs text-blue-200 flex items-start gap-1">
 <span className="text-cyan-400">â€¢</span>
 <span>{reason}</span>
 </div>
 ))}
 </div>
 </div>

 {/* Risk, Confidence & Action */}
 <div className="flex items-center justify-between">
 <div className="flex items-center gap-3">
 <div className="text-[10px]">
 <span className="text-gray-400">Risk: </span>
 <span className={`font-bold ${riskColor}`}>{pick.risk}</span>
 </div>
 <div className="text-[10px]">
 <span className="text-gray-400">Confidence: </span>
 <span className={`font-bold ${
 pick.confidence >= 70 ? 'text-green-300' :
 pick.confidence >= 50 ? 'text-cyan-300' :
 pick.confidence >= 30 ? 'text-yellow-300' :
 'text-orange-300'
 }`}>{pick.confidence}%</span>
 </div>
 </div>
 <div className="text-xs text-cyan-300 font-bold transition-transform">
 View Details â†’
 </div>
 </div>
 </div>
 );
 })}
 </div>

 {/* Disclaimer */}
 <div className="mt-4 pt-4 border-t border-purple-500/30 text-[10px] text-purple-300 text-center">
 âš ï¸ AI recommendations are for educational purposes only. Past performance does not guarantee future results. Always do your own research.
 </div>
 </div>
 </div>
 );
 })()}

 {/* Market View */}
 <div className="group bg-black/80 rounded-xl p-6 border-2 border-cyan-500/30 hover:border-cyan-400/60 overflow-hidden" >

 <h2 className="relative text-2xl font-black text-transparent bg-clip-text bg-gray-800 mb-4" >ðŸ” Stock Search</h2>

 <div className="relative mb-6">
 <input
 type="text"
 placeholder="Search stocks (e.g., AAPL, TSLA, NVDA)..."
 value={searchQuery}
 onChange={(e) => setSearchQuery(e.target.value)}
 className="w-full bg-black/60 border-2 border-cyan-500/40 hover:border-cyan-400 focus:border-cyan-400 rounded-xl px-4 py-4 text-white text-lg placeholder-gray-500 focus:border-cyan-400 focus:outline-none transition-all focus:shadow-lg focus:shadow-cyan-500/30 focus:scale-[1.02]"
 />
 {searching && (
 <div className="absolute right-4 top-4">
 <div className="text-cyan-300">ðŸ”</div>
 </div>
 )}
 </div>

 {/* Search Results */}
 {searchQuery && showSearchResults && (
 <div className="group/results mb-6 bg-black/80 border-2 border-cyan-500/30 rounded-xl" >

 {searching ? (
 <div className="relative p-6 text-center">
 <div className="text-cyan-300 font-semibold">Searching...</div>
 </div>
 ) : searchResults.length > 0 ? (
 <div className="relative max-h-60 overflow-y-auto">
 {searchResults.map((result) => (
 <div
 key={result.symbol}
 onClick={async () => {
 setSearching(true);
 setError(null);
 const stockData = await fetchSingleStock(result.symbol, result.name);
 const existingIndex = stocks.findIndex(s => s.symbol === result.symbol);
 if (existingIndex >= 0) {
 const updatedStocks = [...stocks];
 updatedStocks[existingIndex] = stockData;
 setStocks(updatedStocks);
 } else {
 setStocks([...stocks, stockData]);
 }
 setSelectedStock(result.symbol);
 setTradeAnalysisData(null); // Clear trade analysis when switching stocks
 setSearchQuery('');
 setShowSearchResults(false);
 setSearching(false);
 }}
 className="group/item p-4 border-b border-cyan-500/20 last:border-b-0 hover:bg-cyan-500/10 cursor-pointer transition-all[1.02] overflow-hidden"
 >
 {/* Item shine effect */}
 <div className="absolute inset-0 -translate-x-full group-hover/item:translate-x-full bg-gray-800 from-transparent to-transparent"></div>

 <div className="relative flex items-center justify-between">
 <div className="flex-1">
 <div className="font-black text-transparent bg-clip-text bg-gray-800 from-white text-lg">{result.symbol}</div>
 <div className="text-sm text-cyan-300 font-semibold">{result.name}</div>
 <div className="text-xs text-gray-400 mt-1 font-medium">
 {result.region} â€¢ {result.currency}
 </div>
 </div>
 <div className="text-cyan-400 text-2xl group-hover/item:translate-x-1 transition-transform">â†’</div>
 </div>
 </div>
 ))}
 </div>
 ) : error ? (
 <div className="relative p-6 text-center">
 <div className="text-yellow-400 mb-2 text-2xl">âš ï¸</div>
 <div className="text-yellow-300 text-sm font-semibold">{error}</div>
 </div>
 ) : (
 <div className="relative p-6 text-center">
 <div className="text-cyan-400 mb-2 text-2xl">ðŸ”</div>
 <div className="text-cyan-300 font-semibold">No results found for"{searchQuery}"</div>
 <div className="text-xs text-gray-400 mt-2 font-medium">Try: AAPL, GOOGL, MSFT, TSLA, NVDA</div>
 </div>
 )}
 </div>
 )}

 <h3 className="text-lg font-bold text-transparent bg-clip-text bg-gray-800 mb-4 mt-8">ðŸ“Š Select a Stock to Trade</h3>
 {loading && stocks.length === 0 ? (
 <div className="text-center py-12 bg-black/80 border-2 border-cyan-500/30 rounded-xl">
 <div className="text-cyan-300 font-semibold">Loading stocks...</div>
 </div>
 ) : !selectedStock ? (
 <div className="text-center py-12 bg-black/80 rounded-xl border-2 border-dashed border-cyan-500/30">
 <div className="text-6xl mb-3 opacity-50">ðŸ“Š</div>
 <div className="text-cyan-300 font-semibold">No stock selected</div>
 <div className="text-sm text-gray-400 mt-2 font-medium">Search and add stocks to your watchlist, then select one to trade</div>
 </div>
 ) : null}

 {/* Trading Panel - Now in main left column */}
 {selectedStock && (
 <div className="group bg-black/80 rounded-xl p-6 border-2 border-cyan-500/30 hover:border-cyan-400/60 mt-6" >

 {/* Stock Header with AI Indicator */}
 <div className="relative mb-6 pb-6 border-b border-cyan-500/30">
 <div className="flex items-center justify-between mb-3">
 <div className="flex items-center gap-3">
 <h2 className="text-4xl font-black text-transparent bg-clip-text bg-gray-800 to-blue-400">{selectedStock}</h2>
 {/* AI Quick Signal */}
 <div className="relative flex items-center gap-2 bg-gray-800 border-2 border-purple-500/50 rounded-full px-3 py-1 overflow-hidden">
 <div className="absolute inset-0 bg-gray-800 to-indigo-500/10"></div>
 <span className="relative text-lg">ðŸ§ </span>
 <span className="relative text-purple-300 text-xs font-black">AI Active</span>
 </div>
 </div>
 <div className={`px-4 py-2 rounded-lg font-bold text-sm border-2 ${
 (stocks.find(s => s.symbol === selectedStock)?.change || 0) >= 0
 ? 'bg-green-500/20 text-green-300 border-green-500/50'
 : 'bg-red-500/20 text-red-300 border-red-500/50'
 }`} >
 {(stocks.find(s => s.symbol === selectedStock)?.change || 0) >= 0 ? 'â†—' : 'â†˜'}
 {(stocks.find(s => s.symbol === selectedStock)?.change || 0) >= 0 ? '+' : ''}
 {(stocks.find(s => s.symbol === selectedStock)?.change || 0).toFixed(2)}%
 </div>
 </div>
 <p className="text-cyan-300 text-lg mb-3 font-semibold">{stocks.find(s => s.symbol === selectedStock)?.name || selectedStock}</p>

 {/* Quick AI Signal */}
 {(() => {
 const stock = stocks.find(s => s.symbol === selectedStock);
 const change = stock?.change || 0;
 const momentum = change > 3 ? 'Strong Bullish' : change > 1 ? 'Bullish' : change < -3 ? 'Strong Bearish' : change < -1 ? 'Bearish' : 'Neutral';
 const signalColor = change > 1 ? 'green' : change < -1 ? 'red' : 'yellow';
 const actionText = change > 2 ? 'Consider Buying' : change < -2 ? 'Caution Advised' : 'Monitor Closely';

 return (
 <div className={`relative bg-gray-800 ${
 signalColor === 'green' ? 'border-green-500/50' :
 signalColor === 'red' ? 'border-red-500/50' :
 'border-yellow-500/50'
 } border-2 rounded-lg p-3 flex items-center justify-between overflow-hidden`} >
 <div className="absolute inset-0 bg-gray-800 from-transparent via-white/5 to-transparent opacity-50"></div>
 <div className="relative flex items-center gap-2">
 <span className="text-2xl">{signalColor === 'green' ? 'ðŸ“ˆ' : signalColor === 'red' ? 'ðŸ“‰' : 'âš–ï¸'}</span>
 <div>
 <div className={`text-sm font-black ${
 signalColor === 'green' ? 'text-green-300' :
 signalColor === 'red' ? 'text-red-300' :
 'text-yellow-300'
 }`}>AI Signal: {momentum}</div>
 <div className="text-xs text-cyan-300 font-semibold">{actionText}</div>
 </div>
 </div>
 <button
 onClick={() => {
 setAiAnalysisTab('analysis');
 setMainTab('ai-analysis');
 }}
 className="relative text-xs font-bold text-cyan-400 hover:text-cyan-300 underline transition-colors"
 >
 Full Analysis â†’
 </button>
 </div>
 );
 })()}

 {/* Smart Buy/Sell Timing Suggestions */}
 {(() => {
 const stock = stocks.find(s => s.symbol === selectedStock);
 if (!stock) return null;

 const change = stock.change || 0;
 const price = stock.price || 0;

 // Analyze timing based on multiple factors
 const currentHour = new Date().getHours();
 const currentMinutes = new Date().getMinutes();
 const isMarketOpening = marketOpen && currentHour === 9 && currentMinutes >= 30 && currentMinutes < 45;
 const isMarketClosing = marketOpen && currentHour === 15 && currentMinutes >= 45;
 const isMidDay = marketOpen && currentHour >= 11 && currentHour <= 14;

 // Get position info
 const positionShares = portfolio.positions[selectedStock] || 0;
 const hasPosition = positionShares > 0;
 const positionReturn = 0; // avgPrice tracking not implemented yet

 let buyTiming = { score: 50, label: 'Neutral', color: 'gray', reason: '' };
 let sellTiming = { score: 50, label: 'Neutral', color: 'gray', reason: '' };

 // Buy timing analysis
 if (change < -3 && isMidDay) {
 buyTiming = { score: 85, label: 'Excellent', color: 'green', reason: 'Strong dip during stable hours' };
 } else if (change < -1.5 && !isMarketOpening) {
 buyTiming = { score: 75, label: 'Good', color: 'green', reason: 'Pullback opportunity' };
 } else if (change > 0 && change < 2 && isMidDay) {
 buyTiming = { score: 65, label: 'Fair', color: 'yellow', reason: 'Moderate momentum' };
 } else if (change > 5) {
 buyTiming = { score: 25, label: 'Poor', color: 'red', reason: 'Overextended - wait for pullback' };
 } else if (isMarketOpening || isMarketClosing) {
 buyTiming = { score: 40, label: 'Caution', color: 'yellow', reason: 'High volatility period' };
 } else {
 buyTiming = { score: 50, label: 'Neutral', color: 'gray', reason: 'Standard market conditions' };
 }

 // Sell timing analysis
 if (hasPosition) {
 if (positionReturn > 15 && change > 0) {
 sellTiming = { score: 85, label: 'Excellent', color: 'green', reason: 'Strong gains with continued momentum' };
 } else if (positionReturn > 8 && change < -2) {
 sellTiming = { score: 90, label: 'Excellent', color: 'green', reason: 'Lock in profits before reversal' };
 } else if (positionReturn < -10) {
 sellTiming = { score: 80, label: 'Consider', color: 'yellow', reason: 'Cut losses or wait for recovery' };
 } else if (positionReturn > 0 && positionReturn < 5) {
 sellTiming = { score: 40, label: 'Hold', color: 'gray', reason: 'Let winners run' };
 } else if (isMarketClosing) {
 sellTiming = { score: 60, label: 'Fair', color: 'yellow', reason: 'End of day - reduce exposure' };
 }
 } else {
 if (change > 10) {
 sellTiming = { score: 70, label: 'Good', color: 'green', reason: 'Consider shorting (advanced)' };
 } else {
 sellTiming = { score: 30, label: 'N/A', color: 'gray', reason: 'No position to sell' };
 }
 }

 const getBgColor = (color) => {
 if (color === 'green') return 'border-green-500/50';
 if (color === 'red') return 'border-red-500/50';
 if (color === 'yellow') return 'border-yellow-500/50';
 return 'border-gray-500/50';
 };

 const getTextColor = (color) => {
 if (color === 'green') return 'text-green-300';
 if (color === 'red') return 'text-red-300';
 if (color === 'yellow') return 'text-yellow-300';
 return 'text-gray-300';
 };

 return (
 <div className="mt-4 bg-purple-500/10 rounded-xl p-4 border-2 border-purple-500/40" >
 <div className="flex items-center gap-2 mb-3">
 <span className="text-lg">â°</span>
 <span className="text-sm font-black text-purple-300">AI Timing Suggestions</span>
 {!marketOpen && <span className="text-xs text-red-300 bg-red-500/20 border border-red-500/50 px-2 py-0.5 rounded-full font-bold">Market Closed</span>}
 </div>

 <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
 {/* Buy Timing */}
 <div className={`bg-gray-900 ${getBgColor(buyTiming.color)} rounded-lg p-3 border-2`}>
 <div className="flex items-center justify-between mb-2">
 <span className="text-xs font-bold text-gray-300">BUY TIMING</span>
 <span className={`text-sm font-black ${getTextColor(buyTiming.color)}`}>
 {buyTiming.score}/100
 </span>
 </div>
 <div className={`text-lg font-black ${getTextColor(buyTiming.color)} mb-1`}>
 {buyTiming.label}
 </div>
 <div className="text-xs text-gray-300">
 {buyTiming.reason}
 </div>
 {/* Visual score bar */}
 <div className="mt-2 bg-gray-800 rounded-full h-1.5 overflow-hidden">
 <div
 className={`h-full ${
 buyTiming.color === 'green' ? 'bg-green-500' :
 buyTiming.color === 'red' ? 'bg-red-500' :
 buyTiming.color === 'yellow' ? 'bg-yellow-500' :
 'bg-gray-500'
 }`}
 style={{ width: `${buyTiming.score}%` }}
 />
 </div>
 </div>

 {/* Sell Timing */}
 <div className={`bg-gray-900 ${getBgColor(sellTiming.color)} rounded-lg p-3 border-2`}>
 <div className="flex items-center justify-between mb-2">
 <span className="text-xs font-bold text-gray-300">SELL TIMING</span>
 <span className={`text-sm font-black ${getTextColor(sellTiming.color)}`}>
 {sellTiming.score}/100
 </span>
 </div>
 <div className={`text-lg font-black ${getTextColor(sellTiming.color)} mb-1`}>
 {sellTiming.label}
 </div>
 <div className="text-xs text-gray-300">
 {sellTiming.reason}
 </div>
 {/* Visual score bar */}
 <div className="mt-2 bg-gray-800 rounded-full h-1.5 overflow-hidden">
 <div
 className={`h-full ${
 sellTiming.color === 'green' ? 'bg-green-500' :
 sellTiming.color === 'red' ? 'bg-red-500' :
 sellTiming.color === 'yellow' ? 'bg-yellow-500' :
 'bg-gray-500'
 }`}
 style={{ width: `${sellTiming.score}%` }}
 />
 </div>
 </div>
 </div>

 {hasPosition && (
 <div className="mt-2 pt-2 border-t border-purple-500/20 text-[10px] text-purple-300">
 ðŸ’¼ Current Position: {positionShares} shares
 </div>
 )}
 </div>
 );
 })()}

 {/* Add to Watchlist Button */}
 {!watchlist.includes(selectedStock) ? (
 <button
 onClick={() => {
 const newWatchlist = [...watchlist, selectedStock];
 setWatchlist(newWatchlist);
 const portfolio = getCurrentPortfolio();
 const updatedPortfolio = {
 ...portfolio,
 watchlist: newWatchlist
 };
 setCompetition(prev => ({
 ...prev,
 members: prev.members.map(m =>
 m.id === currentUserId ? { ...m, portfolio: updatedPortfolio } : m
 )
 }));
 if (plan === 'personal' && userEmail) {
 fetch(`${API_BASE_URL}/api/accounts/update-portfolio`, {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({
 email: userEmail,
 portfolio: updatedPortfolio
 })
 })
 .then(() => console.log('âœ… Watchlist synced to backend'))
 .catch(error => console.error('Error syncing watchlist to backend:', error));
 }
 }}
 className="group/btn mt-4 w-full bg-gray-800 hover:from-purple-400 hover:to-indigo-400 text-white py-3 rounded-xl font-black text-lg transition-all flex items-center justify-center gap-2 overflow-hidden"
 
 >
 <div className="absolute inset-0 bg-gray-800 group-hover/btn:opacity-100 transition-opacity"></div>
 <div className="absolute inset-0 -translate-x-full group-hover/btn:translate-x-full bg-gray-800 from-transparent via-white/20 to-transparent"></div>
 <span className="relative">â­</span>
 <span className="relative">Add to Watchlist</span>
 </button>
 ) : (
 <div className="mt-4 w-full bg-green-500/20 border-2 border-green-500/50 text-green-300 py-3 rounded-xl font-black text-lg flex items-center justify-center gap-2" >
 <span>âœ“</span>
 <span>In Watchlist</span>
 </div>
 )}
 </div>

 {/* Price Display */}
 <div className="relative mb-6 text-center bg-gray-800 rounded-xl p-6 border-2 border-cyan-500/40 overflow-hidden" >
 <div className="absolute inset-0 bg-gray-900 to-blue-500/5"></div>
 <div className="relative text-sm text-cyan-400 font-black mb-2 uppercase tracking-wider">Current Price</div>
 <div className="relative text-6xl font-black text-transparent bg-clip-text bg-gray-800 mb-1">
 ${(stocks.find(s => s.symbol === selectedStock)?.price || 0).toFixed(2)}
 </div>
 <div className="relative text-sm text-gray-400 font-semibold">Per Share</div>
 </div>

 {/* Price Chart */}
 <div className="relative mb-6 bg-black/60 rounded-xl p-4 border-2 border-cyan-500/30 overflow-hidden" >
 <div className="absolute inset-0 bg-gray-900 to-blue-500/5"></div>
 <div className="relative flex items-center justify-between mb-3">
 <div className="flex items-center gap-2">
 <h3 className="text-sm font-black text-transparent bg-clip-text bg-gray-800 to-blue-400">ðŸ“ˆ Price Chart</h3>
 {isRealChartData ? (
 <div className="flex items-center gap-1 bg-green-500/20 border-2 border-green-500/50 rounded-full px-2 py-1" >
 <span className="w-1.5 h-1.5 bg-green-400 rounded-full"></span>
 <span className="text-green-300 text-[10px] font-black uppercase tracking-wide">Finnhub Live</span>
 </div>
 ) : (
 <div className="flex items-center gap-1 bg-yellow-500/20 border-2 border-yellow-500/50 rounded-full px-2 py-1" >
 <span className="text-yellow-300 text-[10px] font-black uppercase tracking-wide">Simulated</span>
 </div>
 )}
 </div>
 <div className="flex gap-1 bg-black/60 rounded-lg p-1 border border-cyan-500/20">
 {['1D', '1W', '1M', '3M', 'ALL'].map(period => (
 <button
 key={period}
 onClick={() => setChartPeriod(period)}
 className={`px-3 py-1 rounded font-black text-xs transition-all ${
 chartPeriod === period
 ? 'bg-gray-800 text-white'
 : 'text-gray-400 hover:text-cyan-300 hover:bg-cyan-500/10'
 }`}
 >
 {period}
 </button>
 ))}
 </div>
 </div>
 <div className="relative h-48">
 <canvas ref={chartRef}></canvas>
 </div>
 {!isRealChartData && (
 <div className="relative mt-3 text-xs text-yellow-400 italic text-center font-semibold">
 âš ï¸ Using simulated historical data - Finnhub API temporarily unavailable
 </div>
 )}
 </div>

 {/* AI Trade Analysis - UltraThink */}
 <div className="mt-6 bg-gray-900 rounded-xl border-2 border-purple-500/50 overflow-hidden">
 {/* Header */}
 <div className="bg-gray-800 p-6 border-b-2 border-purple-500/50">
 <div className="flex items-center justify-between">
 <div className="flex items-center gap-3">
 <div className="w-12 h-12 bg-gray-900 rounded-xl flex items-center justify-center">
 <span className="text-2xl">ðŸ§ </span>
 </div>
 <div>
 <h3 className="text-2xl font-black text-white flex items-center gap-2">
 AI Trade Analysis
 <span className="text-xs bg-gray-800 text-white px-2 py-1 rounded-full font-bold">ULTRATHINK</span>
 </h3>
 <p className="text-sm text-purple-200">Deep neural reasoning for {selectedStock}</p>
 </div>
 </div>
 <button
 onClick={generateAIAnalysis}
 disabled={loadingAnalysis}
 className="bg-gray-800 hover:from-purple-500 hover:to-indigo-500 disabled:from-gray-600 disabled:to-gray-700 text-white px-6 py-3 rounded-xl font-bold text-sm transition-all hover:shadow-xl disabled:opacity-50 flex items-center gap-2"
 >
 {loadingAnalysis ? (
 <>
 <span className="inline-block">âš¡</span>
 <span>Analyzing...</span>
 </>
 ) : (
 <>
 <span>ðŸ”®</span>
 <span>Analyze</span>
 </>
 )}
 </button>
 </div>
 </div>

 {/* Loading Animation */}
 {loadingAnalysis && (
 <div className="p-8">
 <div className="text-center space-y-4">
 <div className="inline-block">
 <div className="w-16 h-16 border-4 border-purple-500/30 border-t-purple-500 rounded-full"></div>
 </div>
 <div className="space-y-2">
 <p className="text-purple-200 font-semibold">ðŸ§  Initializing neural networks...</p>
 <p className="text-purple-300 text-sm delay-100">ðŸ“Š Analyzing technical indicators...</p>
 <p className="text-purple-300 text-sm delay-200">ðŸ“° Processing news sentiment...</p>
 <p className="text-purple-300 text-sm delay-300">âš¡ Calculating risk factors...</p>
 </div>
 </div>
 </div>
 )}

 {/* Analysis Results */}
 {!loadingAnalysis && aiAnalysis && (
 <div className="p-6 space-y-6">
 {/* Timestamp */}
 <div className="text-center text-xs text-purple-300">
 Analysis generated: {aiAnalysis.timestamp}
 </div>

 {/* Main Recommendation */}
 <div className={`bg-gray-900 ${
 aiAnalysis.recommendation.color === 'green' ? 'border-green-500' :
 aiAnalysis.recommendation.color === 'red' ? 'border-red-500' :
 'border-yellow-500'
 } border-2 rounded-xl p-6`}>
 <div className="text-center mb-4">
 <div className={`inline-block px-4 py-2 rounded-full font-black text-lg mb-2 ${
 aiAnalysis.recommendation.color === 'green' ? 'bg-green-500 text-white' :
 aiAnalysis.recommendation.color === 'red' ? 'bg-red-500 text-white' :
 'bg-yellow-500 text-gray-900'
 }`}>
 {aiAnalysis.recommendation.action}
 </div>
 <div className="text-sm text-white mt-2">
 Confidence: <span className="font-black">{aiAnalysis.recommendation.confidence}%</span>
 </div>
 </div>

 {/* Reasoning */}
 <div className="space-y-3 mb-4">
 {aiAnalysis.recommendation.reasoning.map((reason, idx) => (
 <div key={idx} className="bg-black/20 rounded-lg p-3 text-sm text-white">
 {reason}
 </div>
 ))}
 </div>

 {/* Trade Targets */}
 <div className="grid grid-cols-3 gap-3">
 <div className="bg-blue-900/50 rounded-lg p-3 text-center border border-blue-500/30">
 <div className="text-xs text-blue-300 mb-1">Entry</div>
 <div className="text-white font-bold">${aiAnalysis.recommendation.targets.entry}</div>
 </div>
 <div className="bg-red-900/50 rounded-lg p-3 text-center border border-red-500/30">
 <div className="text-xs text-red-300 mb-1">Stop Loss</div>
 <div className="text-white font-bold">${aiAnalysis.recommendation.targets.stopLoss}</div>
 </div>
 <div className="bg-green-900/50 rounded-lg p-3 text-center border border-green-500/30">
 <div className="text-xs text-green-300 mb-1">Take Profit</div>
 <div className="text-white font-bold">${aiAnalysis.recommendation.targets.takeProfit}</div>
 </div>
 </div>
 </div>

 {/* Technical Analysis */}
 <div className="bg-blue-900/30 border-2 border-blue-600/50 rounded-xl p-5">
 <h4 className="text-lg font-black text-cyan-300 mb-4 flex items-center gap-2">
 ðŸ“Š Technical Analysis
 </h4>
 <div className="grid grid-cols-2 gap-4">
 <div>
 <div className="text-xs text-blue-300 mb-1">Signal</div>
 <div className={`text-lg font-bold ${
 aiAnalysis.technical.signal.includes('Bullish') ? 'text-green-300' :
 aiAnalysis.technical.signal.includes('Bearish') ? 'text-red-300' :
 'text-yellow-300'
 }`}>{aiAnalysis.technical.signal}</div>
 </div>
 <div>
 <div className="text-xs text-blue-300 mb-1">Price Change</div>
 <div className={`text-lg font-bold ${parseFloat(aiAnalysis.technical.priceChange) >= 0 ? 'text-green-300' : 'text-red-300'}`}>
 {parseFloat(aiAnalysis.technical.priceChange) >= 0 ? '+' : ''}{aiAnalysis.technical.priceChange}%
 </div>
 </div>
 <div>
 <div className="text-xs text-blue-300 mb-1">Support Level</div>
 <div className="text-white font-bold">${aiAnalysis.technical.support}</div>
 </div>
 <div>
 <div className="text-xs text-blue-300 mb-1">Resistance Level</div>
 <div className="text-white font-bold">${aiAnalysis.technical.resistance}</div>
 </div>
 </div>
 </div>

 {/* Sentiment Analysis */}
 <div className="bg-indigo-900/30 border-2 border-indigo-600/50 rounded-xl p-5">
 <h4 className="text-lg font-black text-indigo-300 mb-4 flex items-center gap-2">
 ðŸ“° News Sentiment
 </h4>
 <div className="grid grid-cols-2 gap-4">
 <div>
 <div className="text-xs text-indigo-300 mb-1">Signal</div>
 <div className={`text-lg font-bold ${
 aiAnalysis.sentiment.signal === 'Positive' ? 'text-green-300' :
 aiAnalysis.sentiment.signal === 'Negative' ? 'text-red-300' :
 'text-yellow-300'
 }`}>{aiAnalysis.sentiment.signal}</div>
 </div>
 <div>
 <div className="text-xs text-indigo-300 mb-1">Sentiment Score</div>
 <div className={`text-lg font-bold ${
 parseFloat(aiAnalysis.sentiment.score) > 30 ? 'text-green-300' :
 parseFloat(aiAnalysis.sentiment.score) < -30 ? 'text-red-300' :
 'text-yellow-300'
 }`}>{aiAnalysis.sentiment.score}</div>
 </div>
 <div>
 <div className="text-xs text-indigo-300 mb-1">Articles Analyzed</div>
 <div className="text-white font-bold">{aiAnalysis.sentiment.articlesAnalyzed}</div>
 </div>
 <div>
 <div className="text-xs text-indigo-300 mb-1">Market Interest</div>
 <div className="text-white font-bold">{aiAnalysis.sentiment.trending}</div>
 </div>
 </div>
 </div>

 {/* Risk Assessment */}
 <div className="bg-purple-900/30 border-2 border-purple-600/50 rounded-xl p-5">
 <h4 className="text-lg font-black text-purple-300 mb-4 flex items-center gap-2">
 âš ï¸ Risk Assessment
 </h4>
 <div className="mb-4">
 <div className="flex items-center justify-between mb-2">
 <span className="text-sm text-purple-200">Risk Level: <span className={`font-bold ${
 aiAnalysis.risk.level === 'High' ? 'text-red-300' :
 aiAnalysis.risk.level === 'Moderate' ? 'text-yellow-300' :
 'text-green-300'
 }`}>{aiAnalysis.risk.level}</span></span>
 <span className="text-sm text-purple-200">Rating: <span className="font-bold text-white">{aiAnalysis.risk.rating}/10</span></span>
 </div>
 <div className="w-full bg-purple-950/50 rounded-full h-3 border border-purple-600/30">
 <div
 className={`h-full rounded-full transition-all ${
 aiAnalysis.risk.rating >= 7 ? 'bg-gray-800 to-red-600' :
 aiAnalysis.risk.rating >= 4 ? 'bg-gray-800 to-yellow-600' :
 'bg-gray-800 to-green-600'
 }`}
 style={{ width: `${aiAnalysis.risk.rating * 10}%` }}
 ></div>
 </div>
 </div>
 <div className="space-y-2">
 {aiAnalysis.risk.factors.map((factor, idx) => (
 <div key={idx} className="text-sm text-purple-100 bg-purple-950/30 rounded-lg p-2">
 {factor}
 </div>
 ))}
 </div>
 </div>
 </div>
 )}

 {/* Empty State */}
 {!loadingAnalysis && !aiAnalysis && (
 <div className="p-12 text-center">
 <div className="text-6xl mb-4">ðŸ§ </div>
 <h4 className="text-xl font-bold text-purple-200 mb-2">Ready to Analyze</h4>
 <p className="text-purple-300 text-sm">Click"Analyze" to generate AI-powered trade insights for {selectedStock}</p>
 </div>
 )}
 </div>

 {/* Real-Time News Feed with Live Updates */}
 <div className="mt-6 bg-gray-900 rounded-xl p-6 border-2 border-indigo-500">
 <div className="flex items-center justify-between mb-4 flex-wrap gap-3">
 <div>
 <h3 className="text-xl font-black text-white flex items-center gap-2 flex-wrap">
 <span>ðŸ“°</span> Latest News - {selectedStock}
 <span className="px-3 py-1 bg-green-500/20 text-green-300 border border-green-500 rounded-full text-xs font-bold">
 â— LIVE
 </span>
 </h3>
 {lastStockNewsUpdate && (
 <div className="text-xs text-indigo-300 mt-1 font-semibold">
 ðŸ”„ Last updated: {lastStockNewsUpdate.toLocaleTimeString()} â€¢ Auto-refreshes every 3 min
 </div>
 )}
 </div>
 <button
 onClick={loadStockNews}
 disabled={loadingNews}
 className="bg-gray-800 hover:from-indigo-500 hover:to-purple-500 disabled:from-gray-600 disabled:to-gray-700 text-white px-4 py-2 rounded-lg font-bold text-sm transition-all disabled:opacity-50 hover:shadow-xl"
 >
 {loadingNews ? 'â³ Loading...' : 'ðŸ”„ Refresh Now'}
 </button>
 </div>

 {stockNews.length === 0 && !loadingNews && (
 <div className="text-center py-12 bg-indigo-700/20 rounded-xl border-2 border-dashed border-indigo-600">
 <div className="text-6xl mb-3 opacity-50">ðŸ“°</div>
 <h4 className="text-lg font-bold text-white mb-2">Loading News...</h4>
 <p className="text-indigo-200 text-sm">Live news will appear here automatically</p>
 </div>
 )}

 {loadingNews && (
 <div className="text-center py-8">
 <div className="inline-block text-4xl">â³</div>
 <div className="text-indigo-200 mt-2">Loading news...</div>
 </div>
 )}

 {stockNews.length > 0 && !loadingNews && (
 <>
 <div className="mb-4 p-3 bg-indigo-800/20 rounded-lg border border-indigo-600/30">
 <div className="flex items-center justify-between text-sm">
 <span className="text-indigo-200 font-semibold">
 ðŸ“Š {stockNews.length} {stockNews.length === 1 ? 'Article' : 'Articles'} Found
 </span>
 <span className="text-indigo-300 text-xs">
 Sorted by recency
 </span>
 </div>
 </div>
 <div className="space-y-3 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
 {stockNews.map((article, idx) => (
 <a
 key={idx}
 href={article.url}
 target="_blank"
 rel="noopener noreferrer"
 className="block bg-gray-900 hover:hover:rounded-xl p-4 border border-indigo-600/50 hover:border-indigo-400 hover:shadow-xl transform[1.02]"
 >
 <div className="flex gap-3">
 {article.image && (
 <img
 src={article.image}
 alt=""
 className="w-24 h-24 rounded-lg object-cover flex-shrink-0 border-2 border-indigo-500/30"
 onError={(e) => e.target.style.display = 'none'}
 />
 )}
 <div className="flex-1 min-w-0">
 <div className="flex items-center gap-2 mb-2 flex-wrap">
 <span className={`px-2.5 py-1 rounded-full text-xs font-black shadow-md ${
 article.sentiment === 'positive' ? 'bg-gray-800 text-white' :
 article.sentiment === 'negative' ? 'bg-gray-800 text-white' :
 'bg-gray-800 text-white'
 }`}>
 {article.sentiment === 'positive' ? 'ðŸ“ˆ BULLISH' :
 article.sentiment === 'negative' ? 'ðŸ“‰ BEARISH' :
 'âž– NEUTRAL'}
 </span>
 <span className="text-xs text-indigo-300 font-semibold">
 {window.newsFeed.formatNewsDate(article.datetime)}
 </span>
 </div>
 <h4 className="text-white font-bold mb-2 line-clamp-2 hover:text-cyan-200 transition-colors text-base leading-snug">
 {article.headline}
 </h4>
 <p className="text-sm text-indigo-100 line-clamp-2 mb-3 leading-relaxed">
 {article.summary}
 </p>
 <div className="flex items-center justify-between">
 <div className="text-xs text-indigo-300 font-semibold flex items-center gap-1">
 <span>ðŸ”–</span> {article.source}
 </div>
 <div className="text-xs text-cyan-300 font-bold flex items-center gap-1 hover:gap-2 transition-all">
 Read Full Story <span>â†’</span>
 </div>
 </div>
 </div>
 </div>
 </a>
 ))}
 </div>
 </>
 )}
 </div>

 {/* Trade Type Selector */}
 <div className="mb-6">
 <label className="block text-cyan-300 font-bold mb-3 text-sm uppercase tracking-wide">Trade Type</label>
 <div className="grid grid-cols-2 gap-3">
 <button
 onClick={() => setTradeType('long')}
 className={`py-3 rounded-xl font-bold ${
 tradeType === 'long'
 ? 'bg-gray-800 text-white'
 : 'bg-blue-700/50 text-blue-300 hover:bg-blue-700'
 }`}
 >
 ðŸ“ˆ Long (Buy)
 </button>
 <button
 onClick={() => setTradeType('short')}
 className={`py-3 rounded-xl font-bold ${
 tradeType === 'short'
 ? 'bg-gray-800 text-white'
 : 'bg-blue-700/50 text-blue-300 hover:bg-blue-700'
 }`}
 >
 ðŸ“‰ Short (Sell)
 </button>
 </div>
 <div className="mt-2 text-xs text-blue-300 text-center">
 {tradeType === 'long' ? 'ðŸ’¡ Buy stock expecting price to rise' : 'ðŸ’¡ Bet against stock expecting price to fall'}
 </div>
 </div>

 {/* Quantity Selector */}
 <div className="mb-6">
 <label className="block text-cyan-300 font-bold mb-3 text-sm uppercase tracking-wide">Select Quantity</label>
 <div className="flex gap-3 mb-3">
 <button
 onClick={() => handleQuantityChange(quantity - 1)}
 className="bg-gray-900 hover:from-blue-500 hover:to-blue-600 text-white w-14 h-14 rounded-xl font-bold text-2xl hover:shadow-xl active-press hover-glow"
 >
 âˆ’
 </button>
 <input
 type="number"
 min="1"
 value={quantity}
 onChange={(e) => handleQuantityChange(e.target.value)}
 className="flex-1 bg-blue-700/50 border-2 border-cyan-500/50 rounded-xl px-4 py-3 text-white text-center text-2xl font-black focus:border-cyan-400 focus:outline-none transition-all focus:shadow-lg focus:shadow-cyan-500/30"
 />
 <button
 onClick={() => handleQuantityChange(quantity + 1)}
 className="bg-gray-900 hover:from-blue-500 hover:to-blue-600 text-white w-14 h-14 rounded-xl font-bold text-2xl hover:shadow-xl active-press hover-glow"
 >
 +
 </button>
 </div>

 {/* Quick Actions */}
 <div className="flex gap-2 mb-3">
 <button
 onClick={buyMax}
 className="flex-1 bg-gray-800 hover:from-green-500 hover:to-emerald-500 text-white py-3 rounded-xl font-bold text-sm hover:shadow-xl active-press hover-glow-green"
 >
 ðŸ’° Buy Max ({getMaxBuyQuantity(selectedStock)})
 </button>
 <button
 onClick={sellMax}
 className="flex-1 bg-gray-800 hover:from-orange-500 hover:to-red-500 text-white py-3 rounded-xl font-bold text-sm hover:shadow-xl active-press hover-glow-red"
 >
 ðŸ“Š Sell Max ({getCurrentPosition(selectedStock)})
 </button>
 </div>

 {/* Error message */}
 {quantityError && (
 <div className="bg-red-900/40 border-2 border-red-500 rounded-xl p-4 text-red-200 text-sm font-semibold animate-shake-glow-red">
 âš ï¸ {quantityError}
 </div>
 )}
 </div>

 {/* Total Cost Summary */}
 <div className="mb-6 p-5 bg-gray-800 border-2 border-purple-500/50 rounded-xl">
 <div className="flex justify-between items-center text-white">
 <span className="text-purple-200 font-semibold">Total Cost:</span>
 <span className="text-3xl font-black">${((stocks.find(s => s.symbol === selectedStock)?.price || 0) * quantity).toFixed(2)}</span>
 </div>
 </div>

 {/* Trade Actions */}
 <div className="grid grid-cols-2 gap-4">
 <button
 onClick={() => {
 if (tradeType === 'long') {
 executeTrade('buy');
 } else {
 executeShortSell();
 }
 }}
 disabled={!marketOpen}
 className={`group py-5 rounded-xl font-black text-xl will-change-transform gpu-accelerated ${
 marketOpen
 ? 'bg-gray-800 hover:from-green-400 hover:to-emerald-500 text-white hover:shadow-green-500/50 active-press hover-glow-green cursor-pointer'
 : 'bg-gray-800 text-gray-400 cursor-not-allowed opacity-60'
 }`}
 >
 <span className="flex items-center justify-center gap-2">
 {!marketOpen && <span className="text-2xl">ðŸ”’</span>}
 <span className={`text-2xl ${marketOpen ? 'group-hover:animate-bounce' : ''}`}>{tradeType === 'long' ? 'ðŸš€' : 'ðŸ“‰'}</span>
 <span>{tradeType === 'long' ? 'BUY' : 'SHORT'}</span>
 {!marketOpen && <span className="text-xs ml-2">(Closed)</span>}
 </span>
 </button>
 <button
 onClick={() => {
 const shortPos = window.shortSelling.getShortPosition(portfolio, selectedStock);
 if (shortPos.quantity > 0) {
 executeCoverShort();
 } else {
 executeTrade('sell');
 }
 }}
 disabled={!marketOpen}
 className={`group py-5 rounded-xl font-black text-xl will-change-transform gpu-accelerated ${
 marketOpen
 ? 'bg-gray-800 hover:from-red-400 hover:to-pink-500 text-white hover:shadow-red-500/50 active-press hover-glow-red cursor-pointer'
 : 'bg-gray-800 text-gray-400 cursor-not-allowed opacity-60'
 }`}
 >
 <span className="flex items-center justify-center gap-2">
 {!marketOpen && <span className="text-2xl">ðŸ”’</span>}
 <span className={`text-2xl ${marketOpen ? 'group-hover:animate-bounce' : ''}`}>ðŸ’¸</span>
 <span>{(() => {
 const shortPos = window.shortSelling.getShortPosition(portfolio, selectedStock);
 return shortPos.quantity > 0 ? 'COVER' : 'SELL';
 })()}</span>
 {!marketOpen && <span className="text-xs ml-2">(Closed)</span>}
 </span>
 </button>
 </div>

 {/* Short Position Display */}
 {(() => {
 const shortPos = window.shortSelling.getShortPosition(portfolio, selectedStock);
 if (shortPos.quantity > 0) {
 const stock = stocks.find(s => s.symbol === selectedStock);
 const pnl = stock ? window.shortSelling.calculateShortPnL(portfolio, selectedStock, stock.price) : 0;
 return (
 <div className="mt-4 bg-red-900/30 border border-red-500 rounded-xl p-4">
 <div className="text-red-300 text-sm font-bold mb-2">ðŸ“‰ SHORT POSITION</div>
 <div className="grid grid-cols-2 gap-2 text-sm">
 <div>
 <div className="text-red-400/70">Shares Shorted:</div>
 <div className="text-white font-bold">{shortPos.quantity}</div>
 </div>
 <div>
 <div className="text-red-400/70">Entry Price:</div>
 <div className="text-white font-bold">${shortPos.entryPrice.toFixed(2)}</div>
 </div>
 <div className="col-span-2 mt-2 pt-2 border-t border-red-500/30">
 <div className="text-red-400/70">Unrealized P/L:</div>
 <div className={`text-2xl font-black ${pnl >= 0 ? 'text-green-300' : 'text-red-300'}`}>
 {pnl >= 0 ? '+' : ''}${pnl.toFixed(2)}
 </div>
 </div>
 </div>
 </div>
 );
 }
 return null;
 })()}
 </div>
 )}
 </div>
 </div>
 </>
 )}

 {/* Watchlist View */}
 {mainTab === 'watchlist' && (
 <>
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-blue-500/50 mb-6">
 <h2 className="text-2xl font-black text-transparent bg-clip-text bg-gray-800 mb-6 flex items-center gap-2">
 â­ My Watchlist
 <span className="text-sm font-normal text-blue-300 ml-2">
 ({watchlist.length} stocks)
 </span>
 </h2>

 {loading && stocks.length === 0 ? (
 <div className="text-center py-12">
 <div className="text-purple-200">Loading stocks...</div>
 </div>
 ) : watchlist.length === 0 ? (
 <div className="text-center py-16 bg-blue-900/30 rounded-xl border-2 border-dashed border-blue-500/50 animate-fade-in">
 <div className="text-8xl mb-4 opacity-50">â­</div>
 <h3 className="text-2xl font-bold text-white mb-3">No Stocks in Watchlist</h3>
 <p className="text-blue-200 text-lg mb-6">Add stocks to your watchlist to track them here</p>
 <div className="inline-flex items-center gap-2 bg-blue-500/20 border-2 border-blue-500/50 rounded-xl px-6 py-3 text-blue-300 font-semibold transition-transform">
 <span>ðŸ’¡</span>
 <span>Go to Trading tab to search and add stocks</span>
 </div>
 </div>
 ) : (
 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
 {filteredStocks.map((stock, index) => (
 <div
 key={stock.symbol}
 onClick={() => {
 setSelectedStock(stock.symbol);
 setTradeAnalysisData(null); // Clear trade analysis when switching stocks
 setMainTab('trading');
 }}
 className={`p-6 rounded-xl cursor-pointer transition-all bg-gray-900 border-2 border-blue-500/50 hover:border-cyan-400 hover:shadow-2xl hover-glow will-change-transform gpu-accelerated animate-fade-in stagger-${Math.min(index + 1, 6)}`}
 >
 <div className="flex justify-between items-start mb-4">
 <div>
 <div className="font-bold text-2xl text-white">{stock.symbol}</div>
 <div className="text-sm text-blue-200 mt-1">{stock.name}</div>
 </div>
 <div className={`px-3 py-1 rounded-full font-bold text-sm transition-all ${
 stock.change >= 0
 ? 'bg-green-500/20 text-green-300 border border-green-500-glow-green'
 : 'bg-red-500/20 text-red-300 border border-red-500-glow-red'
 }`}>
 {stock.change >= 0 ? 'â†—' : 'â†˜'} {stock.change >= 0 ? '+' : ''}{stock.change.toFixed(2)}%
 </div>
 </div>
 <div className="text-center pt-4 border-t border-blue-600/50">
 <div className="text-sm text-blue-300 mb-1">Current Price</div>
 <div className="font-bold text-3xl text-white">${stock.price.toFixed(2)}</div>
 </div>
 <div className="mt-4 text-center">
 <button className="w-full bg-gray-800 hover:from-cyan-400 hover:to-blue-500 text-white py-2 rounded-lg font-bold text-sm transition-all hover:shadow-xl active-press hover-glow">
 ðŸ“Š Trade This Stock
 </button>
 </div>
 </div>
 ))}
 </div>
 )}
 </div>
 </>
 )}

 {/* News View */}
 {mainTab === 'news' && (
 <>
 <div className="group bg-black/80 rounded-xl p-6 border-2 border-cyan-500/30 mb-6" >

 <div className="relative flex items-center justify-between mb-6 flex-wrap gap-4">
 <div>
 <h2 className="text-2xl font-black text-transparent bg-clip-text bg-gray-800 flex items-center gap-2">
 ðŸ“° Market News
 <span className="ml-2 px-3 py-1 bg-green-500/20 text-green-300 border-2 border-green-500/50 rounded-full text-xs font-bold" >
 â— LIVE
 </span>
 </h2>
 {lastNewsUpdate && (
 <div className="text-xs text-cyan-400 mt-1 font-semibold">
 ðŸ”„ Last updated: {lastNewsUpdate.toLocaleTimeString()} â€¢ Auto-refreshes every 2 min
 </div>
 )}
 </div>
 <button
 onClick={loadMarketNews}
 disabled={loadingMarketNews}
 className="group/btn bg-gray-800 hover:from-cyan-400 hover:to-blue-400 text-white px-5 py-2 rounded-lg font-black text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden"
 
 >
 <div className="absolute inset-0 bg-gray-800 group-hover/btn:opacity-100 transition-opacity"></div>
 <div className="absolute inset-0 -translate-x-full group-hover/btn:translate-x-full bg-gray-800 from-transparent via-white/20 to-transparent"></div>
 <span className="relative">{loadingMarketNews ? 'â³ Loading...' : 'ðŸ”„ Refresh News'}</span>
 </button>
 </div>

 {loadingMarketNews ? (
 <div className="relative text-center py-16">
 <div className="inline-block text-6xl mb-4">â³</div>
 <div className="text-cyan-300 text-lg font-semibold">Loading latest market news...</div>
 </div>
 ) : marketNews.length === 0 ? (
 <div className="relative text-center py-16 bg-black/60 rounded-xl border-2 border-dashed border-cyan-500/30 animate-fade-in">
 <div className="text-8xl mb-4 opacity-50">ðŸ“°</div>
 <h3 className="text-2xl font-bold text-transparent bg-clip-text bg-gray-800 mb-3">No News Available</h3>
 <p className="text-cyan-300 text-lg mb-6 font-semibold">Click refresh to load the latest market news</p>
 </div>
 ) : (
 <div className="relative space-y-4">
 {marketNews.map((article, idx) => (
 <a
 key={idx}
 href={article.url}
 target="_blank"
 rel="noopener noreferrer"
 className={`group/news block bg-black/60 hover:bg-black/70 rounded-xl p-5 transition-all border-2 border-cyan-500/30 hover:border-cyan-400 cursor-pointer will-change-transform animate-fade-in stagger-${Math.min(idx + 1, 6)}`}
 
 >
 {/* Shine effect for news cards */}
 <div className="absolute inset-0 -translate-x-full group-hover/news:translate-x-full bg-gray-800 from-transparent to-transparent"></div>

 <div className="relative flex gap-4">
 {article.image && (
 <img
 src={article.image}
 alt=""
 className="w-32 h-32 rounded-lg object-cover flex-shrink-0 border-2 border-cyan-500/30 group-hover/news:scale-105"
 onError={(e) => e.target.style.display = 'none'}
 />
 )}
 <div className="flex-1 min-w-0">
 <div className="flex items-center gap-2 mb-3 flex-wrap">
 <span className={`px-3 py-1 rounded-full text-xs font-bold border-2 transition-all ${
 article.sentiment === 'positive' ? 'bg-green-500/20 text-green-300 border-green-500/50-glow-green' :
 article.sentiment === 'negative' ? 'bg-red-500/20 text-red-300 border-red-500/50-glow-red' :
 'bg-gray-500/20 text-gray-300 border-gray-500/50'
 }`} >
 {article.sentiment === 'positive' ? 'ðŸ“ˆ Bullish' :
 article.sentiment === 'negative' ? 'ðŸ“‰ Bearish' :
 'âž– Neutral'}
 </span>
 <span className="text-xs text-cyan-400 font-semibold">
 {window.newsFeed.formatNewsDate(article.datetime)}
 </span>
 {article.category && (
 <span className="text-xs text-cyan-300 bg-cyan-500/10 border border-cyan-500/30 px-2 py-1 rounded-full font-semibold">
 {article.category}
 </span>
 )}
 </div>
 <h4 className="text-transparent bg-clip-text bg-gray-800 from-white font-black text-lg mb-2 line-clamp-2 group-hover/news:from-cyan-300 group-hover/news:to-blue-400 transition-all">
 {article.headline}
 </h4>
 <p className="text-sm text-gray-400 line-clamp-3 mb-3 leading-relaxed font-medium">
 {article.summary}
 </p>
 <div className="flex items-center justify-between">
 <div className="text-xs text-cyan-400 font-semibold flex items-center gap-1">
 <span>ðŸ“¡</span>
 <span>{article.source}</span>
 </div>
 <div className="text-xs text-cyan-300 font-bold flex items-center gap-1 group-hover/news:translate-x-1 transition-transform">
 <span>Read full article</span>
 <span>â†’</span>
 </div>
 </div>
 </div>
 </div>
 </a>
 ))}
 </div>
 )}
 </div>

 {/* Top Gainers section removed - use dedicated Market Movers tab to avoid API rate limiting */}
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-blue-500/50">
 <div className="text-center py-8">
 <h3 className="text-xl font-black text-white mb-4">ðŸ“ˆ Market Movers</h3>
 <p className="text-blue-300 mb-6">View real-time top gainers and losers in the Market Movers tab</p>
 <button
 onClick={() => setMainTab('movers')}
 className="bg-gray-800 hover:from-orange-400 hover:to-red-400 text-white px-8 py-3 rounded-xl font-black text-lg transition-all hover:shadow-xl active-press"
 >
 ðŸš€ Go to Trading
 </button>
 </div>
 </div>
 </>
 )}

 {/* AI Analysis View */}
 {mainTab === 'ai-analysis' && (
 <>
 <div className="group bg-black/80 rounded-xl p-8 border-2 border-purple-500/40 mb-6" >

 <div className="relative text-center mb-8">
 <div className="relative inline-flex items-center justify-center w-24 h-24 bg-gray-900 rounded-full mb-6 overflow-hidden">
 <div className="absolute inset-0 bg-purple-500/30 blur-2xl"></div>
 <span className="relative text-5xl">ðŸ§ </span>
 </div>
 <h2 className="text-4xl font-black text-transparent bg-clip-text bg-gray-800 mb-3 flex items-center justify-center gap-3">
 AI Stock Analysis
 <span className="text-sm bg-gray-800 text-white px-3 py-1 rounded-full font-black border-2 border-purple-400/50" >ULTRATHINK</span>
 </h2>
 <p className="text-xl text-purple-300 font-semibold">Deep neural reasoning & market intelligence for any stock</p>
 </div>

 {/* Stock Search for AI Analysis */}
 <div className="relative max-w-2xl mx-auto mb-8">
 <label className="block text-purple-300 font-black mb-3 text-sm uppercase tracking-wide">Select Stock to Analyze</label>
 <div className="relative">
 <input
 type="text"
 placeholder="Search for any stock (e.g., AAPL, TSLA, NVDA, GOOGL)..."
 value={searchQuery}
 onChange={(e) => setSearchQuery(e.target.value)}
 className="w-full bg-black/60 border-2 border-purple-500/40 hover:border-purple-400 focus:border-purple-400 rounded-xl px-6 py-4 text-white text-lg placeholder-gray-500 focus:outline-none transition-all font-semibold"
 
 />
 {searching && (
 <div className="absolute right-6 top-5">
 <div className="text-purple-400 text-xl">ðŸ”</div>
 </div>
 )}
 </div>

 {/* Search Results for AI Analysis */}
 {searchQuery && showSearchResults && (
 <div className="group/airesults mt-4 bg-black/80 border-2 border-purple-500/30 rounded-xl max-h-80 overflow-y-auto" >
 {/* Shine effect */}
 <div className="absolute inset-0 -translate-x-full group-hover/airesults:translate-x-full bg-gray-800 from-transparent to-transparent pointer-events-none"></div>

 {searching ? (
 <div className="relative p-6 text-center">
 <div className="text-purple-300 font-semibold">Searching...</div>
 </div>
 ) : searchResults.length > 0 ? (
 searchResults.map((result) => (
 <div
 key={result.symbol}
 onClick={async () => {
 setSearching(true);
 setError(null);
 const stockData = await fetchSingleStock(result.symbol, result.name);
 const existingIndex = stocks.findIndex(s => s.symbol === result.symbol);
 if (existingIndex >= 0) {
 const updatedStocks = [...stocks];
 updatedStocks[existingIndex] = stockData;
 setStocks(updatedStocks);
 } else {
 setStocks([...stocks, stockData]);
 }
 setSelectedStock(result.symbol);
 setTradeAnalysisData(null); // Clear trade analysis when switching stocks
 setSearchQuery('');
 setShowSearchResults(false);
 setSearching(false);
 // Auto-load news for AI analysis
 const news = await window.newsFeed.fetchStockNews(result.symbol, FINNHUB_API_KEY);
 setStockNews(news);
 // Clear previous AI analysis
 setAiAnalysis(null);
 }}
 className="group/aiitem p-5 border-b border-purple-500/20 last:border-b-0 hover:bg-purple-500/10 cursor-pointer transition-all overflow-hidden"
 >
 {/* Item shine */}
 <div className="absolute inset-0 -translate-x-full group-hover/aiitem:translate-x-full bg-gray-800 from-transparent to-transparent"></div>

 <div className="relative flex items-center justify-between">
 <div className="flex-1">
 <div className="font-black text-transparent bg-clip-text bg-gray-800 from-white text-xl">{result.symbol}</div>
 <div className="text-sm text-purple-300 font-semibold">{result.name}</div>
 <div className="text-xs text-gray-400 mt-1 font-medium">
 {result.region} â€¢ {result.currency}
 </div>
 </div>
 <div className="text-purple-400 text-3xl group-hover/aiitem:translate-x-1 transition-transform">â†’</div>
 </div>
 </div>
 ))
 ) : error ? (
 <div className="relative p-6 text-center">
 <div className="text-yellow-400 mb-2 text-2xl">âš ï¸</div>
 <div className="text-yellow-300 text-sm font-semibold">{error}</div>
 </div>
 ) : (
 <div className="relative p-6 text-center">
 <div className="text-purple-400 mb-2 text-2xl">ðŸ”</div>
 <div className="text-purple-300 font-semibold">No results found for"{searchQuery}"</div>
 <div className="text-xs text-gray-400 mt-2 font-medium">Try: AAPL, GOOGL, MSFT, TSLA, NVDA</div>
 </div>
 )}
 </div>
 )}
 </div>

 {/* Selected Stock Display */}
 {selectedStock && (
 <div className="max-w-4xl mx-auto">
 <div className="bg-gray-900 rounded-xl p-6 border-2 border-blue-500/50 mb-6">
 <div className="flex items-center justify-between mb-4">
 <div>
 <h3 className="text-3xl font-black text-white">{selectedStock}</h3>
 <p className="text-blue-200 text-lg">{stocks.find(s => s.symbol === selectedStock)?.name || selectedStock}</p>
 </div>
 <div className="text-right">
 <div className="text-4xl font-black text-white mb-1">
 ${(stocks.find(s => s.symbol === selectedStock)?.price || 0).toFixed(2)}
 </div>
 <div className={`text-lg font-bold ${
 (stocks.find(s => s.symbol === selectedStock)?.change || 0) >= 0
 ? 'text-green-300'
 : 'text-red-300'
 }`}>
 {(stocks.find(s => s.symbol === selectedStock)?.change || 0) >= 0 ? 'â†— +' : 'â†˜ '}
 {(stocks.find(s => s.symbol === selectedStock)?.change || 0).toFixed(2)}%
 </div>
 </div>
 </div>

 <button
 onClick={generateAIAnalysis}
 disabled={loadingAnalysis}
 className="w-full bg-gray-800 hover:from-purple-500 hover:to-pink-500 disabled:from-gray-600 disabled:to-gray-700 text-white py-4 rounded-xl font-black text-xl transition-all hover:shadow-purple-500/50 disabled:opacity-50 flex items-center justify-center gap-3 active-press hover-glow-amber will-change-transform gpu-accelerated"
 >
 {loadingAnalysis ? (
 <>
 <span className="inline-block text-2xl">âš¡</span>
 <span>Analyzing with UltraThink...</span>
 </>
 ) : (
 <>
 <span className="text-2xl">ðŸ”®</span>
 <span>Generate AI Analysis</span>
 </>
 )}
 </button>
 </div>

 {/* AI Analysis Results */}
 {loadingAnalysis && (
 <div className="bg-gray-900 rounded-xl p-12 border-2 border-purple-500/50-glow-amber animate-scale-in">
 <div className="text-center space-y-6">
 <div className="inline-block">
 <div className="w-24 h-24 border-4 border-purple-500/30 border-t-purple-500 rounded-full"></div>
 </div>
 <div className="space-y-3">
 <p className="text-purple-200 font-bold text-xl">ðŸ§  Initializing neural networks...</p>
 <p className="text-purple-300">ðŸ“Š Analyzing technical indicators...</p>
 <p className="text-purple-300">ðŸ“° Processing news sentiment...</p>
 <p className="text-purple-300">âš¡ Calculating risk factors...</p>
 <p className="text-purple-300">ðŸŽ¯ Generating trade recommendations...</p>
 </div>
 </div>
 </div>
 )}

 {!loadingAnalysis && aiAnalysis && (
 <div className="space-y-6 animate-fade-in">
 {/* Timestamp */}
 <div className="text-center text-sm text-purple-300">
 Analysis generated: {aiAnalysis.timestamp}
 </div>

 {/* Main Recommendation */}
 <div className={`bg-gray-900 ${
 aiAnalysis.recommendation.color === 'green' ? 'border-green-500 hover-glow-green' :
 aiAnalysis.recommendation.color === 'red' ? 'border-red-500 hover-glow-red' :
 'border-yellow-500 hover-glow-amber'
 } border-2 rounded-xl p-8 transition-all will-change-transform gpu-accelerated animate-scale-in`}>
 <div className="text-center mb-6">
 <div className={`inline-block px-6 py-3 rounded-full font-black text-2xl mb-3 ${
 aiAnalysis.recommendation.color === 'green' ? 'bg-green-500 text-white-glow-green' :
 aiAnalysis.recommendation.color === 'red' ? 'bg-red-500 text-white-glow-red' :
 'bg-yellow-500 text-gray-900-glow-amber'
 }`}>
 {aiAnalysis.recommendation.action}
 </div>
 <div className="text-lg text-white mt-2">
 Confidence: <span className="font-black text-2xl">{aiAnalysis.recommendation.confidence}%</span>
 </div>
 </div>

 {/* Reasoning */}
 <div className="space-y-4 mb-6">
 {aiAnalysis.recommendation.reasoning.map((reason, idx) => (
 <div key={idx} className="bg-black/20 rounded-xl p-4 text-white">
 {reason}
 </div>
 ))}
 </div>

 {/* Trade Targets */}
 <div className="grid grid-cols-3 gap-4">
 <div className="bg-blue-900/50 rounded-xl p-4 text-center border-2 border-blue-500/30">
 <div className="text-sm text-blue-300 mb-2">Entry Price</div>
 <div className="text-white font-black text-2xl">${aiAnalysis.recommendation.targets.entry}</div>
 </div>
 <div className="bg-red-900/50 rounded-xl p-4 text-center border-2 border-red-500/30">
 <div className="text-sm text-red-300 mb-2">Stop Loss</div>
 <div className="text-white font-black text-2xl">${aiAnalysis.recommendation.targets.stopLoss}</div>
 </div>
 <div className="bg-green-900/50 rounded-xl p-4 text-center border-2 border-green-500/30">
 <div className="text-sm text-green-300 mb-2">Take Profit</div>
 <div className="text-white font-black text-2xl">${aiAnalysis.recommendation.targets.takeProfit}</div>
 </div>
 </div>
 </div>

 {/* Detailed Analysis Cards */}
 <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
 {/* Technical Analysis */}
 <div className="bg-gray-900 border-2 border-blue-500/50 rounded-xl p-6">
 <h4 className="text-2xl font-black text-cyan-300 mb-6 flex items-center gap-2">
 ðŸ“Š Technical Analysis
 </h4>
 <div className="space-y-4">
 <div>
 <div className="text-sm text-blue-300 mb-1">Signal</div>
 <div className={`text-2xl font-bold ${
 aiAnalysis.technical.signal.includes('Bullish') ? 'text-green-300' :
 aiAnalysis.technical.signal.includes('Bearish') ? 'text-red-300' :
 'text-yellow-300'
 }`}>{aiAnalysis.technical.signal}</div>
 </div>
 <div>
 <div className="text-sm text-blue-300 mb-1">Price Change</div>
 <div className={`text-2xl font-bold ${parseFloat(aiAnalysis.technical.priceChange) >= 0 ? 'text-green-300' : 'text-red-300'}`}>
 {parseFloat(aiAnalysis.technical.priceChange) >= 0 ? '+' : ''}{aiAnalysis.technical.priceChange}%
 </div>
 </div>
 <div className="grid grid-cols-2 gap-4 pt-4 border-t border-blue-600/50">
 <div>
 <div className="text-xs text-blue-300 mb-1">Support</div>
 <div className="text-white font-bold text-lg">${aiAnalysis.technical.support}</div>
 </div>
 <div>
 <div className="text-xs text-blue-300 mb-1">Resistance</div>
 <div className="text-white font-bold text-lg">${aiAnalysis.technical.resistance}</div>
 </div>
 </div>
 </div>
 </div>

 {/* Sentiment Analysis */}
 <div className="bg-gray-900 border-2 border-indigo-500/50 rounded-xl p-6">
 <h4 className="text-2xl font-black text-indigo-300 mb-6 flex items-center gap-2">
 ðŸ“° News Sentiment
 </h4>
 <div className="space-y-4">
 <div>
 <div className="text-sm text-indigo-300 mb-1">Signal</div>
 <div className={`text-2xl font-bold ${
 aiAnalysis.sentiment.signal === 'Positive' ? 'text-green-300' :
 aiAnalysis.sentiment.signal === 'Negative' ? 'text-red-300' :
 'text-yellow-300'
 }`}>{aiAnalysis.sentiment.signal}</div>
 </div>
 <div>
 <div className="text-sm text-indigo-300 mb-1">Sentiment Score</div>
 <div className={`text-2xl font-bold ${
 parseFloat(aiAnalysis.sentiment.score) > 30 ? 'text-green-300' :
 parseFloat(aiAnalysis.sentiment.score) < -30 ? 'text-red-300' :
 'text-yellow-300'
 }`}>{aiAnalysis.sentiment.score}/100</div>
 </div>
 <div className="grid grid-cols-2 gap-4 pt-4 border-t border-indigo-600/50">
 <div>
 <div className="text-xs text-indigo-300 mb-1">Articles</div>
 <div className="text-white font-bold text-lg">{aiAnalysis.sentiment.articlesAnalyzed}</div>
 </div>
 <div>
 <div className="text-xs text-indigo-300 mb-1">Interest</div>
 <div className="text-white font-bold text-lg">{aiAnalysis.sentiment.trending}</div>
 </div>
 </div>
 </div>
 </div>
 </div>

 {/* Risk Assessment */}
 <div className="bg-gray-900 border-2 border-purple-500/50 rounded-xl p-6">
 <h4 className="text-2xl font-black text-purple-300 mb-6 flex items-center gap-2">
 âš ï¸ Risk Assessment
 </h4>
 <div className="mb-6">
 <div className="flex items-center justify-between mb-3">
 <span className="text-lg text-purple-200">Risk Level: <span className={`font-black text-xl ${
 aiAnalysis.risk.level === 'High' ? 'text-red-300' :
 aiAnalysis.risk.level === 'Moderate' ? 'text-yellow-300' :
 'text-green-300'
 }`}>{aiAnalysis.risk.level}</span></span>
 <span className="text-lg text-purple-200">Rating: <span className="font-black text-xl text-white">{aiAnalysis.risk.rating}/10</span></span>
 </div>
 <div className="w-full bg-purple-950/50 rounded-full h-4 border-2 border-purple-600/30">
 <div
 className={`h-full rounded-full transition-all ${
 aiAnalysis.risk.rating >= 7 ? 'bg-gray-800 to-red-600' :
 aiAnalysis.risk.rating >= 4 ? 'bg-gray-800 to-yellow-600' :
 'bg-gray-800 to-green-600'
 }`}
 style={{ width: `${aiAnalysis.risk.rating * 10}%` }}
 ></div>
 </div>
 </div>
 <div className="space-y-3">
 {aiAnalysis.risk.factors.map((factor, idx) => (
 <div key={idx} className="text-purple-100 bg-purple-950/30 rounded-lg p-3">
 {factor}
 </div>
 ))}
 </div>
 </div>
 </div>
 )}

 {!loadingAnalysis && !aiAnalysis && (
 <div className="bg-gray-900 rounded-xl p-16 border-2 border-purple-500/50 text-center">
 <div className="text-8xl mb-6">ðŸ”®</div>
 <h3 className="text-3xl font-bold text-white mb-4">Ready to Analyze {selectedStock}</h3>
 <p className="text-xl text-purple-200 mb-8">Click the button above to generate comprehensive AI-powered insights</p>
 <div className="flex items-center justify-center gap-3 text-purple-300">
 <span className="text-lg">Powered by</span>
 <span className="text-2xl font-black bg-gray-800 bg-clip-text text-transparent">UltraThink AI</span>
 </div>
 </div>
 )}
 </div>
 )}

 {!selectedStock && (
 <div className="max-w-2xl mx-auto text-center py-16">
 <div className="text-9xl mb-6 opacity-70">ðŸ”</div>
 <h3 className="text-3xl font-bold text-white mb-4">Search for Any Stock</h3>
 <p className="text-xl text-purple-200">Use the search bar above to find and analyze any stock with AI-powered insights</p>
 </div>
 )}
 </div>
 </>
 )}


 {/* Market Movers View */}
 {mainTab === 'movers' && (
 <>
 <div className="bg-gray-900 rounded-xl p-8 border-2 border-orange-500/50 mb-6">
 <div className="text-center mb-8">
 <div className="inline-flex items-center justify-center w-24 h-24 bg-gray-900 rounded-full mb-6">
 <span className="text-5xl">ðŸš€</span>
 </div>
 <h2 className="text-4xl font-black text-white mb-3 flex items-center justify-center gap-3">
 Market Movers
 <span className="text-sm bg-gray-800 text-white px-3 py-1 rounded-full font-bold">TODAY</span>
 </h2>
 <p className="text-xl text-orange-200">Top gainers and losers of the day</p>
 </div>

 {loadingMovers ? (
 <div className="text-center py-20">
 <div className="text-6xl mb-4">ðŸ“Š</div>
 <p className="text-xl text-orange-200 mb-4">Loading market movers...</p>
 <div className="bg-blue-900/40 rounded-xl p-6 max-w-md mx-auto">
 <div className="flex items-center justify-between mb-2">
 <span className="text-sm text-orange-300 font-semibold">
 Analyzing {moversProgress.total} stocks
 </span>
 <span className="text-sm text-orange-300 font-bold">
 {moversProgress.current}/{moversProgress.total}
 </span>
 </div>
 <div className="w-full bg-blue-900/60 rounded-full h-3 overflow-hidden">
 <div
 className="bg-gray-800 h-3 rounded-full"
 style={{ width: `${(moversProgress.current / moversProgress.total * 100)}%` }}
 ></div>
 </div>
 <p className="text-xs text-orange-200/60 mt-3">
 Fetching real-time data for accurate market movers
 </p>
 </div>
 </div>
 ) : (
 <>
 {/* Top Gainers Section */}
 <div className="mb-8">
 <div className="flex items-center gap-3 mb-6">
 <div className="bg-gray-900 p-3 rounded-xl">
 <span className="text-3xl">ðŸ“ˆ</span>
 </div>
 <div>
 <h3 className="text-3xl font-black text-transparent bg-clip-text bg-gray-800 to-emerald-300">
 Top Gainers
 </h3>
 <p className="text-sm text-green-300 font-semibold">Stocks with highest percentage gains</p>
 </div>
 </div>

 {topGainers.length === 0 ? (
 <div className="bg-blue-900/40 rounded-xl p-8 text-center border-2 border-green-500/30">
 <p className="text-green-200">No gainers found at this time</p>
 </div>
 ) : (
 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
 {topGainers.map((stock, index) => (
 <div
 key={stock.symbol}
 onClick={() => {
 addToWatchlist(stock.symbol);
 setMainTab('trading');
 }}
 className="group bg-gray-900 rounded-xl p-5 border-2 border-green-500/30 hover:border-green-400 hover:shadow-2xl hover:shadow-green-500/20 cursor-pointer"
 >
 <div className="flex items-center justify-between mb-3">
 <div>
 <div className="font-black text-white text-lg tracking-wide">{stock.symbol}</div>
 <div className="text-xs text-green-300/60 font-medium truncate max-w-[120px]">{stock.name}</div>
 </div>
 <div className="bg-green-500/20 rounded-full px-2 py-1">
 <span className="text-xs font-bold text-green-300">#{index + 1}</span>
 </div>
 </div>
 <div className="text-2xl font-black text-white mb-2">
 ${stock.price.toFixed(2)}
 </div>
 <div className="flex items-center gap-2 mb-3">
 <div className="text-xl text-green-400 font-black">
 â†— +{stock.change.toFixed(2)}%
 </div>
 </div>
 <div className="pt-3 border-t border-green-500/20">
 <div className="flex justify-between text-xs text-green-300/70">
 <span>H: ${stock.high.toFixed(2)}</span>
 <span>L: ${stock.low.toFixed(2)}</span>
 </div>
 </div>
 </div>
 ))}
 </div>
 )}
 </div>

 {/* Top Losers Section */}
 <div>
 <div className="flex items-center gap-3 mb-6">
 <div className="bg-gray-900 p-3 rounded-xl">
 <span className="text-3xl">ðŸ“‰</span>
 </div>
 <div>
 <h3 className="text-3xl font-black text-transparent bg-clip-text bg-gray-800 to-pink-300">
 Top Losers
 </h3>
 <p className="text-sm text-red-300 font-semibold">Stocks with highest percentage losses</p>
 </div>
 </div>

 {topLosers.length === 0 ? (
 <div className="bg-blue-900/40 rounded-xl p-8 text-center border-2 border-red-500/30">
 <p className="text-red-200">No losers found at this time</p>
 </div>
 ) : (
 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
 {topLosers.map((stock, index) => (
 <div
 key={stock.symbol}
 onClick={() => {
 addToWatchlist(stock.symbol);
 setMainTab('trading');
 }}
 className="group bg-gray-900 rounded-xl p-5 border-2 border-red-500/30 hover:border-red-400 hover:shadow-2xl hover:shadow-red-500/20 cursor-pointer"
 >
 <div className="flex items-center justify-between mb-3">
 <div>
 <div className="font-black text-white text-lg tracking-wide">{stock.symbol}</div>
 <div className="text-xs text-red-300/60 font-medium truncate max-w-[120px]">{stock.name}</div>
 </div>
 <div className="bg-red-500/20 rounded-full px-2 py-1">
 <span className="text-xs font-bold text-red-300">#{index + 1}</span>
 </div>
 </div>
 <div className="text-2xl font-black text-white mb-2">
 ${stock.price.toFixed(2)}
 </div>
 <div className="flex items-center gap-2 mb-3">
 <div className="text-xl text-red-400 font-black">
 â†˜ {stock.change.toFixed(2)}%
 </div>
 </div>
 <div className="pt-3 border-t border-red-500/20">
 <div className="flex justify-between text-xs text-red-300/70">
 <span>H: ${stock.high.toFixed(2)}</span>
 <span>L: ${stock.low.toFixed(2)}</span>
 </div>
 </div>
 </div>
 ))}
 </div>
 )}
 </div>

 {/* Refresh Button */}
 <div className="mt-8 text-center">
 <button
 onClick={fetchMarketMovers}
 disabled={loadingMovers}
 className="bg-gray-800 hover:from-orange-400 hover:to-red-400 disabled:from-gray-600 disabled:to-gray-700 text-white px-8 py-4 rounded-xl font-black text-lg transition-all hover:shadow-xl active-press disabled:cursor-not-allowed disabled:opacity-50"
 >
 {loadingMovers ? 'ðŸ”„ Refreshing...' : 'ðŸ”„ Refresh Market Data'}
 </button>
 </div>
 </>
 )}
 </div>
 </>
 )}
 </div>
 </div>

 {/* Footer - appears on all views */}
 <footer className="group/footer bg-black/90 border-t-2 border-cyan-500/30 mt-auto overflow-hidden" >
 {/* Animated background gradient */}
 <div className="absolute inset-0 bg-gray-900 opacity-50"></div>

 {/* Shine effect */}
 <div className="absolute inset-0 -translate-x-full group-hover/footer:translate-x-full [2000ms] bg-gray-800 from-transparent to-transparent"></div>

 <div className="relative max-w-7xl mx-auto px-4 py-12">
 <div className="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
 {/* About Section */}
 <div className="group/section">
 <h3 className="text-transparent bg-clip-text bg-gray-800 font-black text-xl mb-4 flex items-center gap-2" >
 <span className="text-2xl">ðŸ’Ž</span>
 FinClash
 </h3>
 <p className="text-gray-400 text-sm leading-relaxed font-medium">
 Virtual stock trading simulator for educational purposes. Practice trading with $100,000 in virtual currency.
 </p>
 </div>

 {/* Legal Links */}
 <div className="group/section">
 <h3 className="text-transparent bg-clip-text bg-gray-800 font-black text-xl mb-4 flex items-center gap-2" >
 <span className="text-2xl">âš–ï¸</span>
 Legal
 </h3>
 <ul className="space-y-3">
 <li>
 <a href="privacy-policy.html" target="_blank" className="group/link text-gray-400 hover:text-cyan-300 text-sm transition-all font-semibold flex items-center gap-2">
 <span className="text-cyan-500/50 group-hover/link:text-cyan-400 transition-colors">â†’</span>
 <span>Privacy Policy</span>
 </a>
 </li>
 <li>
 <a href="terms-of-service.html" target="_blank" className="group/link text-gray-400 hover:text-cyan-300 text-sm transition-all font-semibold flex items-center gap-2">
 <span className="text-cyan-500/50 group-hover/link:text-cyan-400 transition-colors">â†’</span>
 <span>Terms of Service</span>
 </a>
 </li>
 <li>
 <a href="trust-safety.html" target="_blank" className="group/link text-gray-400 hover:text-cyan-300 text-sm transition-all font-semibold flex items-center gap-2">
 <span className="text-cyan-500/50 group-hover/link:text-cyan-400 transition-colors">â†’</span>
 <span>Trust & Safety</span>
 </a>
 </li>
 </ul>
 </div>

 {/* Company Links */}
 <div className="group/section">
 <h3 className="text-transparent bg-clip-text bg-gray-800 font-black text-xl mb-4 flex items-center gap-2" >
 <span className="text-2xl">ðŸ¢</span>
 Company
 </h3>
 <ul className="space-y-3">
 <li>
 <a href="about-us.html" target="_blank" className="group/link text-gray-400 hover:text-cyan-300 text-sm transition-all font-semibold flex items-center gap-2">
 <span className="text-cyan-500/50 group-hover/link:text-cyan-400 transition-colors">â†’</span>
 <span>About Us</span>
 </a>
 </li>
 <li>
 <a href="contact.html" target="_blank" className="group/link text-gray-400 hover:text-cyan-300 text-sm transition-all font-semibold flex items-center gap-2">
 <span className="text-cyan-500/50 group-hover/link:text-cyan-400 transition-colors">â†’</span>
 <span>Contact & Support</span>
 </a>
 </li>
 </ul>
 </div>

 {/* Disclaimer */}
 <div className="group/section">
 <h3 className="text-transparent bg-clip-text bg-gray-800 font-black text-xl mb-4 flex items-center gap-2" >
 <span className="text-2xl">âš ï¸</span>
 Disclaimer
 </h3>
 <p className="text-gray-400 text-sm leading-relaxed font-medium">
 FinClash is for educational purposes only. All trading uses virtual currency. Not real money. Not financial advice.
 </p>
 </div>
 </div>

 {/* Bottom Bar */}
 <div className="border-t-2 border-cyan-500/20 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
 <p className="text-gray-500 text-sm font-semibold">
 Â© 2025 <span className="text-transparent bg-clip-text bg-gray-800 font-black">FinClash</span>. All rights reserved.
 </p>
 <p className="text-gray-500 text-sm font-semibold">
 Created by <span className="text-transparent bg-clip-text bg-gray-800 font-black">Reid Coleman</span> & <span className="text-transparent bg-clip-text bg-gray-800 font-black">Cameron Dietzel</span>
 </p>
 </div>
 </div>
 </footer>
 </>
 );
 };

 const root = ReactDOM.createRoot(document.getElementById('root'));
 root.render(<TradingSimulator />);
 </script>
</body>
</html>
